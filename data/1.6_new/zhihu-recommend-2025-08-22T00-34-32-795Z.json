{
  "data": [
    {
      "id": "606_1755822919.955",
      "type": "feed",
      "offset": 606,
      "verb": "TOPIC_ACKNOWLEDGED_ARTICLE",
      "created_time": 1755822919,
      "updated_time": 1755822919,
      "target": {
        "id": "1926657990729140203",
        "type": "article",
        "url": "https://api.zhihu.com/articles/1926657990729140203",
        "author": {
          "id": "60203af309fb30cc155c9c603f336f52",
          "url": "https://api.zhihu.com/people/60203af309fb30cc155c9c603f336f52",
          "user_type": "people",
          "url_token": "huang-zhu-53-74-52",
          "name": "顶级摸鱼大师",
          "headline": "大模型学习终极文档",
          "avatar_url": "https://pic1.zhimg.com/50/v2-31d38bb3c1a78e206d1056b0dca203a4_l.jpg?source=b6762063",
          "is_org": false,
          "gender": 1,
          "badge": [
            {
              "type": "identity_people",
              "description": "互联网行业 员工"
            }
          ],
          "followers_count": 160,
          "is_following": false,
          "is_followed": false
        },
        "title": "爆火AI工具Dify怎么玩？这绝对是全网最详细的教程（上）",
        "comment_permission": "all",
        "created": 1752131475,
        "updated": 1752131995,
        "voteup_count": 8,
        "voting": 0,
        "comment_count": 0,
        "linkbox": {
          "category": "",
          "pic": "",
          "title": "",
          "url": ""
        },
        "excerpt": "今天给大家详细介绍下Dify如何使用。官方文档： https://docs.dify.ai/zh-hans/introduction 安装启动 项目Clone到本地之后，我们采用Docker的方式进行安装： cd dify默认所使用的是80端口，所以我们访问：http://localhost/apps 即可访问Dify。 注意：Dify升级时，要注意备份 Docker目录下volumes文件夹，因为Dify上的所有数据存储在此。升级后还原备份的volumes即可。   很多想入行大模型的人苦于现在网上的大模型老课程老教材，学也不是不学也不是，基…",
        "excerpt_new": "今天给大家详细介绍下Dify如何使用。官方文档： https://docs.dify.ai/zh-hans/introduction 安装启动 项目Clone到本地之后，我们采用Docker的方式进行安装： cd dify默认所使用的是80端口，所以我们访问：http://localhost/apps 即可访问Dify。 注意：Dify升级时，要注意备份 Docker目录下volumes文件夹，因为Dify上的所有数据存储在此。升级后还原备份的volumes即可。   很多想入行大模型的人苦于现在网上的大模型老课程老教材，学也不是不学也不是，基…",
        "preview_type": "default",
        "preview_text": "",
        "content": "<p data-pid=\"Q61ch0vU\">今天给大家详细介绍下Dify如何使用。官方文档：<a href=\"https://link.zhihu.com/?target=https%3A//docs.dify.ai/zh-hans/introduction\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">https://</span><span class=\"visible\">docs.dify.ai/zh-hans/in</span><span class=\"invisible\">troduction</span><span class=\"ellipsis\"></span></a></p><p data-pid=\"GYksMHrL\"><b>安装启动</b><br/></p><p data-pid=\"zzQIh9bN\">项目Clone到本地之后，我们采用Docker的方式进行安装：</p><div class=\"highlight\"><pre><code class=\"language-text\">cd dify</code></pre></div><p data-pid=\"94h7lrLB\">默认所使用的是80端口，所以我们访问：http://localhost/apps 即可访问Dify。</p><p data-pid=\"QKZIbp6B\">注意：Dify升级时，要注意备份<b>Docker目录下volumes</b>文件夹，因为Dify上的所有数据存储在此。升级后还原备份的volumes即可。</p><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-6f713fd21176976a6aeac17deface68a_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"980\" data-rawheight=\"778\" data-original-token=\"v2-5ecf2955c77d73e0bebad15b3bbecb2e\" class=\"origin_image zh-lightbox-thumb\" width=\"980\" data-original=\"https://pic3.zhimg.com/v2-6f713fd21176976a6aeac17deface68a_r.jpg\"/></figure><p data-pid=\"4C1o3JiO\">很多想入行大模型的人苦于现在网上的大模型老课程老教材，学也不是不学也不是，基于此我用做产品的心态来打磨这份大模型教程，深挖痛点并持续修改了近100 余次后，终于把整个AI 大模型的学习门槛，<b>降到了最低</b>！</p><p data-pid=\"uBNleEau\">这份大模型教程已经给大家整理并打包分享出来, 有需要的小伙伴，可以 <b>点击下方知乎小卡片前往获取</b> ↓↓↓</p><blockquote data-pid=\"YxxShGk1\">ass=&#34;nolink&#34;&gt;知乎大礼包 ：全网最全《LLM 大模型学习资源包》免费分享（安全资料，放心领取）</blockquote><a href=\"https://zhuanlan.zhihu.com/p/1925969219985577539\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\"internal\">2025年，AI大模型全套入门学习教程：免费分享AI大模型入门学习礼包</a><p data-pid=\"mJMebMW4\"><b>使用前配置</b></p><p data-pid=\"zvcWQn3e\">我们注册完账号，进入Dify主页后，先不要着急使用，先配置下模型和用户权限。</p><p data-pid=\"eQgEbxGM\"><b>配置模型：</b>我们按照下图，单击右上角自己的头像，选择【设置】-&gt;【模型供应商】，即可添加今后在DIfy中使用的模型，例如我这里添加了DeepSeek、百度的文心一言、阿里的同义千问和本地的Ollama模型（注意，配置Ollama模型的URL时，有的小伙伴可能和我一样，BaseURL地址可能是：<a href=\"https://link.zhihu.com/?target=http%3A//host.docker.internal%3A11434\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">http://</span><span class=\"visible\">host.docker.internal:11434</span><span class=\"invisible\"></span></a>）。</p><figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-5f8710d2507d4c05b77bbeb3b731774f_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"370\" data-original-token=\"v2-9ce851e07796e064aab05ab0eb31688b\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic2.zhimg.com/v2-5f8710d2507d4c05b77bbeb3b731774f_r.jpg\"/></figure><p data-pid=\"i1fY422Z\">Dify默认支持基本上所有主流的模型厂商，添加时只要提供对应的模型Key即可（大多数只需要API Key即可）。如果不知道如何获取，有提示可直接Link到对应的网站去配置即可。例如下面的添加OpenAI模型，按照引导添加即可。</p><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-0d676201be0b5fddf5ca58f3688115dc_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"783\" data-original-token=\"v2-a0a0db7841c66f2c471f1f43b31ee910\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic3.zhimg.com/v2-0d676201be0b5fddf5ca58f3688115dc_r.jpg\"/></figure><p data-pid=\"31_Pp6Yv\"><b>设置用户权限：</b>企业内使用Dify时，一定有多个用户，所以我们一定要对用户进行权限的设置。例如，有时候针对创建好的智能体，普通用户只能使用，没有修改的权限等。如何设置呢？参照下图，同样在【设置】下，这次选择【成员】选项卡，在这里可以添加用户和对用户设置各种权限。</p><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-a63fea19deba33eff07dfd0870962ebc_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"851\" data-original-token=\"v2-f3042b1f5373448daa97b0243cb6e52a\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic1.zhimg.com/v2-a63fea19deba33eff07dfd0870962ebc_r.jpg\"/></figure><p data-pid=\"BFk3hN4f\"><b>功能介绍</b></p><p data-pid=\"FC3hvh1C\">下面，来介绍下Dify的基本功能：我个人认为，<b>核心功能就一个，那就是创建智能体（包括工作流也算，只不过默认提供了五种模式）。还有一个辅助的功能，一个简陋版的知识库创建和检索功能。</b></p><p data-pid=\"-zrF_K73\"><b>五种智能体模式：</b></p><p data-pid=\"RWgrueQl\">聊天助手：简单配置即可构建基于 LLM 的对话机器人。</p><p data-pid=\"jtvgVmEN\">Agent：具备推理与自主工具调用的智能助手</p><p data-pid=\"Rxr9RDJg\">文本生成应用：用于文本生成任务的 AI 助手</p><p data-pid=\"ITU0HAw3\"><b>Chatflow：支持记忆的复杂多轮对话工作流</b></p><p data-pid=\"wKhQn8cV\">工作流：面向单轮自动化任务的编排工作流</p><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-0c0c1cde169e69418534cee13937c96b_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"488\" data-original-token=\"v2-4ea22af088828e658d16c49e2693eeda\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-0c0c1cde169e69418534cee13937c96b_r.jpg\"/></figure><p data-pid=\"dpJvOeFk\">大家不要被上面写的啥新手适用或进阶用户适用给唬住了，其实提供这五种，最后你会发现，最常用的，就是Chatflow。</p><p data-pid=\"WK7LvBzV\"><b>知识库：</b></p><p data-pid=\"SXAaaYo-\">知识库默认支持两种方式，如果是简单的场景，我们可以直接在Dify中创建知识库，后续引用即可。但我上面也说了，他默认的知识库功能有限，所以<b>还支持连接外部的知识库</b>，例如后面我会演示，如何外接RAGFlow知识库，这种场景企业用的或许多一些。</p><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-33a4b47e25adf5327716e98263689b9c_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"209\" data-original-token=\"v2-fe2c2959401b0d46f12bec6551de5d38\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pica.zhimg.com/v2-33a4b47e25adf5327716e98263689b9c_r.jpg\"/></figure><p data-pid=\"fl0rmrfY\"><b>其他功能：工具（插件）</b></p><p data-pid=\"QEgaVNA1\">工具，也可以叫做插件，它是辅助创建智能体用的。Dify的插件市场里有着各种各样的插件，可以满足我们创建智能体时连接外部应用的需求。例如后面会给大家演示最近爆火的MCP插件如何使用，去创建智能体。当然也可以写代码去自定义插件，官方文档有着详细的教程，这里不过多解释了。</p><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-bf870155f84279c51e8b632756b8380b_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"623\" data-original-token=\"v2-8c4c8ee6b153f536aac2551a05072a56\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-bf870155f84279c51e8b632756b8380b_r.jpg\"/></figure><p data-pid=\"uyqbEfqz\"><b>其他功能：多语言</b></p><p data-pid=\"nWyNn_2s\">Dify支持多语言，可在设置中进行切换。</p><figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-96459a15ab01a4d6b7be871dc8de4e83_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"391\" data-original-token=\"v2-1cd4e0770d07b7a9c79076d21648b0b8\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic2.zhimg.com/v2-96459a15ab01a4d6b7be871dc8de4e83_r.jpg\"/></figure><p data-pid=\"y4bBQdy1\"><b>知识库实战1：Dify中创建知识库</b></p><p data-pid=\"YgTgQ5qu\">下面，我们先在Dify中创建知识库。我们在知识库菜单下，单击【创建知识库】</p><figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-2807bdac224e97cb54d0b6f73e502fa7_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"292\" data-original-token=\"v2-11873a51f5a1daecf1c1cc5596c8ab4b\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic2.zhimg.com/v2-2807bdac224e97cb54d0b6f73e502fa7_r.jpg\"/></figure><p data-pid=\"JZFB9rdh\">然后我们在导入已有文本选项卡下，选择上传我们要作为知识库的文件。例如我这里上传了一个《中国AI智慧操场行业研究报告》的pdf文档。然后单击【下一步】。</p><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-19fa2517409482aceb9b9ba885caf56c_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"593\" data-original-token=\"v2-f1efb5677df807d6916ef27fb948d082\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic1.zhimg.com/v2-19fa2517409482aceb9b9ba885caf56c_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-c7b3d1826651cad3e6ef3fe43c3c43c0_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"608\" data-original-token=\"v2-512c41e4623b51f37102fb46c03e92df\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pica.zhimg.com/v2-c7b3d1826651cad3e6ef3fe43c3c43c0_r.jpg\"/></figure><p data-pid=\"6oyDK0F0\">然后我们进入到了知识库设置的详细页面了。如果你有RAG基础的话，这个页面整体使用起来会相对容易些，否则你需研究一下。</p><p data-pid=\"4a8IWi_a\">首先，先重点看分段设置这个区域，这里可以对【分段标识符】、【分段最大长度】、【分段重叠长度】、是否【替换掉连续的空格、换行符和制表符】、【删除所有 URL 和电子邮件地址】等进行设置。</p><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-14d18f32d265e1cd557858aba035a807_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"619\" data-original-token=\"v2-5b3927372f9913c0c96f1949a15fcce2\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-14d18f32d265e1cd557858aba035a807_r.jpg\"/></figure><p data-pid=\"di9Vqhky\">如果不知道怎么设置这部分，默认就可以，或者看问号的提示进行设置（后续其他地方也是一样，不知道的话，看问号的提示）。</p><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-53e473d61832ae1a1b5268984ae7976d_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"629\" data-original-token=\"v2-3edad77a45b47a70edbe66a1f439c790\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-53e473d61832ae1a1b5268984ae7976d_r.jpg\"/></figure><p data-pid=\"pshRDu7W\">其次，我们关注第二个部分，索引方式这里，我们选择默认的【高质量】就可以。然后下面这个部分，我们必须选择一个<b>Embedding的模型</b>，这里需要先确保，我们在模型设置的页面，添加的模型厂商中，有Embedding模型才可以，否则这里选不到。类似于我下面的，选择是阿里的【text-embedding-v3】的模型。</p><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-3479d10a545a818440ba3ce44bce0841_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"834\" data-original-token=\"v2-ee2e4ccf6c2bed1d71124dcac93a4b67\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-3479d10a545a818440ba3ce44bce0841_r.jpg\"/></figure><p data-pid=\"pcn67IDM\">最后，我们要关注检索设置这个区域了。里面提供了三种检索方式【向量检索】、【全文检索】、【混合检索】。其实知识库检索的本质，就是你上传的文档，通过embedding处理，转换为了向量存储在向量数据库了，最后检索是从向量数据库进行的检索。所以下面这三种，各有各的优点和使用场景，大家根据需要选择即可。这里我选择【混合检索】，我一般这种用的多，感觉检索出来的结果更加准确。</p><p data-pid=\"JgU7dW1y\"><b>三种检索方式：</b></p><p data-pid=\"NCYeB5jO\">向量检索：通过生成查询嵌入并查询与其向量表示最相似的文本分段</p><p data-pid=\"S8LHZxSf\">全文检索：索引文档中的所有词汇，从而允许用户查询任意词汇，并返回包含这些词汇的文本片段</p><p data-pid=\"t27AOpoG\">混合检索：同时执行全文检索和向量检索，并应用重排序步骤，从两类查询结果中选择匹配用户问题的最佳结果，用户可以选择设置权重或配置重新排序模型</p><p data-pid=\"6BTycJJ_\"><b>权重与Rerank方式：</b></p><p data-pid=\"nhs8-RxS\">其次，在混合检索下，有两个选项，一个是权重方式进行检索，一个是Rerank模型方式进行检索。这里也简单解释下，如果选择了Rerank模型方式，你需要从你之前添加的模型厂商中选择一个Rerank模型才可以（很多模型厂商是没有的，大一些的模型厂商会有Rerank模型），Rerank模型的作用是，可以根据候选文档列表与用户问题语义匹配度进行重新排序，从而改进语义排序的结果，简单理解就是从检索结果中，把更符合你问题的那些chunk片段排在最前面展示出来。这里我们选择另外一个，权重设置，通过调整下面的语义和关键字的比例来对内容进行检索，这里我就不设置了，默认用语义0.7和关键字0.3的比例。然后最后两个参数，Top k是指检索出几个Chunk片段，如果开启Score阈值，只有检索结果的Score分数高于阈值时才会被检索出来，我们默认就关闭即可。（这里还要特殊说明一下，在知识库创建时进行设置的Top K 和 Score 值，在后续检索时发现还会有有地方还让你设置，但是会受这里创建时所设定的值制约如。例如后续我创建知识库这里TopK设置成了3，但是你创建智能体用知识检索时你把Top K设置成了5，但检索的结果还会是3，这个地方要注意，后面对应有地方还会说这个事）</p><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-97ae8b6beb1c54128ec2151fc914b2a4_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"819\" data-original-token=\"v2-45c3fc60e9af558b3826f7f64c36e827\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pica.zhimg.com/v2-97ae8b6beb1c54128ec2151fc914b2a4_r.jpg\"/></figure><p data-pid=\"4QK7jy1a\">然后我们点击【保存并处理】，开始文档向量化的过程。下面可以看到，向量化（嵌入）成功了。然后我们点击【前往文档】，可以进行查看。</p><figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-3ff9563731440158a9a832510fbe3ae5_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"537\" data-original-token=\"v2-02d4652b09cdb2f027a3308b16a31da0\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic2.zhimg.com/v2-3ff9563731440158a9a832510fbe3ae5_r.jpg\"/></figure><p data-pid=\"6We4Yn8g\">我们点击我们上传的文档后可以发现，已经chunk成功了。到这里，知识库就算是创建成功了。</p><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-2d1fbe6635df6f328aa45c6506de4d32_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"946\" data-original-token=\"v2-c72c331102f6a9eb6d0ebf8aec785c63\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic1.zhimg.com/v2-2d1fbe6635df6f328aa45c6506de4d32_r.jpg\"/></figure><p data-pid=\"bUVP7mtw\">到这里还没有结束，我们点击左侧的第三个小图标，对知识库进行设置，可以对知识库名称、知识库描述和可见权限等进行设置。<b>这里尤其要关注权限设置</b>，默认是只有知识库创建的本人，也就是只有我才能看见，如果你需要让所有的团队成员或部分团队人员可见，一定别忘了修改知识库的权限。</p><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-53194f4336228d29844dd8cbf60a43ba_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"702\" data-original-token=\"v2-fb0aa7a6ce59bce9dcebea29aed54295\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic3.zhimg.com/v2-53194f4336228d29844dd8cbf60a43ba_r.jpg\"/></figure><p data-pid=\"8p4y11T9\">我们知识库创建也创建成功了，设置也设置了，那该最后一步了，我们检索试试吧。我们点击左侧的第二个图标，进行检索测试。在文本框中输入【中国AI智慧操场行业发展历程】，然后点击【测试】按钮，即可发现右边出现了三个结果。（出现三条是因为Top k之前设置的是3，每一条的右上角还有对应的Score分数，所以如果你之前设置了Score的值，只有高于你设置Score的片段才可以检索出来。）</p><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-b067442634d399eda767d7d4e1e1ca37_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"412\" data-original-token=\"v2-0e2237ac1bc788aa31349c2b6206ed93\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-b067442634d399eda767d7d4e1e1ca37_r.jpg\"/></figure><p data-pid=\"0MV29FB9\">到这里，才算是真正用Dify创建知识库成功了，并且可以检索出来，撒花   。其中有很多设置的参数，上面只是简单的解释了下，如果需要玩好知识库这部分，回去一定要积累RAG领域的知识，或者参考Dify的官方文档，看每一个知识库设置的参数是干什么用的，然后去进行各种尝试和学习，这样才能创建好和用好知识库（主要是知识库的检索，因为我们创建知识库的目的，就是为了检索）。</p><p data-pid=\"c8orduHa\"><b>知识库实战2：Dify中连接外部知识库</b></p><p data-pid=\"TzwvT1MD\">Dify默认的知识库其实不咋好用，简单的场景还可以，复杂的场景就没办法了，所以我们大多数时候，是连接外部知识库进行检索（本质上是API）。而在开源领域，之前也说了，最接近企业级应用的是RAGFlow知识库，所以我们这一部分，教大家Dify如何接入RAGFlow。首先，我们在知识库右上角选择【外部知识库API】-&gt;【添加外部知识库API】，去填写连接RAGFlow的相关信息。其中【Name】随便填，例如我这下面写的是RAGFlow、<b>API Endpoint这里要注意，是RAGFlow的domain + 【/api/v1/dify】，这个是固定的</b>，例如我RAGFlow的domain是下面的【<a href=\"https://link.zhihu.com/?target=https%3A//108dq967ds407.vicp.fun\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">https://</span><span class=\"visible\">108dq967ds407.vicp.fun</span><span class=\"invisible\"></span></a>】，那最后的Endpoint拼接【/api/v1/dify】就是【<a href=\"https://link.zhihu.com/?target=https%3A//108dq967ds407.vicp.fun/api/v1/dify\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">https://</span><span class=\"visible\">108dq967ds407.vicp.fun/</span><span class=\"invisible\">api/v1/dify</span><span class=\"ellipsis\"></span></a>】。最后的API Key就是RAGFlow的key。</p><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-bcd7398b6ea7ca7527cfc1ba0dda3e7b_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"700\" data-original-token=\"v2-8036882f23eeb33df77da4c16e691af6\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-bcd7398b6ea7ca7527cfc1ba0dda3e7b_r.jpg\"/></figure><p data-pid=\"JhGt0eVX\">具体RAGFLow和Dify的设置对应关系参照下图：</p><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-591453d672118984b10ed178e6526430_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"296\" data-original-token=\"v2-4813b48e0a244aa527537506cac2e222\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic1.zhimg.com/v2-591453d672118984b10ed178e6526430_r.jpg\"/></figure><p data-pid=\"5FZfqyId\">其次，我们在创建知识库部分，点击【连接外部知识库】，去连接RAGFlow中的知识库。其中要注意两个地方，第一个，【外部知识API】选择你上面创建的即可，例如我的叫【RAGFlow】，还有一个【外部知识库ID】，因为RAGFlow中有很多知识库，但我们只是连接其中的一个，所以要输入对应RAGFlow知识库的ID。</p><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-d4f76685cedccc4418333cb2408cb8b3_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"1193\" data-original-token=\"v2-b01f552af214d317a177446d6f1c23b5\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-d4f76685cedccc4418333cb2408cb8b3_r.jpg\"/></figure><p data-pid=\"rGE4hqeE\">具体RAGFlow知识库的ID怎么找呢，参照下图即可，展示了RAGFlow与Dify的对应关系。</p><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-ca32b2fa89faf0a286aecf8022f5a467_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"372\" data-original-token=\"v2-38df67cc69a975de966e87243eeb0801\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://picx.zhimg.com/v2-ca32b2fa89faf0a286aecf8022f5a467_r.jpg\"/></figure><p data-pid=\"Mmyoi5GF\">到这里，外连RAGFlow知识库就创建成功了，下一步还是和之前一样，测试一下。例如我问它，第一章内容是什么，Dify通过API的方式，背后连接RAGFlow对应的2025年中国人工智能计算力发展评估报告知识库，查询出了结果。到此处，搞定，继续撒花   。</p><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-a7c75b677bdedf829aff0a2937e9ca3b_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"280\" data-original-token=\"v2-8da80d997f5abb2f623bac97e5e6e3fc\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-a7c75b677bdedf829aff0a2937e9ca3b_r.jpg\"/></figure><p data-pid=\"OjrkLfr5\"><b>下面让我们继续进行，进入到创建智能体部分，首先是最简单的，创建一个聊天模式的智能体。</b></p><p data-pid=\"DOOU5XNV\"><b>智能体实战1：最简单的聊天模式</b></p><p data-pid=\"zYmScR-j\">下面让我们继续进行，进入到创建智能体部分，首先是最简单的，创建一个聊天模式的智能体。这里我们不从0创建，找一个Dify预制的聊天模式智能体进行讲解。（不要问我为什么不带着大家创建，因为实在是太简单了......讲解能听明白了，后面你肯定更容易创建）</p><p data-pid=\"JF3yTreq\">我们在最上面的探索菜单中，可以看到Dify默认了一堆智能体（实话，我都研究过，不咋好用......参考学习还可以），这里我们选择标签是【聊天助手】的智能体：【会议纪要】，然后添加到工作区。</p><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-8819b3296f47ee72768a6331ba9b2fdc_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"553\" data-original-token=\"v2-188c80d4c78ed0ca7dcc5a814ed270f1\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic3.zhimg.com/v2-8819b3296f47ee72768a6331ba9b2fdc_r.jpg\"/></figure><p data-pid=\"YF6cNTfq\">添加成功后，我们在【工作室】选项卡就可以看到【会议纪要】智能体了。（工作室菜单是DIfy最核心的菜单，你的智能体，创建后都会在里面显示）</p><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-5d1a1a5408fe8f743500f466664bee1b_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"447\" data-original-token=\"v2-61cda6fa4095a839af369f4ae3d94703\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-5d1a1a5408fe8f743500f466664bee1b_r.jpg\"/></figure><p data-pid=\"ZzCWkjEh\">点进去之后，可以发现真是特别简单，左侧通过提示词限定了【会议纪要】的功能，然后在右侧最上角，切换成你的模型就可以使用了。</p><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-360dbebc11340ad3458e28035a3cbc44_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"619\" data-original-token=\"v2-86175f8bd85782c39c57742dd7f3f085\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pica.zhimg.com/v2-360dbebc11340ad3458e28035a3cbc44_r.jpg\"/></figure><p data-pid=\"pZhdYtP_\">切换模型后，点击【发布】，选择【发布更新】进行保存。</p><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-718723df8c04e58985c31f43e975cd77_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"304\" data-original-token=\"v2-21ce6f4f75bacb737a800fc1ab512979\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://picx.zhimg.com/v2-718723df8c04e58985c31f43e975cd77_r.jpg\"/></figure><p data-pid=\"KPb5co6v\">然后我们来测试一下，点击【运行】后，进入到使用页面，我输入了下面如图所示的会议内容。</p><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-5a4f6044ff8540a2e463601f896270d6_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"813\" data-original-token=\"v2-3a1801b73d05f943e72b95ccf997bcc0\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pica.zhimg.com/v2-5a4f6044ff8540a2e463601f896270d6_r.jpg\"/></figure><p data-pid=\"rmZBmvXc\">然后会议纪要的智能体给出了结果，结束，撒花   ，第一个智能体，就是那么简单。</p><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-657c03aa3d07cc75dc676a41ebd12fa4_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"1733\" data-original-token=\"v2-7b88eecfca77d3b5d236499e05d34d6b\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic3.zhimg.com/v2-657c03aa3d07cc75dc676a41ebd12fa4_r.jpg\"/></figure><p data-pid=\"_AIc2qEj\"><b>智能体实战2：Agent模式</b></p><p data-pid=\"tohtAZ94\">下面，我们再来看第二个模式，个人感觉要被淘汰掉的传统Agent模式（最后再来告诉大家为啥要被淘汰了）。同样，我们也不创建，看Dify预置的一个例子【YouTube 频道数据分析】。</p><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-30561ac7257e043772c3e9991bd30194_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"1006\" data-original-token=\"v2-62b05ad640e7185407135f1c1130cc29\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic3.zhimg.com/v2-30561ac7257e043772c3e9991bd30194_r.jpg\"/></figure><p data-pid=\"QD8zMicX\">这个需要安装工具，安装即可。</p><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-4d46c3efad4273639dcaf3494015c16a_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"618\" data-original-token=\"v2-726dddc0849ca1d024fb72253abf89b4\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pica.zhimg.com/v2-4d46c3efad4273639dcaf3494015c16a_r.jpg\"/></figure><p data-pid=\"zg1O5RuK\">然后发现这个智能体主要分为三个部分，除了我们之前讲过的【提示词】和【模型】两部分，多了一个【工具】的部分，也就是刚才安装的那些插件。</p><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-d1b135698884d5f9f29b9637d0590b97_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"526\" data-original-token=\"v2-736a0834544e46e4c30d3e91812309a6\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-d1b135698884d5f9f29b9637d0590b97_r.jpg\"/></figure><p data-pid=\"cITWJ96I\">这里简单说明下，如果大家之前有过创建智能体的经验，这部分很简单。这种智能体的玩法，就是在Prompt中，定义好角色、技能、工作流程（或者叫工作步骤）、限定条件这四大部分。角色：告诉你这智能体是干嘛的，能做什么。技能：该智能体拥有的技能（或插件），也就是下面工具部分那几个工具。工作流程：规定该智能体的操作步骤，每一步应该干什么，调用什么工具去完成什么任务。限定条件：对该智能体设定一些规则。这样，就可以在智能体执行的过程中，调用对应的工具完成任务。</p><p data-pid=\"W9r_J40O\">具体不给大家演示了，下面来聊聊为什么我认为，这种模式，以后使用的场景越来越少，甚至夸张点说，淘汰掉吧（完全个人观点，不赞成勿喷）。</p><p data-pid=\"P7NhAau4\">1、首先，这种智能体模式是早期，在2023年和2024年初的主流模式，处理简单的场景还可以，但是复杂的场景下，就得上工作流。并且Agent模式可以做的，工作流模式一定能做，反过来，工作流模式支持的复杂业务流程，这种Agent模式不一定能完成。所以这种Agent模式现在存在感就很鸡肋，反正我是基本上没用过。</p><p data-pid=\"iA56mlEO\">2、其次，现在多数场景下，我们用的都是推理模型，推理模型是不吃设定角色那一套玩法的，大家可以去看看DeepSeek-R1推荐的Prompt写法，我就不多说了。</p><p data-pid=\"qRzZa7xT\">3、现在MCP都出来了，谁还玩Function Call那一套的工具调用模式，过去的那一套Agent玩法太复杂，而且有时候模型还不听话调用错工具。但是这种Agent模式还存在，肯定有他的价值，但是写法上我们要改变，下面我给大家展示一个Agent模式连接MCP的例子。</p><p data-pid=\"v0NuQnum\"><b>智能体实战3：整合MCP</b>今天的最后，放一个大招，给大家演示下，Dify如何在Agent模式下整合MCP。关于MCP的基本概念，这里就不细说了，大家如果不了解的话，以后还想玩AI方向的话，强烈建议必须查一查。1、安装MCP插件。在【工具】-&gt;【探索Marketplace】-&gt;搜索MCP-&gt;安装插件【MCP SSE / StreamableHTTP】。我之前已经安装过了，所以点进去后，显示安装成功。</p><figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-50bfce5d9845728cf9a7dcedd14c16bd_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"795\" data-original-token=\"v2-c131e9ea2b05b9a116bf1d91e16a5dad\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic2.zhimg.com/v2-50bfce5d9845728cf9a7dcedd14c16bd_r.jpg\"/></figure><p data-pid=\"rNXHYBGx\">2、配置MCP。这一步很关键。首先点右上角的【插件】，可以看到你安装过的所有插件，然后选择刚才我们安装的MCP插件【MCP SSE / StreamableHTTP】，需要在右侧进行设置。因为我这里设置完了，所以显示已授权，下面教大家如何设置。</p><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-fc172acf491232e44a059fdb41a5b97a_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"519\" data-original-token=\"v2-ff7fe6af295bb45d3d181fa04fc21cb0\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic1.zhimg.com/v2-fc172acf491232e44a059fdb41a5b97a_r.jpg\"/></figure><p data-pid=\"98uBZJ-r\">点开之后，会发现，主要就配置一个MCP的Server地址，这里我们用的是Zapier平台去获取这个Server地址才行。</p><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-1a5b7aa5e6f12c90466f42dff09e073b_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"808\" data-rawheight=\"482\" data-original-token=\"v2-3d8e64ce0316667f5e7e6cbea415d221\" class=\"origin_image zh-lightbox-thumb\" width=\"808\" data-original=\"https://picx.zhimg.com/v2-1a5b7aa5e6f12c90466f42dff09e073b_r.jpg\"/></figure><div class=\"highlight\"><pre><code class=\"language-text\">{  &#34;server_name&#34;: {    &#34;url&#34;: &#34;XXXXXX&#34;,    &#34;headers&#34;: {}, &#34;timeout&#34;: 50,    &#34;sse_read_timeout&#34;: 50  }}</code></pre></div><p data-pid=\"HcQupZ5a\"><b>Zapier平台MCP Server地址获取方法：</b>1）、访问地址：<a href=\"https://link.zhihu.com/?target=https%3A//mcp.zapier.com/mcp\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"><span class=\"invisible\">https://</span><span class=\"visible\">mcp.zapier.com/mcp</span><span class=\"invisible\"></span></a> 后，在Tools下点击【Add tool】去搜索 + 配置你想添加的MCP工具即可（只需参照步骤操作操作添加，需要各种授权，这里就不一步步演示了）。下图是我添加的Google邮箱发送邮件的MCP工具。</p><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-47341e3e1a06f3fb16ec3ae01dbd8be1_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"278\" data-original-token=\"v2-58adae2893646a5e96b9866c9de3a9bb\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://picx.zhimg.com/v2-47341e3e1a06f3fb16ec3ae01dbd8be1_r.jpg\"/></figure><p data-pid=\"spVFAIjX\">2）、在Connect选项卡中，选择一个MCP协议，选StreamableHTTP或SSE协议哪个都行，反正我们上面的DIfy插件都支持，然后Copy MCP Server的路径后，配置到Dify中即可。</p><figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-1ceeb45360f751a284cf812b78722243_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"768\" data-original-token=\"v2-d534e56b2c47c4df08701cb19445de59\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic2.zhimg.com/v2-1ceeb45360f751a284cf812b78722243_r.jpg\"/></figure><p data-pid=\"rq66hbEH\">整体在Dify配置成功后，就是和我上面的图一样，是Dify会显示<b>已授权</b>的状态。</p><p data-pid=\"PdPLvzs5\">3、创建Agent应用。我们选择【创建空白应用】-&gt;选择【Agent】模式，然后给应用起个名字，例如我的叫MCP-Demo。</p><figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-a2d714e7af131ded4fe9c4183c55594b_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"1219\" data-original-token=\"v2-fe9594fe6f085243d70937c7fb1ebfd9\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic2.zhimg.com/v2-a2d714e7af131ded4fe9c4183c55594b_r.jpg\"/></figure><p data-pid=\"Xt941dGk\">4、配置模型和添加MCP工具。然后进去之后非常简单，我们提示词啥也不用写，就右上角配置个模型，在工具部分，添加刚才安装和配置成功的MCP工具即可（安装插件确实安装了一个，但其实是两个工具，一个是查找MCP工具列表，一个是调用MCP工具）</p><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-3e86acdbe1117bda72159ce44123bf2e_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"607\" data-original-token=\"v2-84062cdf3acccee203276dfc3c16852f\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic1.zhimg.com/v2-3e86acdbe1117bda72159ce44123bf2e_r.jpg\"/></figure><p data-pid=\"6jMrcv6U\">5、运行测试。我就说了一句话，让他给我自己的QQ邮箱发个邮件，告诉它发送主题和内容，然后就没有然后了，发送成功了。我下面还故意没写邮件的主题，他会提示你必须要有主题。是不是很方便，比你之前那种Agent写法，又的设置角色、又得设置技能、又得告诉它每一步咋做（类似于这个你要写的话，你的告诉他第一步找到发送邮件的工具，第二步发送啥的，太麻烦）。现在的做法提示词里面啥都没写，直接用就可以，你告诉他你要发邮件，他会自己调用MCP的列表工具和找寻合适的工具去执行。</p><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-a0474852af3eb8119395b8993b839087_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"475\" data-original-token=\"v2-370501316d684317fdfc74e575d70687\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic4.zhimg.com/v2-a0474852af3eb8119395b8993b839087_r.jpg\"/></figure><p data-pid=\"R0YiLy7E\">收到的邮件。</p><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-7cd5f6a92a08e73e24871a03f505c48f_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"712\" data-rawheight=\"390\" data-original-token=\"v2-2578d5ce8dc4b640db70c54353361fbe\" class=\"origin_image zh-lightbox-thumb\" width=\"712\" data-original=\"https://picx.zhimg.com/v2-7cd5f6a92a08e73e24871a03f505c48f_r.jpg\"/></figure><p data-pid=\"pl8w60rL\">撒花   ，Dify连接MCP这一部分结束。<b>---------</b>因为篇幅过长的原因，Dify教程预计分为两部分，这篇是上半部分，下半部分后续也会尽快更新，尽情期待。</p><p data-pid=\"V3ueQfz9\">很多想入行大模型的人苦于现在网上的大模型<code>老课程老教材</code>，学也不是不学也不是，基于此我用做产品的心态来打磨这份<code>大模型教程</code>，深挖痛点并持续修改了近<code>100 余次</code>后，终于把整个AI 大模型的学习门槛，<b>降到了最低</b>！</p><p data-pid=\"MiKzx2AY\">这份大模型教程已经给大家<code>整理并打包分享出来</code>, 有需要的小伙伴，可以 <b>点击下方知乎小卡片前往获取</b> ↓↓↓</p><blockquote data-pid=\"7fq3zwwL\">ass=&#34;nolink&#34;&gt;知乎大礼包 ：全网最全《LLM 大模型学习资源包》免费分享（安全资料，放心领取）</blockquote><a href=\"https://zhuanlan.zhihu.com/p/1925969219985577539\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\"internal\">2025年，AI大模型全套入门学习教程：免费分享AI大模型入门学习礼包</a><p></p>",
        "is_labeled": false,
        "visited_count": 4364,
        "thumbnails": [
          "https://picx.zhimg.com/50/v2-50ae0879eee71a6fc5b26875d4d835c8_720w.jpg?source=b6762063",
          "https://pic1.zhimg.com/50/v2-8eb4edac5e9b88922517d261250d5576_720w.jpg?source=b6762063",
          "https://pica.zhimg.com/50/v2-9c2c7bcc2543f30cba0ee6444060c88e_720w.jpg?source=b6762063",
          "https://pic1.zhimg.com/50/v2-62b7637f5fc24f4278cf880abdb39333_720w.jpg?source=b6762063",
          "https://pica.zhimg.com/50/v2-557658a91d45493c903bdc30d4bbe39a_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-e4b6b6961d8899695a5cfec24be3e08d_720w.jpg?source=b6762063",
          "https://pica.zhimg.com/50/v2-eb79c89ee2fad30832e3354aa54ae83f_720w.jpg?source=b6762063",
          "https://pic1.zhimg.com/50/v2-1f92f18789c24d865b1ccb0973714881_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-ae6adf8b93baac9e4294acd5f8f3f509_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-3f6068bf413f2955794e03574c85ecf8_720w.jpg?source=b6762063",
          "https://pica.zhimg.com/50/v2-58146f61b011543f0166a2a7d67f0cfd_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-4e762baccb2ebe072239c5ee094cdfcd_720w.jpg?source=b6762063",
          "https://pic1.zhimg.com/50/v2-d97cddc421f7618c1520694aa62296af_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-7f3f718711e86fe787c71cd483891362_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-5e121676d5df80003b0441321b9efaed_720w.jpg?source=b6762063"
        ],
        "favorite_count": 33,
        "article_type": "normal",
        "is_navigator": false,
        "navigator_vote": false,
        "vote_next_step": "vote"
      },
      "brief": "{\"source\": \"TS\", \"type\": \"article\", \"id\": 1926657990729140203}",
      "attached_info": "CukUCLmHweq9gb3SvgEQBxoJMjYwMTY4MzIyIJPPvcMGKAgwAEDeBEoxCiZUU19TT1VSQ0VfVEVYVF9NVUxUSVZJRVdfR0NGX1VTRVJDRl9WMRIBMBgAIAA6AGIgZjA3NWJiMDBjMjlmNGMzMzYyNWE1OWJiMzUxYWUwYTdyEzE5MjY2NTc5OTA3MjkxNDAyMDOqAQlyZWNvbW1lbmTCASA2MDIwM2FmMzA5ZmIzMGNjMTU1YzljNjAzZjMzNmY1MvIBCggMEgZOb3JtYWzyASgIChIkMWE4YTBkMjctMTY2My00YjY5LTkyMzAtYjVmYjFhOGNjZmIy8gEHCAsSAzEwMoICAIgC1pnO+YwzkgIgNjAyMDNhZjMwOWZiMzBjYzE1NWM5YzYwM2YzMzZmNTKaAgDKAhVVc2VyTGNuRXhpdFdlaWdodFJ1bGXKAhdUZXN0ZWRBbmRXb3JrV2VpZ2h0UnVsZdoCJlRTX1NPVVJDRV9URVhUX01VTFRJVklFV19HQ0ZfVVNFUkNGX1Yx6AID+gILTk9STUFMX0ZMT1eKAyA4NDExNzYzNjM5NmM0MDZhYTNhMDEwMmMxOGE1ZmQ3ZZoDDQoCdjIQABoFb3RoZXKoA4wi2AMA6gMjZmVlZC10ZXh0LWFsbHNpdGUtb25saW5lLXVjZi1yZWNhbGz6A9UPEgxVTktOT1dOX01PREUgACoNTk9fSU1BR0VfTU9ERTotCAIQ1AcYigYiI3YyLTVlY2YyOTU1Yzc3ZDczZTBiZWJhZDE1YjNiYmVjYjJlOi0IAxC4CBjyAiIjdjItOWNlODUxZTA3Nzk2ZTA2NGFhYjA1YWIwZWIzMTY4OGI6LQgCELgIGI8GIiN2Mi1hMGEwZGI3ODQxYzY2ZjJjNDcxZjFmNDNiMzFlZTkxMDotCAQQuAgY0wYiI3YyLWYzMDQyYjFmNTM3MzQ0OGRhYTk3YjAyNDNjYjZlNTJhOi0IAhC4CBjoAyIjdjItNGVhMjJhZjA4ODgyOGU2NThkMTZjNDllMjY5M2VlZGE6LQgCELgIGNEBIiN2Mi1mZTJjMjk1OTQwMWIwZDQ2ZjEyYmVjNjU1MWRlNWQzODotCAIQuAgY7wQiI3YyLThjNGM4ZWU2YjE1M2Y1MzZhYWMyNTUxYTA1MDcyYTU2Oi0IAhC4CBiHAyIjdjItMWNkNGUwNzcwZDA3YjdhOWM3OTA3NmQyMTY0OGIwYjg6LQgCELgIGKQCIiN2Mi0xMTg3M2E1MWY1YTFkYWVjZjFjMWNjNTU5NmM4YWI0YjotCAIQuAgY0QQiI3YyLWYxZWZiNTY3N2RmODA3ZDY5MTZlZjI3ZmI5NDhkMDgyOi0IAhC4CBjgBCIjdjItNTEyYzQxZTQ2MjNiNTFmMzcxMDJmYjQ2YzAzZTkyZGY6LQgCELgIGOsEIiN2Mi01YjM5MjczNzJmOTkxM2MwYzk2ZjE5NDlhMTVmY2NlMjotCAIQuAgY9QQiI3YyLTNlZGFkNzdhNDViNDdhNzBlZGJlNjZhMWY0MzljNzkwOi0IAhC4CBjCBiIjdjItZWUyZTRjY2Y2YzJiZWQxZDcxMTI0ZGNhYzkzYTRiNjc6LQgCELgIGLMGIiN2Mi00NWMzZmM2MGU5YWY1NThiMzgyNmY3ZjY0YzM2ZTgyNzotCAIQuAgYmQQiI3YyLTAyZDQ2NTJiMDljZGIyZjAyN2EzMzA4YjE2YTMxZGEwOi0IAhC4CBiyByIjdjItYzcyYzMzMTEwMmY2YTllYjZkMGViZjhhZWM3ODVjNjM6LQgCELgIGL4FIiN2Mi1mYjBhYTdhNmNlNTliY2U5ZGNlYmVhMjlhZWQ1NDI5NTotCAIQuAgYnAMiI3YyLTBlMjIzN2FjMWJjNzg4YWEzMTM0OWMyYjYyMDZlZDkzOi0IAxC4CBi8BSIjdjItODAzNjg4MmYyM2VlYjMzZGY3N2RhNGMxNmU2OTFhZjY6LQgDELgIGKgCIiN2Mi00ODEzYjQ4ZTBhMjQ0YWE1Mjc1Mzc1MDZjYWMyZTIyMjotCAIQuAgYqQkiI3YyLWIwMWY1NTJhZjIxNGQzMTdhMTc3NDQ2ZDZmMWMyM2I1Oi0IAxC4CBj0AiIjdjItMzhkZjY3Y2M2OWE5NzVkZTk2NmU4NzI0M2VlYjA4MDE6LQgCELgIGJgCIiN2Mi04ZGE4MGQ5OTdmNWFiYjJmNjIzYmFjOTdlNWU2ZTNmYzotCAIQuAgYqQQiI3YyLTE4OGM4MGQ0Yzc4ZWQwY2E3ZGNjNWE4MTRlZDI3MGYxOi0IAhC4CBi/AyIjdjItNjFjZGE2ZmE0MDk1YTgzOWFmMzY5ZjRhZTNkOTQ3MDM6LQgCELgIGOsEIiN2Mi04NjE3NWY4YmQ4NTc4MmMzOWM1Nzc0MmRkN2YzZjA4NTotCAIQuAgYsAIiI3YyLTIxY2U2ZjRmNzViYWNiNzM3YTgwMGZjMWFiNTEyOTc5Oi0IAhC4CBitBiIjdjItM2ExODAxYjczZDA1Zjk0M2U3MmI5NWNjZjk5N2JjYzA6LQgCELgIGMUNIiN2Mi03Yjg4ZWVjZmNhNzdkM2I1ZDIzNjQ5OWUwNWQzNGQ2YjotCAIQuAgY7gciI3YyLTYyYjA1YWQ2NDBlNzE4NTQwNzEzNWYxYzExMzBjYzI5Oi0IAhC4CBjqBCIjdjItNzI2ZGRkYzA4NDljYTFkMDI0ZmI3MjI1M2FiZjg5YjQ6LQgCELgIGI4EIiN2Mi03MzZhMDgzNDU0NGU0NmU0YzMwZDNlOTE4MTIzMDlhNjotCAMQuAgYmwYiI3YyLWMxMzFlOWVhMmIwNWI5YTExNmJmMWQ5MWUxNmE1ZGFkOi0IAxC4CBiHBCIjdjItZmY3ZmU2YWYyOTViYjQ1ZDNkMTgxZmEwNGZjMjFjYjA6LQgCEKgGGOIDIiN2Mi0zZDhlNjRjZTAzMTY2NjdmNWU3ZTZjYmVhNDE1ZDIyMTotCAIQuAgYlgIiI3YyLTU4YWRhZTI4OTM2NDZhNWU5NmI5ODY2YzlkZTNhOWJiOi0IAhC4CBiABiIjdjItZDUzNGU1NmIyYzQ3YzRkZjA4NzAxY2IxOTQ0NWRlNTk6LQgDELgIGMMJIiN2Mi1mZTk1OTRmZTZmMDg1MjQzZDcwOTM3YzdmYjFlYmZkOTotCAIQuAgY3wQiI3YyLTg0MDYyY2RmM2FjY2NlZTIwMzI3NmRmYzNjMTY4NTJmOi0IAhC4CBjbAyIjdjItMzcwNTAxMzE2ZDY4NDMxN2ZkZmM3NGU1NzVkNzA2ODc6LQgCEMgFGIYDIiN2Mi0yNTc4ZDVjZThkYzRiNjQwZGI3MGM1NDM1MzM2MWZiZYAEAIgEAJIEBk5vcm1hbJoEATOgBACoBACwBAC6BAJhacIEAzQwMMgEANIED+aOqOiNkOW3suabtOaWsNgEAPAEAPkEAAAAwD/mlD+BBQAAAAAAAAAAiQW45Ei9E1TZP5IFAJoFA2RmdKIFA2RmdLIFATG5BQAAAAAAAAAA0AUA4AUA6AUA8AVmkAYAoAbkBKgGAZICLgoJMjYwMTY4MzIyEhMxOTI2NjU3OTkwNzI5MTQwMjAzGAciCklNQUdFX1RFWFQ=",
      "action_card": false
    },
    {
      "id": "607_1755822919.44",
      "type": "feed",
      "offset": 607,
      "verb": "TOPIC_ACKNOWLEDGED_ANSWER",
      "created_time": 1755822919,
      "updated_time": 1755822919,
      "target": {
        "id": "1908529737623638816",
        "type": "answer",
        "url": "https://api.zhihu.com/answers/1908529737623638816",
        "author": {
          "id": "d70c61f96d8e9b797cb565dc5827ccc2",
          "url": "https://api.zhihu.com/people/d70c61f96d8e9b797cb565dc5827ccc2",
          "user_type": "organization",
          "url_token": "liang-gong-hui-tu-hua-liu-cheng-tu",
          "name": "良功绘图网站",
          "headline": "免费在线制作 流程图、架构图、平面图，有模板、很简单！",
          "avatar_url": "https://picx.zhimg.com/50/v2-4e821309274edc2f81ae32b5b6840e28_l.jpg?source=b6762063",
          "is_org": true,
          "gender": -1,
          "badge": [
            {
              "type": "identity_org",
              "description": "已认证机构号"
            }
          ],
          "followers_count": 49,
          "is_following": false,
          "is_followed": false
        },
        "created_time": 1747808948,
        "updated_time": 1747808948,
        "voteup_count": 28,
        "thanks_count": 3,
        "comment_count": 0,
        "is_copyable": true,
        "question": {
          "id": "615575117",
          "type": "question",
          "url": "https://api.zhihu.com/questions/615575117",
          "author": {
            "id": "dbea9475112da5a0ecdef52821a70774",
            "url": "https://api.zhihu.com/people/dbea9475112da5a0ecdef52821a70774",
            "user_type": "people",
            "url_token": "yyfwfx",
            "name": "ONE行锋",
            "headline": "介绍一款好用免费的流程图软件",
            "avatar_url": "https://pica.zhimg.com/50/v2-705bb74383810b1ee1d398058cb48735_l.jpg?source=b6762063",
            "is_org": false,
            "gender": -1,
            "followers_count": 47,
            "is_following": false,
            "is_followed": false
          },
          "title": "如何绘制流程图？",
          "created": 1691114387,
          "answer_count": 0,
          "follower_count": 0,
          "comment_count": 0,
          "bound_topic_ids": [
            505,
            21943,
            90143,
            245172,
            1426891
          ],
          "is_following": false,
          "excerpt": "",
          "relationship": {
            "is_author": false
          },
          "detail": "",
          "question_type": "normal"
        },
        "thumbnail": "https://pic1.zhimg.com/50/v2-01a3ae0e4e78e219db59049666fe7027_720w.jpg?source=b6762063",
        "excerpt": "画流程图的核心在于逻辑清晰、结构简洁，同时兼顾易读性和美观性。以下是 主要步骤和实用技巧的详细解析，帮助你高效完成流程图设计： 1. 明确流程目标与范围问清需求：这是什么类型的流程？（业务流程、技术流程、项目流程等）核心环节是什么？是否需要展示分支或异常处理？目标受众是谁？（管理层看全局，执行层看细节）示例：若绘制 “电商订单处理流程”，需明确是否包含 “支付失败”“退货退款” 等分支。2. 拆解流程步骤…",
        "excerpt_new": "画流程图的核心在于逻辑清晰、结构简洁，同时兼顾易读性和美观性。以下是 主要步骤和实用技巧的详细解析，帮助你高效完成流程图设计： 1. 明确流程目标与范围问清需求：这是什么类型的流程？（业务流程、技术流程、项目流程等）核心环节是什么？是否需要展示分支或异常处理？目标受众是谁？（管理层看全局，执行层看细节）示例：若绘制 “电商订单处理流程”，需明确是否包含 “支付失败”“退货退款” 等分支。2. 拆解流程步骤…",
        "preview_type": "default",
        "preview_text": "",
        "reshipment_settings": "allowed",
        "content": "<p data-pid=\"jwzAmiqB\">       画流程图的核心在于逻辑清晰、结构简洁，同时兼顾易读性和美观性。以下是<b>主要步骤</b>和<b>实用技巧</b>的详细解析，帮助你高效完成流程图设计：</p><p data-pid=\"khq4thc_\"><b>1. 明确流程目标与范围</b></p><ul><li data-pid=\"hrlpgcN4\"><b>问清需求</b>：</li><ul><li data-pid=\"x_cgNPTf\">这是什么类型的流程？（业务流程、技术流程、项目流程等）</li><li data-pid=\"n7L1vImU\">核心环节是什么？是否需要展示分支或异常处理？</li><li data-pid=\"tmLkWSAu\">目标受众是谁？（管理层看全局，执行层看细节）</li></ul><li data-pid=\"MpfBoTk3\"><b>示例</b>：若绘制 “电商订单处理流程”，需明确是否包含 “支付失败”“退货退款” 等分支。</li></ul><h3><b>2. 拆解流程步骤（关键！）</b></h3><ul><li data-pid=\"Ez6lU3F_\"><b>用文字列出大纲</b>：<br/>按时间或逻辑顺序，将流程拆解为最小单元（避免步骤过于笼统或冗长）。<br/><i>例：用户注册流程</i><br/>开始 → 填写手机号 → 发送验证码 → 验证通过 → 创建账户 → 结束   ↘  验证失败 → 重新发送验证码</li><li data-pid=\"RIxuB4ji\"><b>区分主流程与分支</b>：<br/>主流程用实线箭头连接，分支（如条件判断、异常处理）用虚线或不同颜色标注。</li></ul><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-012134ed9a3221fa0772008938540a22_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"4504\" data-rawheight=\"3076\" data-original-token=\"v2-26561a7f87d5dd5d19ed642ee40c064c\" class=\"origin_image zh-lightbox-thumb\" width=\"4504\" data-original=\"https://pic1.zhimg.com/v2-012134ed9a3221fa0772008938540a22_r.jpg\"/><figcaption>工艺流程图</figcaption></figure><h3><b>3. 选择工具与模板</b></h3><ul><li data-pid=\"bKcGQOoo\"><b>简单场景</b>：用 <b>良功绘图网站 </b>快速上手。</li><li data-pid=\"PfpSkcQ0\"><b>专业场景</b>：用 <b>Lucidchart</b>（支持协作）或代码工具 <b>Mermaid</b>（嵌入文档）。</li><li data-pid=\"LMLsMkXq\"><b>直接套用模板</b>：在工具中搜索关键词（如 “审批流程”“软件开发流程”），修改细节即可，节省 50% 以上时间。</li></ul><h3><b>4. 绘制基础框架</b></h3><ul><li data-pid=\"D5niwBjZ\"><b>摆放图形</b>：</li><ul><li data-pid=\"SmxyTZ7L\">起点 / 终点用<b>椭圆</b>或<b>圆形</b>，任务步骤用<b>矩形</b>，判断条件用<b>菱形</b>，输入 / 输出用<b>平行四边形</b>。</li><li data-pid=\"Reh154MY\">按 “从上到下、从左到右” 原则排列，避免线条交叉（必要时用 “跨页连接器” 符号 ↕ 表示流程延续）。</li></ul><li data-pid=\"9vqR9U8H\"><b>连接箭头</b>：<br/>用带箭头的线条明确流向，分支处标注条件（如 “是 / 否”“通过 / 不通过”）。</li></ul><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-ad857e67489ae1266c91b3f32153a586_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"3144\" data-rawheight=\"4192\" data-original-token=\"v2-3608aeb0d5ca0191e1c586a4bc6e4548\" class=\"origin_image zh-lightbox-thumb\" width=\"3144\" data-original=\"https://pic3.zhimg.com/v2-ad857e67489ae1266c91b3f32153a586_r.jpg\"/><figcaption>安全隐患处理流程图</figcaption></figure><h3><b>5. 优化细节与美化</b></h3><ul><li data-pid=\"KNYMBzMi\"><b>标注关键信息</b>：</li><ul><li data-pid=\"2pIC6nCZ\">矩形内写步骤名称（简洁动词 + 名词，如 “提交申请”“生成报告”）；</li><li data-pid=\"SL5qRtyc\">菱形内写判断条件（如 “金额≥5000 元？”“库存是否充足？”）。</li></ul><li data-pid=\"e6ckLzfx\"><b>视觉分层</b>：</li><ul><li data-pid=\"jIYj8t88\">主流程用深色（如蓝色），分支用浅色（如灰色）；</li><li data-pid=\"A0vZ8ERe\">关键步骤（如审批节点、风险点）用加粗字体或不同形状（如圆角矩形）突出。</li></ul><li data-pid=\"GVPvBLAq\"><b>添加注释与标注</b>：<br/>复杂步骤旁用 “注释框” 补充说明（如 “需在 24 小时内完成”），或用编号对应附录表格。</li></ul><h3><b>6. 检查与迭代</b></h3><ul><li data-pid=\"HADSLagU\"><b>逻辑校验</b>：<br/>按流程走一遍，确认无 “断头路”（如判断后无后续步骤）、无循环漏洞（如无限递归）。</li><li data-pid=\"7ZuofuAe\"><b>受众测试</b>：<br/>给非专业人员看，询问 “是否能看懂每个步骤的作用”，根据反馈简化或补充细节。</li><li data-pid=\"PIXl9acF\"><b>保存源文件</b>：<br/>保存为工具的原始格式，方便后续修改。</li></ul><h2>附高清流程图模板如下：</h2><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-5f0c2215ad9e11e95d1185643b4a5dd3_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"5488\" data-rawheight=\"4180\" data-original-token=\"v2-e4e51e12a94425a65a6eaf1b867cb953\" class=\"origin_image zh-lightbox-thumb\" width=\"5488\" data-original=\"https://picx.zhimg.com/v2-5f0c2215ad9e11e95d1185643b4a5dd3_r.jpg\"/><figcaption>房地产开发流程图</figcaption></figure><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-037d62e2bcbc4eaed8d937b4d086ed28_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"6124\" data-rawheight=\"4292\" data-original-token=\"v2-73bc9df4be8cea7c51ce70540980cd4d\" class=\"origin_image zh-lightbox-thumb\" width=\"6124\" data-original=\"https://pica.zhimg.com/v2-037d62e2bcbc4eaed8d937b4d086ed28_r.jpg\"/><figcaption>医疗放射性药品许可流程图</figcaption></figure><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-20f2c9da1ff0e90cbe56380d2ce01544_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"6108\" data-rawheight=\"4336\" data-original-token=\"v2-3a3da0ef9b04bf3b8c6b07546f2cfeda\" class=\"origin_image zh-lightbox-thumb\" width=\"6108\" data-original=\"https://pic3.zhimg.com/v2-20f2c9da1ff0e90cbe56380d2ce01544_r.jpg\"/><figcaption>治疗剂临床制造方法示意图</figcaption></figure><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-09058b3524a902646f24f84d5f9780ca_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"4796\" data-rawheight=\"3292\" data-original-token=\"v2-2d94afc4d7cef054c5a0831ea5c9874e\" class=\"origin_image zh-lightbox-thumb\" width=\"4796\" data-original=\"https://pica.zhimg.com/v2-09058b3524a902646f24f84d5f9780ca_r.jpg\"/><figcaption>石油化工催化流程图</figcaption></figure><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-95ebc5a1c3409796f5fe73c01ae16865_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"3400\" data-rawheight=\"4452\" data-original-token=\"v2-0dfcfd847e1110b55605d5247b32fe18\" class=\"origin_image zh-lightbox-thumb\" width=\"3400\" data-original=\"https://picx.zhimg.com/v2-95ebc5a1c3409796f5fe73c01ae16865_r.jpg\"/><figcaption>金融产品充值流程图</figcaption></figure><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-dcdfa01ca347615474a4e350459bbbad_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"5308\" data-rawheight=\"3972\" data-original-token=\"v2-a4f03dabeb8f8cb7a17b5455bdb6cb14\" class=\"origin_image zh-lightbox-thumb\" width=\"5308\" data-original=\"https://picx.zhimg.com/v2-dcdfa01ca347615474a4e350459bbbad_r.jpg\"/><figcaption>医疗行业分类架构图</figcaption></figure><figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-8d4fcf84ec1069a3caeb68e9d8774e3f_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"4772\" data-rawheight=\"3316\" data-original-token=\"v2-7836451acc7bd4b069eb5a9efdc5087b\" class=\"origin_image zh-lightbox-thumb\" width=\"4772\" data-original=\"https://pic2.zhimg.com/v2-8d4fcf84ec1069a3caeb68e9d8774e3f_r.jpg\"/><figcaption>直流电源电路图</figcaption></figure><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-fb6d170a739976562b51fbba209c7955_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"2964\" data-rawheight=\"2836\" data-original-token=\"v2-d111e3239bf1e8634bf29c5a2cf685ce\" class=\"origin_image zh-lightbox-thumb\" width=\"2964\" data-original=\"https://picx.zhimg.com/v2-fb6d170a739976562b51fbba209c7955_r.jpg\"/><figcaption>销售管理应用流程图</figcaption></figure><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-8e22fb740eb4bd61db4d9f376d112198_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"3976\" data-rawheight=\"3272\" data-original-token=\"v2-e517e74814ebefd61bacf5238eea3647\" class=\"origin_image zh-lightbox-thumb\" width=\"3976\" data-original=\"https://pic1.zhimg.com/v2-8e22fb740eb4bd61db4d9f376d112198_r.jpg\"/><figcaption>销售与收款业务流程图</figcaption></figure><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-6b65bb1ccef295edd292b51366a1f3d4_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"4580\" data-rawheight=\"3248\" data-original-token=\"v2-e5e578dffb398904b4c787c6aa7550b1\" class=\"origin_image zh-lightbox-thumb\" width=\"4580\" data-original=\"https://pic1.zhimg.com/v2-6b65bb1ccef295edd292b51366a1f3d4_r.jpg\"/><figcaption>分布式电源调度架构图</figcaption></figure><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-d35b60055bb89c55619bea81723a97d8_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"4760\" data-rawheight=\"3352\" data-original-token=\"v2-dd6affc47fc6d102a6ce6bb84ab003d9\" class=\"origin_image zh-lightbox-thumb\" width=\"4760\" data-original=\"https://pic3.zhimg.com/v2-d35b60055bb89c55619bea81723a97d8_r.jpg\"/><figcaption>废水处理流程图</figcaption></figure><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-b36111d71d34d88db44b99e8accbbc6d_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"4544\" data-rawheight=\"2912\" data-original-token=\"v2-dc67ff4660c61e206243f5afbd84a2b3\" class=\"origin_image zh-lightbox-thumb\" width=\"4544\" data-original=\"https://picx.zhimg.com/v2-b36111d71d34d88db44b99e8accbbc6d_r.jpg\"/><figcaption>计算机软件云服务器k8s架构图</figcaption></figure><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-bc450d0d965358a76c9e339bb412fae0_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"9088\" data-rawheight=\"6312\" data-original-token=\"v2-3afc0b0399289d1293d124dd12762637\" class=\"origin_image zh-lightbox-thumb\" width=\"9088\" data-original=\"https://pic3.zhimg.com/v2-bc450d0d965358a76c9e339bb412fae0_r.jpg\"/><figcaption>电路接线图</figcaption></figure><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-b95936879e7e829a0a84ebe571ac76c4_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"8696\" data-rawheight=\"4672\" data-original-token=\"v2-a5c9ef4b4c97419dcad4542e46ba9fcf\" class=\"origin_image zh-lightbox-thumb\" width=\"8696\" data-original=\"https://pic3.zhimg.com/v2-b95936879e7e829a0a84ebe571ac76c4_r.jpg\"/><figcaption>过滤方案流程图</figcaption></figure><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-55057316d686e24d6304b9964ccee15a_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"6780\" data-rawheight=\"4404\" data-original-token=\"v2-4adbc26a8803ebd3b87b06727d701c1c\" class=\"origin_image zh-lightbox-thumb\" width=\"6780\" data-original=\"https://pic3.zhimg.com/v2-55057316d686e24d6304b9964ccee15a_r.jpg\"/><figcaption>无人机飞控结构图</figcaption></figure><figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-aa2abc44bd189592b536e63359c88e13_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"2358\" data-rawheight=\"1518\" data-original-token=\"v2-ded3b2693bb3dbd97c0bfbbdc8136347\" class=\"origin_image zh-lightbox-thumb\" width=\"2358\" data-original=\"https://pic2.zhimg.com/v2-aa2abc44bd189592b536e63359c88e13_r.jpg\"/><figcaption>物流仓储流程图</figcaption></figure><p></p>",
        "relationship": {
          "is_thanked": false,
          "is_nothelp": false,
          "voting": 0
        },
        "is_labeled": false,
        "visited_count": 2132,
        "thumbnails": [
          "https://pic1.zhimg.com/50/v2-01a3ae0e4e78e219db59049666fe7027_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-27cf7c778495d04d839bd7c0772a61f5_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-c2d792cbbc9290d54e1c4f848444726e_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-13f85070605bb0e01bc7ccf27a8e0dea_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-2084fd1091f8eaec13c0080f6e7ca105_720w.jpg?source=b6762063",
          "https://pic1.zhimg.com/50/v2-bbdac3f102edf6503becc0e1613531e9_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-c59dcf3467f3362ed145fec7e1f3d491_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-3174f2300e7aba1962f3bba6cac3bbeb_720w.jpg?source=b6762063",
          "https://pica.zhimg.com/50/v2-bb5670fdc1f32b3316319934b6c54c87_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-f41af596c1b3234027ab537cd41545fa_720w.jpg?source=b6762063",
          "https://pica.zhimg.com/50/v2-882c73403747d9635c3c900085c5e8d9_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-91ecc068e506a40e5db7b4c430f5893a_720w.jpg?source=b6762063",
          "https://pica.zhimg.com/50/v2-e2fc1730c9a3911ff58a07d05979bce8_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-242c9abdf7f64296d2400457b09b95dd_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-dfeed67edd752df47cc37f4b0e719cca_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-a634576bb9a222fdc9f6d875339c8c8f_720w.jpg?source=b6762063",
          "https://pica.zhimg.com/50/v2-dfe1d53ab1f05339dad79705f121baa6_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-7c00596d060111e0731e3ea6bb56e384_720w.jpg?source=b6762063"
        ],
        "favorite_count": 114,
        "answer_type": "normal",
        "is_navigator": false,
        "navigator_vote": false,
        "vote_next_step": "vote"
      },
      "brief": "{\"source\": \"TS\", \"type\": \"answer\", \"id\": 1908529737623638816}",
      "attached_info": "CsAMCLmHweq9gb3SvgEQBBoJNzI4MzkxOTgzILTltcEGKBwwAEDfBEooCh1UU19TT1VSQ0VfTkVBUkxJTkVfQ09OVEVOVF9WMhIBMBgAIAA6AEpCCi1UU19TT1VSQ0VfVFdPVE9XRVJfTVVMVElfU0NFTkVfVjFfUkVDQUxMX1RFWFQSATAYACAAOgp7InJhdyI6IiJ9Wgg5OTA3NDUzN2IgZjA3NWJiMDBjMjlmNGMzMzYyNWE1OWJiMzUxYWUwYTdyEzE5MDg1Mjk3Mzc2MjM2Mzg4MTaKAQk2MTU1NzUxMTeqAQlyZWNvbW1lbmTCASBkNzBjNjFmOTZkOGU5Yjc5N2NiNTY1ZGM1ODI3Y2NjMvIBCggMEgZOb3JtYWzyASgIChIkNTZhNmQyNTUtY2NjNS00MDQxLWIwN2EtZjc3MzA5N2E3YTVl8gEHCAsSAzEwMoICAIgC1pnO+YwzkgIgZDcwYzYxZjk2ZDhlOWI3OTdjYjU2NWRjNTgyN2NjYzKaAgDKAhZTaG9ySW50ZXJlc3RXZWlnaHRSdWxlygIVVXNlckxjbkV4aXRXZWlnaHRSdWxlygIXVGVzdGVkQW5kV29ya1dlaWdodFJ1bGXaAh1UU19TT1VSQ0VfTkVBUkxJTkVfQ09OVEVOVF9WMugCA/oCC05PUk1BTF9GTE9XigMgODQxMTc2MzYzOTZjNDA2YWEzYTAxMDJjMThhNWZkN2WaAw0KAnYyEAAaBW90aGVyqAPUENgDAPoD7QYSDFVOS05PV05fTU9ERSAAKg1OT19JTUFHRV9NT0RFOi0IAhCYIxiEGCIjdjItMjY1NjFhN2Y4N2Q1ZGQ1ZDE5ZWQ2NDJlZTQwYzA2NGM6LQgDEMgYGOAgIiN2Mi0zNjA4YWViMGQ1Y2EwMTkxZTFjNTg2YTRiYzZlNDU0ODotCAIQ8CoY1CAiI3YyLWU0ZTUxZTEyYTk0NDI1YTY1YTZlYWYxYjg2N2NiOTUzOi0IAhDsLxjEISIjdjItNzNiYzlkZjRiZThjZWE3YzUxY2U3MDU0MDk4MGNkNGQ6LQgEENwvGPAhIiN2Mi0zYTNkYTBlZjliMDRiZjNiOGM2YjA3NTQ2ZjJjZmVkYTotCAQQvCUY3BkiI3YyLTJkOTRhZmM0ZDdjZWYwNTRjNWEwODMxZWE1Yzk4NzRlOi0IAhDIGhjkIiIjdjItMGRmY2ZkODQ3ZTExMTBiNTU2MDVkNTI0N2IzMmZlMTg6LQgCELwpGIQfIiN2Mi1hNGYwM2RhYmViOGY4Y2I3YTE3YjU0NTViZGI2Y2IxNDotCAMQpCUY9BkiI3YyLTc4MzY0NTFhY2M3YmQ0YjA2OWViNWE5ZWZkYzUwODdiOi0IAhCUFxiUFiIjdjItZDExMWUzMjM5YmYxZTg2MzRiZjI5YzVhMmNmNjg1Y2U6LQgEEIgfGMgZIiN2Mi1lNTE3ZTc0ODE0ZWJlZmQ2MWJhY2Y1MjM4ZWVhMzY0NzotCAIQ5CMYsBkiI3YyLWU1ZTU3OGRmZmIzOTg5MDRiNGM3ODdjNmFhNzU1MGIxOi0IBBCYJRiYGiIjdjItZGQ2YWZmYzQ3ZmM2ZDEwMmE2Y2U2YmI4NGFiMDAzZDk6LQgDEMAjGOAWIiN2Mi1kYzY3ZmY0NjYwYzYxZTIwNjI0M2Y1YWZiZDg0YTJiMzotCAMQgEcYqDEiI3YyLTNhZmMwYjAzOTkyODlkMTI5M2QxMjRkZDEyNzYyNjM3Oi0IAhD4QxjAJCIjdjItYTVjOWVmNGI0Yzk3NDE5ZGNhZDQ1NDJlNDZiYTlmY2Y6LQgDEPw0GLQiIiN2Mi00YWRiYzI2YTg4MDNlYmQzYjg3YjA2NzI3ZDcwMWMxYzotCAMQthIY7gsiI3YyLWRlZDNiMjY5M2JiM2RiZDk3YzBiZmJiZGM4MTM2MzQ3gAQAiAQAkgQGTm9ybWFsmgQBM6AEAKgEALAEALoEBm1hbnVhbMIEAzE3MMgEANIED+aOqOiNkOW3suabtOaWsNgEAPAEAPkEAAAAYCmjmz+BBQAAAAAAAAAAiQW45Ei9E1TZP5IFAJoFA2RmdKIFA2RmdLIFATG5BQAAAAAAAAAA0AUA4AUA6AUA8AVmkAYAoAblBKgGA5ICLgoJNzI4MzkxOTgzEhMxOTA4NTI5NzM3NjIzNjM4ODE2GAQiCklNQUdFX1RFWFQ=",
      "action_card": false
    },
    {
      "id": "608_1755822919.182",
      "type": "feed",
      "offset": 608,
      "verb": "TOPIC_ACKNOWLEDGED_ANSWER",
      "created_time": 1755822919,
      "updated_time": 1755822919,
      "target": {
        "id": "1925875120058130554",
        "type": "answer",
        "url": "https://api.zhihu.com/answers/1925875120058130554",
        "author": {
          "id": "7f9b68b90b556206dae37ade57252610",
          "url": "https://api.zhihu.com/people/7f9b68b90b556206dae37ade57252610",
          "user_type": "people",
          "url_token": "nineya.com",
          "name": "玖涯菜菜子",
          "headline": "",
          "avatar_url": "https://picx.zhimg.com/50/v2-7f49931e2bb0da98a967f6ad340cc719_l.jpg?source=b6762063",
          "is_org": false,
          "gender": -1,
          "badge": [
            {
              "type": "identity_people",
              "description": "计算机技术与软件专业技术资格证持证人"
            }
          ],
          "followers_count": 14,
          "is_following": false,
          "is_followed": false
        },
        "created_time": 1751944409,
        "updated_time": 1751944409,
        "voteup_count": 5,
        "thanks_count": 0,
        "comment_count": 1,
        "is_copyable": true,
        "question": {
          "id": "7635675905",
          "type": "question",
          "url": "https://api.zhihu.com/questions/7635675905",
          "author": {
            "id": "e221938c2fd51b20db5cb7dc514c70bd",
            "url": "https://api.zhihu.com/people/e221938c2fd51b20db5cb7dc514c70bd",
            "user_type": "people",
            "url_token": "lao-yi-de-si-kao-bi-ji",
            "name": "深圳老易",
            "headline": "短文日更1000天，在职场，探索副业。",
            "avatar_url": "https://picx.zhimg.com/50/v2-3f7a04843fef0f2beb2000a5026456b4_l.jpg?source=b6762063",
            "is_org": false,
            "gender": 1,
            "followers_count": 108,
            "is_following": false,
            "is_followed": false
          },
          "title": "网盘拉新需要准备什么？",
          "created": 1734941686,
          "answer_count": 0,
          "follower_count": 0,
          "comment_count": 0,
          "bound_topic_ids": [
            7015
          ],
          "is_following": false,
          "excerpt": "",
          "relationship": {
            "is_author": false
          },
          "detail": "",
          "question_type": "normal"
        },
        "thumbnail": "https://picx.zhimg.com/50/v2-3e4551f89668c4bbdcaa857fc55dc19c_720w.jpg?source=b6762063",
        "excerpt": "工欲善其事必先利其，网盘拉新要达到一定的收益，准备一些工具做为辅助能有效提高效率。 比如网盘资源管理工具，批量去除广告、批量转存文件等。 这里我分享一个我在用的一个网盘短链工具。 如果你是网盘拉新的老手，那肯定会有一些痛点问题困恼你， 比如拉新转化率低，网盘资源经常失效，拉新数据不透明等等……而网盘短链工具，可以把网盘链接转化为特殊的短连接，就是专门解决这类问题的。 一、提高转化率网盘转化率低，最大…",
        "excerpt_new": "工欲善其事必先利其，网盘拉新要达到一定的收益，准备一些工具做为辅助能有效提高效率。 比如网盘资源管理工具，批量去除广告、批量转存文件等。 这里我分享一个我在用的一个网盘短链工具。 如果你是网盘拉新的老手，那肯定会有一些痛点问题困恼你， 比如拉新转化率低，网盘资源经常失效，拉新数据不透明等等……而网盘短链工具，可以把网盘链接转化为特殊的短连接，就是专门解决这类问题的。 一、提高转化率网盘转化率低，最大…",
        "preview_type": "default",
        "preview_text": "",
        "reshipment_settings": "allowed",
        "content": "<p data-pid=\"2CxKq60e\">工欲善其事必先利其，网盘拉新要达到一定的收益，准备一些工具做为辅助能有效提高效率。</p><p data-pid=\"gRICVUk0\">比如网盘资源管理工具，批量去除广告、批量转存文件等。</p><p data-pid=\"NLk428dR\">这里我分享一个我在用的一个网盘短链工具。</p><p data-pid=\"4vTQbEJA\">如果你是网盘拉新的老手，那肯定会有一些痛点问题困恼你，<b>比如拉新转化率低，网盘资源经常失效，拉新数据不透明等等……</b></p><p data-pid=\"CCWPIGAU\">而网盘短链工具，可以把网盘链接转化为特殊的短连接，就是专门解决这类问题的。</p><p data-pid=\"fiUJ2I5j\"><b>一、提高转化率</b></p><p data-pid=\"1QfF-cfv\">网盘转化率低，最大原因在于拉新规则倾向移动端用户，<b>仅APP端的用户才有分成和转存。</b></p><figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-ff6ad029ef82a6b7a43c2dfba2a5fc2f_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"378\" data-rawheight=\"401\" data-original-token=\"v2-f695b1c7504ecc5e86dca42d20346b4e\" data-default-watermark-src=\"https://picx.zhimg.com/v2-292309964b9cfd4d7ca734df18ffba2f_b.jpg\" class=\"content_image\" width=\"378\"/></figure><p data-pid=\"_cN1ivPW\"><b>但是很多用户更习惯电脑上找资源，这就导致你很多用户流失了。</b></p><p data-pid=\"XidI6iWR\">短链专门解决这个问题，如果用户是<b>PC端</b>访问，短链将显示一个<b>二维码</b>，引导用户使用<b>手机</b>进行扫码访问。</p><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-e48a974f74f307e5feb17ea9b4d6b124_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1730\" data-rawheight=\"746\" data-qrcode-action=\"none\" data-original-token=\"v2-785fb3c27d0be304e2520f53b192004e\" data-default-watermark-src=\"https://pica.zhimg.com/v2-065b7caf9420ce8e8c1c7d672d49788e_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1730\" data-original=\"https://pic1.zhimg.com/v2-e48a974f74f307e5feb17ea9b4d6b124_r.jpg\"/></figure><p data-pid=\"kCVyF_BJ\">PC端用户多的人，用了短链后，收益能提升2-3倍。</p><p data-pid=\"HrSTQuHe\">而且短链还预留了引流位置，帮助你转化，看下图。</p><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-388454858a359a28abf9aba55af89f63_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1439\" data-rawheight=\"737\" data-qrcode-action=\"none\" data-original-token=\"v2-43124eaf0be7a70db2b15f60cff07e4c\" data-default-watermark-src=\"https://pic2.zhimg.com/v2-fcde4e5f5a477603cc62803c621e647f_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1439\" data-original=\"https://picx.zhimg.com/v2-388454858a359a28abf9aba55af89f63_r.jpg\"/></figure><p data-pid=\"eiYzhbB2\"><b>二、避免资源失效</b></p><p data-pid=\"c1DV1kHW\">如果你是老鸟，百分百遇到过<b>账号被封</b>或<b>网盘分享链接违规</b>等问题。</p><p data-pid=\"A2uMaPOn\">正常情况下，<b>如果遇到违规，之前所有外发的帖子都白发了，不会结算收益了。</b></p><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-2907638c59e4c32ce65c21bb2c0164e5_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"647\" data-rawheight=\"409\" data-original-token=\"v2-cac003dbf65f8360c3eebb8980df1ef5\" data-default-watermark-src=\"https://pic2.zhimg.com/v2-321fa229a7f3f440b3a019850c84c351_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"647\" data-original=\"https://pic4.zhimg.com/v2-2907638c59e4c32ce65c21bb2c0164e5_r.jpg\"/></figure><p data-pid=\"odlYGcqv\">但是用了短链后，这个问题就不存在了。</p><p data-pid=\"J-3loYLk\">因为短链可以<b>重新指定目标网盘链接</b>，你给指定到正常的链接就行了。</p><p data-pid=\"uEo7_5KP\">短链也会<b>定期检测资源状态</b>。如果网盘链接失效了，你直接就能筛选看到。</p><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-8060442f2dcc59fa15a076d5020ec57c_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1642\" data-rawheight=\"384\" data-original-token=\"v2-8824a9916c7ea0d4ad4704e90d28d12b\" data-default-watermark-src=\"https://pic4.zhimg.com/v2-4027f6ba3c121aa10b548c31f02d3017_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1642\" data-original=\"https://pic3.zhimg.com/v2-8060442f2dcc59fa15a076d5020ec57c_r.jpg\"/></figure><p data-pid=\"0TYOqbE4\">失效没及时更新怎么办？</p><p data-pid=\"iTp0zJkI\">如果资源失效后没及时更新，那失效时间段内的用户就流失了吗？</p><p data-pid=\"SSvUYzFH\"><b>答案是：</b>不会！</p><p data-pid=\"qcYevkLk\">短链可以设置<b>失效引导文案</b>，如果资源失效了，可以引导用户加微信、关注公众号等等，用户不会流失。</p><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-a4ae884ce396ab1f998b2b590e80f767_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1521\" data-rawheight=\"743\" data-original-token=\"v2-ca4ba752da75edf9142e0c28bbaa428f\" data-default-watermark-src=\"https://pic2.zhimg.com/v2-1385f0d390ca5019b044b2e199f0fadb_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1521\" data-original=\"https://picx.zhimg.com/v2-a4ae884ce396ab1f998b2b590e80f767_r.jpg\"/></figure><p data-pid=\"UVyPJjVC\"><b>三、拉新数据透明</b></p><p data-pid=\"kqPrmSjT\">正常情况下，你只能看到网盘链接的点击次数。</p><p data-pid=\"flRY85G2\"><b>但是，用了短链工具后，可以查询到非常详细的访问数据。</b></p><p data-pid=\"QxKUzmLV\"><b>近30天的总访问情况：</b>包括浏览量，用户量，移动端访问流量，PC端访问流量。</p><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-b13171ec1d0848c361a6261a571933e2_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"416\" data-rawheight=\"208\" data-original-token=\"v2-f65d937127568ec48cf8e0ad8786ab28\" data-default-watermark-src=\"https://pic2.zhimg.com/v2-63c33901a9680b725de6ba85de4cf3eb_b.jpg\" class=\"content_image\" width=\"416\"/></figure><p data-pid=\"LrEoIfC9\">分析<b>访客来源</b>，让你明确来自哪个<b>推广渠道</b>的访问最多。</p><figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-1ddd6ab675c38d81996582c3fb2acfa5_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"419\" data-rawheight=\"422\" data-original-token=\"v2-ca6f349a4b4ac2b05e0f795d9517da5e\" data-default-watermark-src=\"https://pic2.zhimg.com/v2-761d0b278512805c6dc5f6caaa25f653_b.jpg\" class=\"content_image\" width=\"419\"/></figure><p data-pid=\"3DY0g3iJ\"><b>每日访问情况分析：</b></p><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-201317fddd290fdc8053cafba60eb624_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"414\" data-rawheight=\"587\" data-original-token=\"v2-fda8f99743a9e9f4a759d62986c98451\" data-default-watermark-src=\"https://pic3.zhimg.com/v2-bf225f5959db684978ef2996902919ac_b.jpg\" class=\"content_image\" width=\"414\"/></figure><p data-pid=\"dZv33bBB\"><b>怎么使用短链？</b></p><p data-pid=\"gyq2L7CQ\">短链功能在小程序<b>公私域运营助手</b>里，可以扫码打开这个小程序。</p><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-69bfbcbbcfb4f8238d5aae3aa46bc2d1_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"430\" data-rawheight=\"430\" data-qrcode-action=\"none\" data-original-token=\"v2-7a86e97e897ffb5714966ffc31d861a3\" data-default-watermark-src=\"https://picx.zhimg.com/v2-e8856bd7e33eb000b142fadf7294c8dd_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"430\" data-original=\"https://pic4.zhimg.com/v2-69bfbcbbcfb4f8238d5aae3aa46bc2d1_r.jpg\"/></figure><p data-pid=\"Zy5kAMbB\">用<b>创建网盘短链功能</b>创建短链就可以了。</p><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-58ff2c3bb97a3f0efa9e2e6682205d12_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"399\" data-rawheight=\"228\" data-original-token=\"v2-981ce2a961d180d4f7c8ebb14691e914\" data-default-watermark-src=\"https://pic4.zhimg.com/v2-c954c5d13875e384a6f92a0cd8410e2d_b.jpg\" class=\"content_image\" width=\"399\"/></figure><p></p>",
        "relationship": {
          "is_thanked": false,
          "is_nothelp": false,
          "voting": 0
        },
        "is_labeled": false,
        "visited_count": 439,
        "thumbnails": [
          "https://pica.zhimg.com/50/v2-3e4551f89668c4bbdcaa857fc55dc19c_720w.jpg?source=b6762063",
          "https://pica.zhimg.com/50/v2-d5180cb0e3d403df64496114a6cc6632_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-23e95bbd5a8d403716f223039ce4abe4_720w.jpg?source=b6762063"
        ],
        "favorite_count": 23,
        "answer_type": "normal",
        "is_navigator": false,
        "navigator_vote": false,
        "vote_next_step": "vote"
      },
      "brief": "{\"source\": \"TS\", \"type\": \"answer\", \"id\": 1925875120058130554}",
      "attached_info": "CvAJCLmHweq9gb3SvgEQBBoJNzM1OTYzODA5INmZssMGKAUwAUDgBEpCCi1UU19TT1VSQ0VfVFdPVE9XRVJfTVVMVElfU0NFTkVfVjFfUkVDQUxMX1RFWFQSATAYACAAOgp7InJhdyI6IiJ9WgkxMTI1MDM3MzJiIGYwNzViYjAwYzI5ZjRjMzM2MjVhNTliYjM1MWFlMGE3chMxOTI1ODc1MTIwMDU4MTMwNTU0igEKNzYzNTY3NTkwNaoBCXJlY29tbWVuZMIBIDdmOWI2OGI5MGI1NTYyMDZkYWUzN2FkZTU3MjUyNjEw8gEKCAwSBk5vcm1hbPIBKAgKEiRkMTVkOThkOS05NTRiLTQ0NzAtODdkNy00MjQzZjkzMmM0ZTPyAQcICxIDMTAyggIAiALWmc75jDOSAiA3ZjliNjhiOTBiNTU2MjA2ZGFlMzdhZGU1NzI1MjYxMJoCAMoCFlNob3JJbnRlcmVzdFdlaWdodFJ1bGXKAhVVc2VyTGNuRXhpdFdlaWdodFJ1bGXKAhRDb250ZW50QWdlV2VpZ2h0UnVsZdoCLVRTX1NPVVJDRV9UV09UT1dFUl9NVUxUSV9TQ0VORV9WMV9SRUNBTExfVEVYVOgCAvoCC05PUk1BTF9GTE9XigMgODQxMTc2MzYzOTZjNDA2YWEzYTAxMDJjMThhNWZkN2WaAw0KAnYyEAAaBW90aGVyqAO3A9gDAOoDFXRleHRGZWVkVHdvVG93ZXJWMUFsbPoDpAQSDFVOS05PV05fTU9ERSAAKg1OT19JTUFHRV9NT0RFOi0IAhD6AhiRAyIjdjItZjY5NWIxYzc1MDRlY2M1ZTg2ZGNhNDJkMjAzNDZiNGU6LQgDEMINGOoFIiN2Mi03ODVmYjNjMjdkMGJlMzA0ZTI1MjBmNTNiMTkyMDA0ZTotCAQQnwsY4QUiI3YyLTQzMTI0ZWFmMGJlN2E3MGRiMmIxNWY2MGNmZjA3ZTRjOi0IAxCHBRiZAyIjdjItY2FjMDAzZGJmNjVmODM2MGMzZWViYjg5ODBkZjFlZjU6LQgDEOoMGIADIiN2Mi04ODI0YTk5MTZjN2VhMGQ0YWQ0NzA0ZTkwZDI4ZDEyYjotCAQQ8QsY5wUiI3YyLWNhNGJhNzUyZGE3NWVkZjkxNDJlMGMyOGJiYWE0MjhmOi0IAhCgAxjQASIjdjItZjY1ZDkzNzEyNzU2OGVjNDhjZjhlMGFkODc4NmFiMjg6LQgCEKMDGKYDIiN2Mi1jYTZmMzQ5YTRiNGFjMmIwNWUwZjc5NWQ5NTE3ZGE1ZTotCAIQngMYywQiI3YyLWZkYThmOTk3NDNhOWU5ZjRhNzU5ZDYyOTg2Yzk4NDUxOi0IAxCuAxiuAyIjdjItN2E4NmU5N2U4OTdmZmI1NzE0OTY2ZmZjMzFkODYxYTM6LQgDEI8DGOQBIiN2Mi05ODFjZTJhOTYxZDE4MGQ0ZjdjOGViYjE0NjkxZTkxNIAEAIgEAJIEBk5vcm1hbJoEATKgBACoBACwBAC6BAJhacIEAzQwMMgEANIED+aOqOiNkOW3suabtOaWsNgEAPAEAPkEAAAAwMtElT+BBQAAAAAAAAAAiQW45Ei9E1TZP5IFAJoFA2RmdKIFA2RmdLIFATG5BQAAAAAAAAAA0AUA4AUA6AUA8AVmkAYAoAbmBKgGAJICLgoJNzM1OTYzODA5EhMxOTI1ODc1MTIwMDU4MTMwNTU0GAQiCklNQUdFX1RFWFQ=",
      "action_card": false
    },
    {
      "id": "609_1755822919.72",
      "type": "feed",
      "offset": 609,
      "verb": "TOPIC_ACKNOWLEDGED_ANSWER",
      "created_time": 1755822919,
      "updated_time": 1755822919,
      "target": {
        "id": "3293988485",
        "type": "answer",
        "url": "https://api.zhihu.com/answers/3293988485",
        "author": {
          "id": "dd5411e8c4eb08e4150ba40f6958e328",
          "url": "https://api.zhihu.com/people/dd5411e8c4eb08e4150ba40f6958e328",
          "user_type": "people",
          "url_token": "welcome-world",
          "name": "哇咔咔",
          "headline": "",
          "avatar_url": "https://pic1.zhimg.com/50/v2-856d774b9889e7582f08cd473fb8bc2d_l.jpg?source=b6762063",
          "is_org": false,
          "gender": -1,
          "followers_count": 8617,
          "is_following": false,
          "is_followed": false
        },
        "created_time": 1700331940,
        "updated_time": 1700331940,
        "voteup_count": 350,
        "thanks_count": 150,
        "comment_count": 23,
        "is_copyable": true,
        "question": {
          "id": "28713757",
          "type": "question",
          "url": "https://api.zhihu.com/questions/28713757",
          "author": {
            "id": "b7008d635391070e90c40100efd5c05e",
            "url": "https://api.zhihu.com/people/b7008d635391070e90c40100efd5c05e",
            "user_type": "people",
            "url_token": "duo-shi-ben",
            "name": "巴斯光年",
            "headline": "",
            "avatar_url": "https://pic1.zhimg.com/50/12f20b12b_l.jpg?source=b6762063",
            "is_org": false,
            "gender": 1,
            "followers_count": 10,
            "is_following": false,
            "is_followed": false
          },
          "title": "哪个版本《资治通鉴》比较好？",
          "created": 1426165139,
          "answer_count": 0,
          "follower_count": 0,
          "comment_count": 1,
          "bound_topic_ids": [
            53,
            264,
            30971,
            37056
          ],
          "is_following": false,
          "excerpt": "",
          "relationship": {
            "is_author": false
          },
          "detail": "",
          "question_type": "normal"
        },
        "thumbnail": "https://pica.zhimg.com/50/v2-596f458b37d10d2a4168019288385c16_720w.jpg?source=b6762063",
        "excerpt": "一、资治通鉴 共12册 司马光编著 胡三省音注 中华书局下载链接： 资治通鉴 共12册 司马光编著 胡三省音注 中华书局.pdf 访问密码：5422           二、資治通鑑 司馬光編著 胡三省音注 中華書局下载链接： 資治通鑑 司馬光編著 胡三省音注 中華書局.pdf 访问密码：5422       三、白话资治通鉴 共3册 司马光编著 张宏儒主编 岳麓书社下载链接： 白话资治通鉴 共3册 司马光编著 张宏儒主编 岳麓书社.pdf 访问密码：5422         四、柏杨白话版资治通鉴 全72…",
        "excerpt_new": "一、资治通鉴 共12册 司马光编著 胡三省音注 中华书局下载链接： 资治通鉴 共12册 司马光编著 胡三省音注 中华书局.pdf 访问密码：5422           二、資治通鑑 司馬光編著 胡三省音注 中華書局下载链接： 資治通鑑 司馬光編著 胡三省音注 中華書局.pdf 访问密码：5422       三、白话资治通鉴 共3册 司马光编著 张宏儒主编 岳麓书社下载链接： 白话资治通鉴 共3册 司马光编著 张宏儒主编 岳麓书社.pdf 访问密码：5422         四、柏杨白话版资治通鉴 全72…",
        "preview_type": "default",
        "preview_text": "",
        "reshipment_settings": "allowed",
        "content": "<h2>一、资治通鉴 共12册 司马光编著 胡三省音注 中华书局</h2><p data-pid=\"EboecKmW\">下载链接：</p><a href=\"https://link.zhihu.com/?target=https%3A//url86.ctfile.com/f/32005086-976779205-78ca9f%3Fp%3D5422\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">资治通鉴 共12册 司马光编著 胡三省音注 中华书局.pdf</a><p data-pid=\"IarMCk0N\">访问密码：5422</p><figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-efcf94191ebdc1d9f59116a5e4046f7b_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1079\" data-rawheight=\"811\" data-original-token=\"v2-efcf94191ebdc1d9f59116a5e4046f7b\" data-default-watermark-src=\"https://pica.zhimg.com/v2-fb4652d71598be857e686dab1333af48_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1079\" data-original=\"https://pic2.zhimg.com/v2-efcf94191ebdc1d9f59116a5e4046f7b_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-f82ceae7b13f02ea90713c22678b3716_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1111\" data-rawheight=\"811\" data-original-token=\"v2-f82ceae7b13f02ea90713c22678b3716\" data-default-watermark-src=\"https://pic2.zhimg.com/v2-9cef6b06761e70838990e1af5bdf3f3d_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1111\" data-original=\"https://pica.zhimg.com/v2-f82ceae7b13f02ea90713c22678b3716_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-87750f4665440deb18a45b36abb0bbdc_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1075\" data-rawheight=\"814\" data-original-token=\"v2-87750f4665440deb18a45b36abb0bbdc\" data-default-watermark-src=\"https://pic1.zhimg.com/v2-aeedd6e9a864c84e14f05a4a6ee3cd80_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1075\" data-original=\"https://pic3.zhimg.com/v2-87750f4665440deb18a45b36abb0bbdc_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-dc8234ddee0ecf174deabee754133891_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1076\" data-rawheight=\"811\" data-original-token=\"v2-dc8234ddee0ecf174deabee754133891\" data-default-watermark-src=\"https://pica.zhimg.com/v2-fce6feeff8bff720b57632b0b1713306_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1076\" data-original=\"https://pic4.zhimg.com/v2-dc8234ddee0ecf174deabee754133891_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-4d07f3f2486e2241c7ab9c69f742a1cc_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1077\" data-rawheight=\"816\" data-original-token=\"v2-4d07f3f2486e2241c7ab9c69f742a1cc\" data-default-watermark-src=\"https://pic3.zhimg.com/v2-e331a4e129daa219611db066c93f9932_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1077\" data-original=\"https://pica.zhimg.com/v2-4d07f3f2486e2241c7ab9c69f742a1cc_r.jpg\"/></figure><h2>二、資治通鑑 司馬光編著 胡三省音注 中華書局</h2><p data-pid=\"quX01cl-\">下载链接：</p><a href=\"https://link.zhihu.com/?target=https%3A//url86.ctfile.com/f/32005086-976779304-579b19%3Fp%3D5422\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">資治通鑑 司馬光編著 胡三省音注 中華書局.pdf</a><p data-pid=\"Vo2-spHi\">访问密码：5422</p><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-cd29de2ad5d7d5ea1d05ef37353b2949_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1174\" data-rawheight=\"815\" data-original-token=\"v2-cd29de2ad5d7d5ea1d05ef37353b2949\" data-default-watermark-src=\"https://pic2.zhimg.com/v2-588af8a0aa34e6a866a7e36626712559_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1174\" data-original=\"https://picx.zhimg.com/v2-cd29de2ad5d7d5ea1d05ef37353b2949_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-319d29c2d744e69a3528532c9f341927_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1170\" data-rawheight=\"812\" data-original-token=\"v2-319d29c2d744e69a3528532c9f341927\" data-default-watermark-src=\"https://pica.zhimg.com/v2-764851157a5b19bf2e6777f715c4b520_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1170\" data-original=\"https://picx.zhimg.com/v2-319d29c2d744e69a3528532c9f341927_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-bbc66ad41de0c5af07e886b44fd84c5f_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1172\" data-rawheight=\"814\" data-original-token=\"v2-bbc66ad41de0c5af07e886b44fd84c5f\" data-default-watermark-src=\"https://pica.zhimg.com/v2-f8bc0bf3a1da4d8dce788ca0c5b54a4e_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1172\" data-original=\"https://picx.zhimg.com/v2-bbc66ad41de0c5af07e886b44fd84c5f_r.jpg\"/></figure><h2>三、白话资治通鉴 共3册 司马光编著 张宏儒主编 岳麓书社</h2><p data-pid=\"Mm-TP8nf\">下载链接：</p><a href=\"https://link.zhihu.com/?target=https%3A//url86.ctfile.com/f/32005086-976774771-7ba59f%3Fp%3D5422\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">白话资治通鉴 共3册 司马光编著 张宏儒主编 岳麓书社.pdf</a><p data-pid=\"SCYockSp\">访问密码：5422</p><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-6b2dfc5e86bf2d3653bfb2bf091357a6_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1286\" data-rawheight=\"817\" data-original-token=\"v2-6b2dfc5e86bf2d3653bfb2bf091357a6\" data-default-watermark-src=\"https://pic3.zhimg.com/v2-1d3833d270bfcacc7dde4e02f518d24e_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1286\" data-original=\"https://pica.zhimg.com/v2-6b2dfc5e86bf2d3653bfb2bf091357a6_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-62adc79794c7c0ca835fdba38d382a69_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1282\" data-rawheight=\"816\" data-original-token=\"v2-62adc79794c7c0ca835fdba38d382a69\" data-default-watermark-src=\"https://pic1.zhimg.com/v2-44fbc1130975dee2503928e09e9e18e8_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1282\" data-original=\"https://picx.zhimg.com/v2-62adc79794c7c0ca835fdba38d382a69_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-0ae227a6401058241af951d22772164a_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1279\" data-rawheight=\"814\" data-original-token=\"v2-0ae227a6401058241af951d22772164a\" data-default-watermark-src=\"https://pica.zhimg.com/v2-2c160de798cf703feed6cbff60b30292_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1279\" data-original=\"https://pic3.zhimg.com/v2-0ae227a6401058241af951d22772164a_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-e1be28db807ab1bc6f65ab7a960f8a29_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1279\" data-rawheight=\"814\" data-original-token=\"v2-e1be28db807ab1bc6f65ab7a960f8a29\" data-default-watermark-src=\"https://pic3.zhimg.com/v2-617883eeba6a23bca1f30831319322a6_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1279\" data-original=\"https://picx.zhimg.com/v2-e1be28db807ab1bc6f65ab7a960f8a29_r.jpg\"/></figure><h2>四、柏杨白话版资治通鉴 全72册 东方出版社</h2><p data-pid=\"1DFc0rTv\">下载链接：</p><a href=\"https://link.zhihu.com/?target=https%3A//url86.ctfile.com/f/32005086-976776064-61f7f6%3Fp%3D5422\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">柏杨白话版资治通鉴 全72册 东方出版社.pdf</a><p data-pid=\"bgP32pfK\">访问密码：5422</p><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-2f728adee5a823c85840b0627339dff5_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1174\" data-rawheight=\"817\" data-original-token=\"v2-2f728adee5a823c85840b0627339dff5\" data-default-watermark-src=\"https://pic4.zhimg.com/v2-783e171e386217d0b4fe8ccc9eccedff_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1174\" data-original=\"https://pic4.zhimg.com/v2-2f728adee5a823c85840b0627339dff5_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-86985c749e1716ba296ca8aa5f27ec70_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1171\" data-rawheight=\"816\" data-original-token=\"v2-86985c749e1716ba296ca8aa5f27ec70\" data-default-watermark-src=\"https://pic4.zhimg.com/v2-2de8c9810e05879bf8d95524c6d83ac3_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1171\" data-original=\"https://pica.zhimg.com/v2-86985c749e1716ba296ca8aa5f27ec70_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-c70c481b490d455402a0c5f169e44829_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1171\" data-rawheight=\"816\" data-original-token=\"v2-c70c481b490d455402a0c5f169e44829\" data-default-watermark-src=\"https://pic4.zhimg.com/v2-03640d5f1f03d850b544be187b89d389_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1171\" data-original=\"https://pic4.zhimg.com/v2-c70c481b490d455402a0c5f169e44829_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-306cce4e8f8a3a415c27c5f7390165ed_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1169\" data-rawheight=\"807\" data-original-token=\"v2-306cce4e8f8a3a415c27c5f7390165ed\" data-default-watermark-src=\"https://picx.zhimg.com/v2-43a8f70ebe362370aed3cba150f94e23_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1169\" data-original=\"https://pic4.zhimg.com/v2-306cce4e8f8a3a415c27c5f7390165ed_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-c9c0c0346407ab06b3f6f15468d4ef42_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1164\" data-rawheight=\"814\" data-original-token=\"v2-c9c0c0346407ab06b3f6f15468d4ef42\" data-default-watermark-src=\"https://pic1.zhimg.com/v2-7360874645afa0910ff539ba5b223b1a_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1164\" data-original=\"https://pic1.zhimg.com/v2-c9c0c0346407ab06b3f6f15468d4ef42_r.jpg\"/></figure><h2>五、资治通鉴 插图版 司马光编纂 王学典解译 中国纺织出版社</h2><p data-pid=\"NCCq2gje\">下载链接：</p><a href=\"https://link.zhihu.com/?target=https%3A//url86.ctfile.com/f/32005086-976779202-f50099%3Fp%3D5422\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">资治通鉴 插图版 司马光编纂 王学典解译 中国纺织出版社.pdf</a><p data-pid=\"RirslHlr\">访问密码：5422</p><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-a820f181056e025fc100dbd5b8ad9fec_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1174\" data-rawheight=\"817\" data-original-token=\"v2-a820f181056e025fc100dbd5b8ad9fec\" data-default-watermark-src=\"https://pic2.zhimg.com/v2-2a5895fde526f4029fa8edbc8b019dbf_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1174\" data-original=\"https://pic1.zhimg.com/v2-a820f181056e025fc100dbd5b8ad9fec_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-f9a80ad2c7680b17cc3cde5ab24e808c_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1174\" data-rawheight=\"816\" data-original-token=\"v2-f9a80ad2c7680b17cc3cde5ab24e808c\" data-default-watermark-src=\"https://pica.zhimg.com/v2-9dd18509888c39cb73178b41a5c95c56_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1174\" data-original=\"https://pic1.zhimg.com/v2-f9a80ad2c7680b17cc3cde5ab24e808c_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-14506e47cab47cd4b6c43e068ff9ae71_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1171\" data-rawheight=\"812\" data-original-token=\"v2-14506e47cab47cd4b6c43e068ff9ae71\" data-default-watermark-src=\"https://pica.zhimg.com/v2-31d4e689b914687a69c20b1205084742_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1171\" data-original=\"https://picx.zhimg.com/v2-14506e47cab47cd4b6c43e068ff9ae71_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-06df92299ad3c36783fd503494d27a63_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1172\" data-rawheight=\"815\" data-original-token=\"v2-06df92299ad3c36783fd503494d27a63\" data-default-watermark-src=\"https://pica.zhimg.com/v2-e03ad17e2067ed464b1107d6c9e33514_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1172\" data-original=\"https://pic2.zhimg.com/v2-06df92299ad3c36783fd503494d27a63_r.jpg\"/></figure><h2>六、资治通鉴 汇编精评 全6册 司马光编著 李翰文主编 北京联合出版公司</h2><p data-pid=\"ZhzWS83U\">下载链接：</p><a href=\"https://link.zhihu.com/?target=https%3A//url86.ctfile.com/f/32005086-976779262-c7a315%3Fp%3D5422\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">资治通鉴 汇编精评 全6册 司马光编著 李翰文主编 北京联合出版公司.pdf</a><p data-pid=\"RTfw9CZb\">访问密码：5422</p><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-941a6d4982439da8dc2868e10d38722a_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1280\" data-rawheight=\"815\" data-original-token=\"v2-941a6d4982439da8dc2868e10d38722a\" data-default-watermark-src=\"https://pic4.zhimg.com/v2-70ecc8658056027809065616a4f80acf_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1280\" data-original=\"https://pic3.zhimg.com/v2-941a6d4982439da8dc2868e10d38722a_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-dbad8cc4446e7924476268005ae2df6a_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1279\" data-rawheight=\"815\" data-original-token=\"v2-dbad8cc4446e7924476268005ae2df6a\" data-default-watermark-src=\"https://pic4.zhimg.com/v2-951476151b5da5fafd140aad191f51f9_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1279\" data-original=\"https://pica.zhimg.com/v2-dbad8cc4446e7924476268005ae2df6a_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-4acc0c95c96cf4385838d8de70fbf1b8_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1277\" data-rawheight=\"815\" data-original-token=\"v2-4acc0c95c96cf4385838d8de70fbf1b8\" data-default-watermark-src=\"https://pica.zhimg.com/v2-eb4bf8a3d0f24fe9c1b4568bcaf2e150_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1277\" data-original=\"https://pica.zhimg.com/v2-4acc0c95c96cf4385838d8de70fbf1b8_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-55fb8efc530cf295774c3ec33352c9f8_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1280\" data-rawheight=\"811\" data-original-token=\"v2-55fb8efc530cf295774c3ec33352c9f8\" data-default-watermark-src=\"https://pic3.zhimg.com/v2-06db6f8408447f7826ba52567030df82_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1280\" data-original=\"https://pica.zhimg.com/v2-55fb8efc530cf295774c3ec33352c9f8_r.jpg\"/></figure><h2>七、续资治通鉴 文白对照全译 全四册 沈志华主编 改革出版社</h2><h3>7.1.续资治通鉴 文白对照全译 第一册 沈志华主编 改革出版社</h3><p data-pid=\"Wjt5aPjz\">下载链接：</p><a href=\"https://link.zhihu.com/?target=https%3A//url86.ctfile.com/f/32005086-976779142-1f3839%3Fp%3D5422\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">续资治通鉴 文白对照全译 第一册 沈志华主编 改革出版社.pdf</a><p data-pid=\"ZSz-s9TI\">访问密码：5422</p><figure data-size=\"normal\"><img src=\"https://picx.zhimg.com/v2-38bf7c1e2ddca0a9a5f13cc7a079f99b_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1202\" data-rawheight=\"825\" data-qrcode-action=\"none\" data-original-token=\"v2-38bf7c1e2ddca0a9a5f13cc7a079f99b\" data-default-watermark-src=\"https://pica.zhimg.com/v2-f0d578471eb349bf7f32782bc426ed5e_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1202\" data-original=\"https://picx.zhimg.com/v2-38bf7c1e2ddca0a9a5f13cc7a079f99b_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-dae48af9141cbf41ae86fb7fa48a30ae_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1202\" data-rawheight=\"822\" data-original-token=\"v2-dae48af9141cbf41ae86fb7fa48a30ae\" data-default-watermark-src=\"https://pica.zhimg.com/v2-cd96aee3d90222d4e75bc27a1f59bfda_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1202\" data-original=\"https://pica.zhimg.com/v2-dae48af9141cbf41ae86fb7fa48a30ae_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pica.zhimg.com/v2-d5571d029ffb31942d52687c56da4fc8_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1202\" data-rawheight=\"822\" data-original-token=\"v2-d5571d029ffb31942d52687c56da4fc8\" data-default-watermark-src=\"https://pica.zhimg.com/v2-7fbc599173b6b50f1e6adf0a160233f8_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1202\" data-original=\"https://pica.zhimg.com/v2-d5571d029ffb31942d52687c56da4fc8_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-f4e110181ad76645cef1c1595281d268_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1200\" data-rawheight=\"815\" data-original-token=\"v2-f4e110181ad76645cef1c1595281d268\" data-default-watermark-src=\"https://pic2.zhimg.com/v2-ec9d801161676ea8aa7fbcc3079caf27_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1200\" data-original=\"https://pic1.zhimg.com/v2-f4e110181ad76645cef1c1595281d268_r.jpg\"/></figure><h3>7.2.续资治通鉴 文白对照全译 第二册 沈志华主编 改革出版社</h3><p data-pid=\"WlheFViZ\">下载链接：</p><a href=\"https://link.zhihu.com/?target=https%3A//url86.ctfile.com/f/32005086-976776985-a70360%3Fp%3D5422\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">续资治通鉴 文白对照全译 第二册 沈志华主编 改革出版社.pdf</a><p data-pid=\"gDDFIpaE\">访问密码：5422</p><figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-3797fdafa7efba59c5fa498370b44011_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1164\" data-rawheight=\"791\" data-original-token=\"v2-3797fdafa7efba59c5fa498370b44011\" data-default-watermark-src=\"https://pic1.zhimg.com/v2-abc6a4275a07885aa1388936123d04b2_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1164\" data-original=\"https://pic2.zhimg.com/v2-3797fdafa7efba59c5fa498370b44011_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-38a67d0a78df6b964722c42e391d318b_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1156\" data-rawheight=\"814\" data-original-token=\"v2-38a67d0a78df6b964722c42e391d318b\" data-default-watermark-src=\"https://pic4.zhimg.com/v2-1626433d699fa178d7979090936f831f_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1156\" data-original=\"https://pic4.zhimg.com/v2-38a67d0a78df6b964722c42e391d318b_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-1f1f92e1d48cf4127ed3661cb3270f7c_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1159\" data-rawheight=\"812\" data-original-token=\"v2-1f1f92e1d48cf4127ed3661cb3270f7c\" data-default-watermark-src=\"https://pic1.zhimg.com/v2-5eb174ca3fceda1c2ecd79255e4bdc5a_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1159\" data-original=\"https://pic3.zhimg.com/v2-1f1f92e1d48cf4127ed3661cb3270f7c_r.jpg\"/></figure><h3>7.3.续资治通鉴 文白对照全译 第三册 沈志华主编 改革出版社</h3><p data-pid=\"eImlOG15\">下载链接：</p><a href=\"https://link.zhihu.com/?target=https%3A//url86.ctfile.com/f/32005086-976777471-4d6e55%3Fp%3D5422\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">续资治通鉴 文白对照全译 第三册 沈志华主编 改革出版社.pdf</a><p data-pid=\"EfbPhc87\">访问密码：5422</p><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-d6e9106aa65a715fa4c862ee0035caa2_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1161\" data-rawheight=\"791\" data-original-token=\"v2-d6e9106aa65a715fa4c862ee0035caa2\" data-default-watermark-src=\"https://pic4.zhimg.com/v2-752e0873abb6c769a999178796019d79_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1161\" data-original=\"https://pic1.zhimg.com/v2-d6e9106aa65a715fa4c862ee0035caa2_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-1e0c22df1568d484f8754e5f7ca580ef_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1156\" data-rawheight=\"810\" data-original-token=\"v2-1e0c22df1568d484f8754e5f7ca580ef\" data-default-watermark-src=\"https://pic1.zhimg.com/v2-eecd8eea86b6cac801ab584ae6e06c48_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1156\" data-original=\"https://pic4.zhimg.com/v2-1e0c22df1568d484f8754e5f7ca580ef_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-1a6944755a0c346a967e1557df242e9d_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1154\" data-rawheight=\"811\" data-original-token=\"v2-1a6944755a0c346a967e1557df242e9d\" data-default-watermark-src=\"https://pic2.zhimg.com/v2-a318aed7b2dd582cd98b34a5a763506b_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1154\" data-original=\"https://pic4.zhimg.com/v2-1a6944755a0c346a967e1557df242e9d_r.jpg\"/></figure><h3>7.4.续资治通鉴 文白对照全译 第四册 沈志华主编 改革出版社</h3><p data-pid=\"62WDL6IL\">下载链接：</p><a href=\"https://link.zhihu.com/?target=https%3A//url86.ctfile.com/f/32005086-976779061-22cb8b%3Fp%3D5422\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">续资治通鉴 文白对照全译 第四册 沈志华主编 改革出版社.pdf</a><p data-pid=\"uIo86nx6\">访问密码：5422</p><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-2f4839f809b14e3295a2ac1f4b0f1490_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1159\" data-rawheight=\"791\" data-original-token=\"v2-2f4839f809b14e3295a2ac1f4b0f1490\" data-default-watermark-src=\"https://pic3.zhimg.com/v2-14204e9ded351ba445db911513ba5e2a_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1159\" data-original=\"https://pic3.zhimg.com/v2-2f4839f809b14e3295a2ac1f4b0f1490_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-ebd2d129342093703485a507c6c797c5_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1154\" data-rawheight=\"802\" data-original-token=\"v2-ebd2d129342093703485a507c6c797c5\" data-default-watermark-src=\"https://pica.zhimg.com/v2-c9a50c4228e1275a81ff784be9cfc03a_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1154\" data-original=\"https://pic2.zhimg.com/v2-ebd2d129342093703485a507c6c797c5_r.jpg\"/></figure><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-dfe779cbd6fa86a5cd577141599453f3_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1154\" data-rawheight=\"810\" data-original-token=\"v2-dfe779cbd6fa86a5cd577141599453f3\" data-default-watermark-src=\"https://pic2.zhimg.com/v2-d93d912aff8e79c70a8ba8b23d866967_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1154\" data-original=\"https://pic4.zhimg.com/v2-dfe779cbd6fa86a5cd577141599453f3_r.jpg\"/></figure><h2>八、其他</h2><a href=\"https://www.zhihu.com/answer/3284836007\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https://pica.zhimg.com/v2-aa8f99d4d75ad63fa18db1fac71b736a_180x120.jpg\" data-image-width=\"1175\" data-image-height=\"821\" class=\"internal\">如何阅读《二十四史》？</a><a href=\"https://www.zhihu.com/answer/3277939188\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https://pic2.zhimg.com/v2-6c6acb0cf18ed62fcfad2f2df08b33a7_180x120.jpg\" data-image-width=\"1281\" data-image-height=\"812\" class=\"internal\">剑桥中国史和哈佛中国史有什么区别？</a><a href=\"https://www.zhihu.com/answer/3275007502\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https://pic4.zhimg.com/v2-45f509c8169de880960f4a9996bb0079_180x120.jpg\" data-image-width=\"1322\" data-image-height=\"782\" class=\"internal\">还有哪些类似《明朝那些事儿》这种通俗性的通史读物可以推荐？</a><p></p>",
        "relationship": {
          "is_thanked": false,
          "is_nothelp": false,
          "voting": 0
        },
        "is_labeled": false,
        "visited_count": 55749,
        "thumbnails": [
          "https://picx.zhimg.com/50/v2-596f458b37d10d2a4168019288385c16_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-dcba8715fbfc68a30a3467847289d855_720w.jpg?source=b6762063",
          "https://pica.zhimg.com/50/v2-589696d27445127515a1d06c2a00116b_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-5eb9142f3dae207d64c121890b2a1e2d_720w.jpg?source=b6762063",
          "https://pic1.zhimg.com/50/v2-92a962f9673a7472d573f7d8d5d5a33b_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-1ea1f63195b06307e27b10417780ac89_720w.jpg?source=b6762063",
          "https://pic1.zhimg.com/50/v2-86e96b2587bf135a225d06b55829514f_720w.jpg?source=b6762063",
          "https://pica.zhimg.com/50/v2-466b07f825c8951fe75edfb3b9068293_720w.jpg?source=b6762063",
          "https://pica.zhimg.com/50/v2-f255d80618cbd090ced53457a3ba9e7b_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-adbbe5072bff9ae76cbfea514c099a69_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-ae5bf4305eca8cbe2267e42e211fbc86_720w.jpg?source=b6762063",
          "https://pica.zhimg.com/50/v2-d915fad2adfd93c8f681e626e0c0ae45_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-f974118a49f841bc6a208b1308fe5289_720w.jpg?source=b6762063",
          "https://pic1.zhimg.com/50/v2-7c391d783a7d55fe6eb0a19b9b77efed_720w.jpg?source=b6762063",
          "https://pic1.zhimg.com/50/v2-d08d742741d481b330ebd81a4a9f678b_720w.jpg?source=b6762063",
          "https://pic1.zhimg.com/50/v2-7d8b05025758975a696538be348fb22c_720w.jpg?source=b6762063",
          "https://pic1.zhimg.com/50/v2-76b84a6d0142d6dd47e667287181d0c2_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-f10d66ea945bce9d5b757ede9bdcb6cb_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-4278781b48a615cb087410062da0c1be_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-416f7dafd8fcbb77e6def6cc8cff42d0_720w.jpg?source=b6762063",
          "https://pic1.zhimg.com/50/v2-a233378fd431a17a026f2e857f752e68_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-e981c82d18f94ea834762e50d687f530_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-40a755e09b84b17c83dd4a77c9b5cdf5_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-7eba32bd4ac0c90133961262de6deef3_720w.jpg?source=b6762063",
          "https://pic1.zhimg.com/50/v2-1516133f196b8fcfa0a14db9e27c1450_720w.jpg?source=b6762063",
          "https://pic1.zhimg.com/50/v2-a2cb8a67c012f67240b6d8f3cdb1bafb_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-9ab046a03c39e51a94f597ecf1d70c18_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-bd290d926b72c3e9b77175dc3d2dcc72_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-e9acf979bf77015549046d66dea7658f_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-f18e4c7e1bb8ffedf9105993c75470a9_720w.jpg?source=b6762063",
          "https://pic1.zhimg.com/50/v2-a1b8a558f889a1e94abb7e36089b4cd7_720w.jpg?source=b6762063",
          "https://pica.zhimg.com/50/v2-a73b92fac24df12d835758ac86db93b4_720w.jpg?source=b6762063",
          "https://pica.zhimg.com/50/v2-1343026637e7a1270ab59dfb71849bc4_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-253891a61d2dc734e6e853196413fd01_720w.jpg?source=b6762063",
          "https://picx.zhimg.com/50/v2-55871dd427e5ccdf70310a1568529f0d_720w.jpg?source=b6762063",
          "https://pica.zhimg.com/50/v2-d27785c70a32e52f094b3be7f10fe4ba_720w.jpg?source=b6762063",
          "https://pic1.zhimg.com/50/v2-990e81441b407001366ccf6deb3b8965_720w.jpg?source=b6762063",
          "https://pica.zhimg.com/50/v2-00fff2d972018ad17c4a03d10c99985b_720w.jpg?source=b6762063"
        ],
        "favorite_count": 1565,
        "answer_type": "normal",
        "is_navigator": false,
        "navigator_vote": false,
        "vote_next_step": "vote"
      },
      "brief": "{\"source\": \"TS\", \"type\": \"answer\", \"id\": 3293988485}",
      "attached_info": "CvgTCLmHweq9gb3SvgEQBBoJNjI4OTg1NTM5IKSD5KoGKN4CMBdA4QRKQgotVFNfU09VUkNFX1RXT1RPV0VSX01VTFRJX1NDRU5FX1YxX1JFQ0FMTF9URVhUEgEwGAAgADoKeyJyYXciOiIifVoHMzY2ODQ0OWIgZjA3NWJiMDBjMjlmNGMzMzYyNWE1OWJiMzUxYWUwYTdyCjMyOTM5ODg0ODWKAQgyODcxMzc1N6oBCXJlY29tbWVuZMIBIGRkNTQxMWU4YzRlYjA4ZTQxNTBiYTQwZjY5NThlMzI48gEKCAwSBk5vcm1hbPIBKAgKEiRmNmYzMDM2Ny02ZDU5LTRjN2ItYWY4NC02MjNmNDcwZGI5ZmXyAQcICxIDMTAyggIAiALWmc75jDOSAiBkZDU0MTFlOGM0ZWIwOGU0MTUwYmE0MGY2OTU4ZTMyOJoCAMoCFlNob3JJbnRlcmVzdFdlaWdodFJ1bGXKAhVVc2VyTGNuRXhpdFdlaWdodFJ1bGXKAhRDb250ZW50QWdlV2VpZ2h0UnVsZcoCF1Rlc3RlZEFuZFdvcmtXZWlnaHRSdWxl2gItVFNfU09VUkNFX1RXT1RPV0VSX01VTFRJX1NDRU5FX1YxX1JFQ0FMTF9URVhU6AIC+gILTk9STUFMX0ZMT1eKAyA4NDExNzYzNjM5NmM0MDZhYTNhMDEwMmMxOGE1ZmQ3ZZoDDQoCdjIQABoFb3RoZXKoA8WzA9gDAOoDFXRleHRGZWVkVHdvVG93ZXJWMUFsbPoDmQ4SDFVOS05PV05fTU9ERSAAKg1OT19JTUFHRV9NT0RFOi0IAhC3CBirBiIjdjItZWZjZjk0MTkxZWJkYzFkOWY1OTExNmE1ZTQwNDZmN2I6LQgCENcIGKsGIiN2Mi1mODJjZWFlN2IxM2YwMmVhOTA3MTNjMjI2NzhiMzcxNjotCAIQswgYrgYiI3YyLTg3NzUwZjQ2NjU0NDBkZWIxOGE0NWIzNmFiYjBiYmRjOi0IAhC0CBirBiIjdjItZGM4MjM0ZGRlZTBlY2YxNzRkZWFiZWU3NTQxMzM4OTE6LQgCELUIGLAGIiN2Mi00ZDA3ZjNmMjQ4NmUyMjQxYzdhYjljNjlmNzQyYTFjYzotCAIQlgkYrwYiI3YyLWNkMjlkZTJhZDVkN2Q1ZWExZDA1ZWYzNzM1M2IyOTQ5Oi0IAhCSCRisBiIjdjItMzE5ZDI5YzJkNzQ0ZTY5YTM1Mjg1MzJjOWYzNDE5Mjc6LQgCEJQJGK4GIiN2Mi1iYmM2NmFkNDFkZTBjNWFmMDdlODg2YjQ0ZmQ4NGM1ZjotCAIQhgoYsQYiI3YyLTZiMmRmYzVlODZiZjJkMzY1M2JmYjJiZjA5MTM1N2E2Oi0IAhCCChiwBiIjdjItNjJhZGM3OTc5NGM3YzBjYTgzNWZkYmEzOGQzODJhNjk6LQgCEP8JGK4GIiN2Mi0wYWUyMjdhNjQwMTA1ODI0MWFmOTUxZDIyNzcyMTY0YTotCAIQ/wkYrgYiI3YyLWUxYmUyOGRiODA3YWIxYmM2ZjY1YWI3YTk2MGY4YTI5Oi0IAhCWCRixBiIjdjItMmY3MjhhZGVlNWE4MjNjODU4NDBiMDYyNzMzOWRmZjU6LQgCEJMJGLAGIiN2Mi04Njk4NWM3NDllMTcxNmJhMjk2Y2E4YWE1ZjI3ZWM3MDotCAIQkwkYsAYiI3YyLWM3MGM0ODFiNDkwZDQ1NTQwMmEwYzVmMTY5ZTQ0ODI5Oi0IAhCRCRinBiIjdjItMzA2Y2NlNGU4ZjhhM2E0MTVjMjdjNWY3MzkwMTY1ZWQ6LQgCEIwJGK4GIiN2Mi1jOWMwYzAzNDY0MDdhYjA2YjNmNmYxNTQ2OGQ0ZWY0MjotCAIQlgkYsQYiI3YyLWE4MjBmMTgxMDU2ZTAyNWZjMTAwZGJkNWI4YWQ5ZmVjOi0IAhCWCRiwBiIjdjItZjlhODBhZDJjNzY4MGIxN2NjM2NkZTVhYjI0ZTgwOGM6LQgCEJMJGKwGIiN2Mi0xNDUwNmU0N2NhYjQ3Y2Q0YjZjNDNlMDY4ZmY5YWU3MTotCAIQlAkYrwYiI3YyLTA2ZGY5MjI5OWFkM2MzNjc4M2ZkNTAzNDk0ZDI3YTYzOi0IAhCAChivBiIjdjItOTQxYTZkNDk4MjQzOWRhOGRjMjg2OGUxMGQzODcyMmE6LQgCEP8JGK8GIiN2Mi1kYmFkOGNjNDQ0NmU3OTI0NDc2MjY4MDA1YWUyZGY2YTotCAIQ/QkYrwYiI3YyLTRhY2MwYzk1Yzk2Y2Y0Mzg1ODM4ZDhkZTcwZmJmMWI4Oi0IAhCAChirBiIjdjItNTVmYjhlZmM1MzBjZjI5NTc3NGMzZWMzMzM1MmM5Zjg6LQgCELIJGLkGIiN2Mi0zOGJmN2MxZTJkZGNhMGE5YTVmMTNjYzdhMDc5Zjk5YjotCAIQsgkYtgYiI3YyLWRhZTQ4YWY5MTQxY2JmNDFhZTg2ZmI3ZmE0OGEzMGFlOi0IAhCyCRi2BiIjdjItZDU1NzFkMDI5ZmZiMzE5NDJkNTI2ODdjNTZkYTRmYzg6LQgCELAJGK8GIiN2Mi1mNGUxMTAxODFhZDc2NjQ1Y2VmMWMxNTk1MjgxZDI2ODotCAIQjAkYlwYiI3YyLTM3OTdmZGFmYTdlZmJhNTljNWZhNDk4MzcwYjQ0MDExOi0IAhCECRiuBiIjdjItMzhhNjdkMGE3OGRmNmI5NjQ3MjJjNDJlMzkxZDMxOGI6LQgCEIcJGKwGIiN2Mi0xZjFmOTJlMWQ0OGNmNDEyN2VkMzY2MWNiMzI3MGY3YzotCAIQiQkYlwYiI3YyLWQ2ZTkxMDZhYTY1YTcxNWZhNGM4NjJlZTAwMzVjYWEyOi0IAhCECRiqBiIjdjItMWUwYzIyZGYxNTY4ZDQ4NGY4NzU0ZTVmN2NhNTgwZWY6LQgCEIIJGKsGIiN2Mi0xYTY5NDQ3NTVhMGMzNDZhOTY3ZTE1NTdkZjI0MmU5ZDotCAIQhwkYlwYiI3YyLTJmNDgzOWY4MDliMTRlMzI5NWEyYWMxZjRiMGYxNDkwOi0IAhCCCRiiBiIjdjItZWJkMmQxMjkzNDIwOTM3MDM0ODVhNTA3YzZjNzk3YzU6LQgCEIIJGKoGIiN2Mi1kZmU3NzljYmQ2ZmE4NmE1Y2Q1NzcxNDE1OTk0NTNmM4AEAIgEAJIEBk5vcm1hbJoEATKgBACoBACwBAC6BAZtYW51YWzCBAMxNzDIBADSBA/mjqjojZDlt7Lmm7TmlrDYBADwBAD5BAAAAGC2qpE/gQUAAAAAAAAAAIkFuORIvRNU2T+SBQCaBQNkZnSiBQNkZnSyBQExuQUAAAAAAAAAANAFAOAFAOgFAPAFZpAGAKAG5wSoBgCSAiUKCTYyODk4NTUzORIKMzI5Mzk4ODQ4NRgEIgpJTUFHRV9URVhU",
      "action_card": false
    },
    {
      "id": "610_1755822919.304",
      "type": "feed",
      "offset": 610,
      "verb": "TOPIC_ACKNOWLEDGED_ARTICLE",
      "created_time": 1755822919,
      "updated_time": 1755822919,
      "target": {
        "id": "1941900323959580249",
        "type": "article",
        "url": "https://api.zhihu.com/articles/1941900323959580249",
        "author": {
          "id": "c7c140d8ff2d94b58ea0954b8be40cef",
          "url": "https://api.zhihu.com/people/c7c140d8ff2d94b58ea0954b8be40cef",
          "user_type": "people",
          "url_token": "yao-yao-mu-21",
          "name": "木夭夭",
          "headline": "手里有事，心里有光",
          "avatar_url": "https://picx.zhimg.com/50/v2-3aa9187b940d7c561999fa0aeeca5328_l.jpg?source=b6762063",
          "is_org": false,
          "gender": -1,
          "followers_count": 1,
          "is_following": false,
          "is_followed": false
        },
        "title": "多模态大模型镜像安装踩过的坑",
        "comment_permission": "all",
        "created": 1755765245,
        "updated": 1755765245,
        "voteup_count": 1,
        "voting": 0,
        "comment_count": 0,
        "linkbox": {
          "category": "",
          "pic": "",
          "title": "",
          "url": ""
        },
        "excerpt": "Docker cp 复制问题 cd /ai_paas/ai_paas_weilx/models tar cvf - --exclude=&#39;.*&#39; Qwen2___5-1___5B-Instruct | \\ docker exec -i deepseek-r1-inference-23456 tar xf - -C /work/model 排除排除隐藏文件（推荐），避免权限问题 内存溢出问题，nvidia-smi显示还有内存但是模型的log显示cuda.outofmemory、 报错如下 torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 28.00 MiB. GPU 1 has a total capacty …",
        "excerpt_new": "Docker cp 复制问题 cd /ai_paas/ai_paas_weilx/models tar cvf - --exclude=&#39;.*&#39; Qwen2___5-1___5B-Instruct | \\ docker exec -i deepseek-r1-inference-23456 tar xf - -C /work/model 排除排除隐藏文件（推荐），避免权限问题 内存溢出问题，nvidia-smi显示还有内存但是模型的log显示cuda.outofmemory、 报错如下 torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 28.00 MiB. GPU 1 has a total capacty …",
        "preview_type": "default",
        "preview_text": "",
        "content": "<h3>Docker cp 复制问题</h3><p data-pid=\"H5wENTx8\"><br/>cd /ai_paas/ai_paas_weilx/models<br/> tar cvf - --exclude=&#39;.*&#39; Qwen2___5-1___5B-Instruct | \\   docker exec -i deepseek-r1-inference-23456 tar xf - -C /work/model<br/> 排除排除隐藏文件（推荐），避免权限问题<br/></p><h3><br/>内存溢出问题，nvidia-smi显示还有内存但是模型的log显示cuda.outofmemory、<br/>报错如下</h3><div class=\"highlight\"><pre><code class=\"language-text\">torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 28.00 MiB. GPU 1 has a total capacty of 44.35 GiB of which 22.12 MiB is free. Process 291799 has 2.49 GiB memory in use. Process 364716 has 40.40 GiB memory in use. Process 266460 has 262.00 MiB memory in use. Process 275564 has 1.14 GiB memory in use. Of the allocated memory 619.38 MiB is allocated by PyTorch, and 46.62 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF [W CudaIPCTypes.cpp:15] Producer process has been terminated before all shared CUDA tensors released. See Note [Sharing CUDA tensors]</code></pre></div><p data-pid=\"Ab61aVOE\"><br/>解决方法<br/>查看 /work/code的推理文件run.sh文件内的参数<br/></p><ol><li data-pid=\"cb7h6JIn\">gpu-memory-utilization显卡占用百分比的设置从0.9改成0.25，原因测试模型是1.5B的模型不需要太高的显存占用量 提醒：gpu-memory-utilization的数值要根据显卡的余量以及测试模型的大小决定</li><li data-pid=\"AWqN9-4i\">CUDA_VISIBLE_DEVICES的显卡编号是否是还有余量的卡</li></ol><h3>CUDA_VISIBLE_DEVICES，显卡编号，指定要用哪些卡 tensor-parallel-size 个数要与CUDA_VISIBLE_DEVICES一致 比如，CUDA_VISIBLE_DEVICES=2,4  则tensor-parallel-size=2 另外，经过tensor-parallel-size之后在模型的输出log里面会将GPU重新编号从GPU2，GPU4变成GPU0，GPU1<br/><br/><br/>端口问题<br/></h3><ol><li data-pid=\"5QCvwcGT\">在创建docker容器之前先检查端口是否被占用 ps -ef|grep 23456</li><li data-pid=\"lQoU8o45\">区分宿主机的端口以及映射到容器内的端口 比如</li></ol><p data-pid=\"C-2OHnSE\">docker run -itd \\   -v /aipaas_test/model:/work/model \\   -p 23457:2243 \\   -p 23458:2244 \\   --name duomotai-inference \\   --privileged=True \\   --gpus all \\   --shm-size=16g \\   --ulimit memlock=-1 \\   qwen2_5vl:v1.1 \\   env LANG=C.UTF-8 /bin/bash<br/>23457:2243 表示将宿主机的 23457 端口映射到容器内的 2243 端口。 <br/>23458:2244 表示将宿主机的 23458 端口映射到容器内的 2244 端口。<br/>Docker 端口映射格式为：<code>-p 宿主机端口:容器内端口</code><br/></p><ul><li data-pid=\"rcygz0YJ\">容器内端口：必须固定为 2243（WS）和 2244（HTTP），因为这是镜像内服务监听的端口（硬编码在启动脚本中）。</li><li data-pid=\"qnMf8hPY\">宿主机端口：可自定义，只要未被占用即可，建议选择 10000-65535 之间的端口（避免与系统常用端口冲突）。</li></ul><p data-pid=\"VFrjql9h\">访问服务时使用新端口：外部调用服务时，需用宿主机的新端口，例如：<br/></p><ul><li data-pid=\"LrA_0V9X\">HTTP 接口：<code>http://宿主机IP:2254/v1/chat/completions</code></li><li data-pid=\"BPaRZIof\">WS 接口：<code>ws://宿主机IP:2253/v1/chat/completions</code></li></ul><p data-pid=\"DkRkRv9q\"><br/>我的23457是空闲的。我在镜像里面运行模型run.sh，port应该填写哪个端口？再调用模型是url=主机：端口，这个端口应该填写什么<br/><b>端口总结</b><br/></p><ul><li data-pid=\"seGzDjnp\"><b>若<code>run.sh</code>脚本中需指定端口，仍填写容器内的固定端口（<code>2243</code>/<code>2244</code>），与宿主机映射的<code>23457</code>/<code>23458</code>无关；</b></li><li data-pid=\"0m6kAHdC\"><b>外部调用模型时，URL 仍用宿主机端口（如<code>http://宿主机IP:23458/v1/chat/completions</code>）</b></li></ul><p></p>",
        "is_labeled": false,
        "visited_count": 27,
        "favorite_count": 0,
        "article_type": "normal",
        "is_navigator": false,
        "navigator_vote": false,
        "vote_next_step": "vote"
      },
      "brief": "{\"source\": \"TS\", \"type\": \"article\", \"id\": 1941900323959580249}",
      "attached_info": "CtsFCLmHweq9gb3SvgEQBxoJMjYyMDYzOTY5IP2zm8UGKAEwAEDiBEokChlUU19TT1VSQ0VfV0FSTV9VUF9OT1JNQUwyEgEwGAAgADoASi0KIlRTX1NPVVJDRV9XQVJNX1VQX0hJR0hfSU5URVJBQ1RJT04SATAYACAAOgBiIGYwNzViYjAwYzI5ZjRjMzM2MjVhNTliYjM1MWFlMGE3chMxOTQxOTAwMzIzOTU5NTgwMjQ5qgEJcmVjb21tZW5kwgEgYzdjMTQwZDhmZjJkOTRiNThlYTA5NTRiOGJlNDBjZWbyAQoIDBIGTm9ybWFs8gEoCAoSJDFjZTdhMGZiLTE5M2UtNDdmMS1iMjY1LWYwZTc2NjlmOTZhYvIBBwgLEgMxMDKCAgCIAtaZzvmMM5ICIGM3YzE0MGQ4ZmYyZDk0YjU4ZWEwOTU0YjhiZTQwY2VmmgIAygIWU2hvckludGVyZXN0V2VpZ2h0UnVsZcoCFVVzZXJMY25FeGl0V2VpZ2h0UnVsZcoCGENvbnRlbnRXYXJtVXBCcmVha0luUnVsZdoCGVRTX1NPVVJDRV9XQVJNX1VQX05PUk1BTDLoAgP6AgtOT1JNQUxfRkxPV4oDIDg0MTE3NjM2Mzk2YzQwNmFhM2EwMTAyYzE4YTVmZDdlmgMNCgJ2MhAAGgVvdGhlcqgDG9gDAOoDHnRleHRfaGlnaF9pbnRlcmFjdGlvbl9yZWNhbGxlcvoDHxIMVU5LTk9XTl9NT0RFIAAqDU5PX0lNQUdFX01PREWABACIBACSBAZOb3JtYWyaBAEzoAQAqAQAsAQAugQCYWnCBAM0MDDIBADSBA/mjqjojZDlt7Lmm7TmlrDYBADwBAD5BAAAAIBjuH8/gQUAAAAAAAAAAIkFuORIvRNU2T+SBQCaBQNkZnSiBQNkZnSyBQExuQUAAAAAAAAAANAFAOAFAOgFAPAFZpAGAKAG6ASoBgGSAi4KCTI2MjA2Mzk2ORITMTk0MTkwMDMyMzk1OTU4MDI0ORgHIgpJTUFHRV9URVhU",
      "action_card": false
    },
    {
      "id": "611_1755822919.431",
      "type": "feed",
      "offset": 611,
      "verb": "TOPIC_ACKNOWLEDGED_ARTICLE",
      "created_time": 1755822919,
      "updated_time": 1755822919,
      "target": {
        "id": "1941562321634849678",
        "type": "article",
        "url": "https://api.zhihu.com/articles/1941562321634849678",
        "author": {
          "id": "235c418e931651c371df4ae150768af9",
          "url": "https://api.zhihu.com/people/235c418e931651c371df4ae150768af9",
          "user_type": "people",
          "url_token": "zhi-re-shi-ni-233",
          "name": "程序员吴彦祖",
          "headline": "",
          "avatar_url": "https://picx.zhimg.com/50/v2-45387c1e2add65946bb3c8ad2573c229_l.jpg?source=b6762063",
          "is_org": false,
          "gender": 1,
          "followers_count": 517,
          "is_following": false,
          "is_followed": false
        },
        "title": "【保姆级教程】手把手带你从零搭建：PyTorch实现LLaMA4 MoE模型训练与生成，建议收藏！！",
        "comment_permission": "all",
        "created": 1755684690,
        "updated": 1755684690,
        "voteup_count": 2,
        "voting": 0,
        "comment_count": 0,
        "linkbox": {
          "category": "",
          "pic": "",
          "title": "",
          "url": ""
        },
        "excerpt": "前言近年来，大语言模型在自然语言处理领域不断演进，从GPT系列到LLaMA，持续推动模型规模与推理性能的提升。其中， 专家混合（Mixture of Experts, MoE） 技术因能够在控制推理成本的同时显著扩展模型容量，正成为新一代模型的重要发展方向。本文将以工程实现为核心，完整展示一个 LLaMA4风格MoE语言模型的构建流程，包括：数据预处理：SentencePiece分词、Token ID编码、滑动窗口切分；模型结构：RMSNorm、RoPE位置编码、多头…",
        "excerpt_new": "前言近年来，大语言模型在自然语言处理领域不断演进，从GPT系列到LLaMA，持续推动模型规模与推理性能的提升。其中， 专家混合（Mixture of Experts, MoE） 技术因能够在控制推理成本的同时显著扩展模型容量，正成为新一代模型的重要发展方向。本文将以工程实现为核心，完整展示一个 LLaMA4风格MoE语言模型的构建流程，包括：数据预处理：SentencePiece分词、Token ID编码、滑动窗口切分；模型结构：RMSNorm、RoPE位置编码、多头…",
        "preview_type": "default",
        "preview_text": "",
        "content": "<h2><b>前言</b></h2><p data-pid=\"pHR4VTV1\">近年来，大语言模型在自然语言处理领域不断演进，从GPT系列到LLaMA，持续推动模型规模与推理性能的提升。其中，<b>专家混合（Mixture of Experts, MoE）</b> 技术因能够在控制推理成本的同时显著扩展模型容量，正成为新一代模型的重要发展方向。</p><p data-pid=\"M5G07SCw\">本文将以工程实现为核心，完整展示一个<b>LLaMA4风格MoE语言模型</b>的构建流程，包括：</p><ul><li data-pid=\"KPIwYxCl\"><b>数据预处理</b>：SentencePiece分词、Token ID编码、滑动窗口切分；</li><li data-pid=\"oHtpddVx\"><b>模型结构</b>：RMSNorm、RoPE位置编码、多头注意力、MoE专家路由与共享专家路径；</li><li data-pid=\"3ZdtaiUZ\"><b>训练实现</b>：超参数配置、训练循环、梯度裁剪与模型保存；</li><li data-pid=\"DSe_hWZH\"><b>推理生成</b>：自回归采样及温度与Top-K策略。</li></ul><p data-pid=\"k5AVUyCJ\">本文涵盖从语料准备到可运行模型的完整实现流程，并系统呈现LLaMA4-MoE架构的关键技术要点。</p><h3><b>一、数据预处理与数据集构建</b></h3><p data-pid=\"j-7MD-db\">在实现一个<b>LLaMA4风格的MoE（Mixture of Experts）语言模型</b>之前，第一步就是——<b>数据预处理</b>。</p><p data-pid=\"TkeAa1Fc\">不管你是要训练一个<b>10亿参数级别的大模型</b>，还是在小数据集上做验证实验，<b>稳定、高效的数据处理流程</b>都是成败的关键。</p><h2><b>（一）训练SentencePiece分词器</b></h2><p data-pid=\"VHDbRTG9\">在模型看懂文本之前，必须先把自然语言转成<b>Token ID</b>。这里我们选用 Google 出品的<b>SentencePiece</b>工具，并采用<b>BPE（Byte Pair Encoding）</b>作为分词算法——它在大多数 NLP 任务中都表现稳定。</p><p data-pid=\"JumyplsF\">下面的函数<code>train_tokenizer</code>从语料库训练分词器，并将模型文件保存为指定前缀：</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"kn\">import</span> <span class=\"nn\">osimport</span> <span class=\"nn\">sentencepiece</span> <span class=\"kn\">as</span> <span class=\"nn\">spm</span>\n<span class=\"k\">def</span> <span class=\"nf\">train_tokenizer</span><span class=\"p\">(</span><span class=\"n\">corpus_path</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">model_prefix</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;spm_tokenizer&#39;</span><span class=\"p\">,</span> <span class=\"n\">vocab_size</span><span class=\"p\">:</span> <span class=\"nb\">int</span> <span class=\"o\">=</span> <span class=\"mi\">32000</span><span class=\"p\">):</span>    <span class=\"k\">assert</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">exists</span><span class=\"p\">(</span><span class=\"n\">corpus_path</span><span class=\"p\">),</span> <span class=\"n\">f</span><span class=\"s2\">&#34;corpus file not found: {corpus_path}&#34;</span>    <span class=\"n\">spm</span><span class=\"o\">.</span><span class=\"n\">SentencePieceTrainer</span><span class=\"o\">.</span><span class=\"n\">train</span><span class=\"p\">(</span>        <span class=\"nb\">input</span><span class=\"o\">=</span><span class=\"n\">corpus_path</span><span class=\"p\">,</span>                <span class=\"c1\"># 语料文件路径        model_prefix=model_prefix,        # 输出模型文件名前缀        vocab_size=vocab_size,            # 词表大小        model_type=&#39;bpe&#39;,                  # 分词算法：BPE        character_coverage=1.0,            # 覆盖全部字符（适合中英文混合语料）        bos_id=-1,                         # 不自动添加句首标记        eos_id=-1                          # 不自动添加句尾标记    )</span></code></pre></div><p data-pid=\"FVZbav6K\">这里有几个细节值得注意：</p><ul><li data-pid=\"4pCKSYdE\"><b>character_coverage=1.0</b>：确保覆盖全部字符，适合中英文混合的语料，避免因覆盖率不足导致某些字符被替换成未知符号（<code>&lt;unk&gt;</code>）。</li><li data-pid=\"BhH9LwWn\"><b>bos_id和eos_id设置为-1</b>：禁用分词器自动添加句首（BOS）和句尾（EOS）标记。这样做是为了我们可以手动插入这些特殊符号，从而灵活控制其添加位置。例如，长文本拼接时只需在整个序列的开头和结尾加一次BOS/EOS，而不是每句话都加，保证数据格式一致且无冗余标记。</li></ul><p data-pid=\"_x20_6TL\">完成这一步后，分词器就会根据你的语料库生成适配的词表和模型文件，为后续的<b>文本编码</b>打下稳定的基础。</p><p data-pid=\"v9pIGxxy\">【PS：为了帮助更多热爱技术、渴望成长的朋友，我特别整理了一份涵盖大模型领域的宝贵资料集，内容包含：<b>DeepSeek部署安装教程，AI大模型入门学习思维导图、精品AI大模型学习书籍手册、视频教程、实战学习</b>等录播视频，有需要的朋友可以点击下方卡片免费获取！】</p><a href=\"https://zhuanlan.zhihu.com/p/1940068345966757141\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\"internal\">【2025最新总结】AI大模型全套学习资料，免费领取！含最新学习路线、大厂面试真题、可落地的项目实战、经典的PDF书籍.......</a><h3><b>（二）加载分词器并将文本编码为Token ID</b></h3><h3><b>有了训练好的SentencePiece模型文件，我们首先将其加载进来：</b></h3><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"k\">def</span> <span class=\"nf\">load_tokenizer</span><span class=\"p\">(</span><span class=\"n\">model_file</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">spm</span><span class=\"o\">.</span><span class=\"n\">SentencePieceProcessor</span><span class=\"p\">:</span>    <span class=\"n\">sp</span> <span class=\"o\">=</span> <span class=\"n\">spm</span><span class=\"o\">.</span><span class=\"n\">SentencePieceProcessor</span><span class=\"p\">()</span>    <span class=\"n\">sp</span><span class=\"o\">.</span><span class=\"n\">load</span><span class=\"p\">(</span><span class=\"n\">model_file</span><span class=\"p\">)</span>    <span class=\"k\">return</span> <span class=\"n\">sp</span></code></pre></div><h3><b>加载模型后，我们可以把原始文本编码成token ID并保存：</b></h3><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"k\">def</span> <span class=\"nf\">encode_and_save_ids</span><span class=\"p\">(</span><span class=\"n\">corpus_path</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">sp_model</span><span class=\"p\">:</span> <span class=\"n\">spm</span><span class=\"o\">.</span><span class=\"n\">SentencePieceProcessor</span><span class=\"p\">,</span> <span class=\"n\">output_path</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">):</span>    <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">corpus_path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;r&#39;</span><span class=\"p\">,</span> <span class=\"n\">encoding</span><span class=\"o\">=</span><span class=\"s1\">&#39;utf-8&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">fin</span><span class=\"p\">,</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">output_path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;w&#39;</span><span class=\"p\">,</span> <span class=\"n\">encoding</span><span class=\"o\">=</span><span class=\"s1\">&#39;utf-8&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">fout</span><span class=\"p\">:</span>        <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">fin</span><span class=\"p\">:</span>            <span class=\"n\">ids</span> <span class=\"o\">=</span> <span class=\"n\">sp_model</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"n\">line</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">(),</span> <span class=\"n\">out_type</span><span class=\"o\">=</span><span class=\"nb\">int</span><span class=\"p\">)</span>  <span class=\"c1\"># 文本 → Token ID 列表            if ids:  # 跳过空行                fout.write(&#39; &#39;.join(map(str, ids)) + &#39; &#39;)  # 用空格分隔并写入文件</span></code></pre></div><p data-pid=\"AjKmw6jF\">这里有几点要注意：</p><ul><li data-pid=\"sU7T5OTA\"><b>逐行处理</b>：每次只加载一行文本，避免大语料一次性读入内存。</li><li data-pid=\"adBOxuAD\"><b>空格分隔ID</b>：保存为一个整数序列文件，方便后续直接加载并转换为张量。</li><li data-pid=\"b0BwjT8I\"><b>末尾留一个空格</b>：方便后续拼接成连续序列时不丢ID，也不影响解析。</li></ul><p data-pid=\"e68j0l3r\">这样，我们已经成功把语料转换成了Token ID序列，训练时只需直接加载这个ID文件，就能高效地将数据送入模型进行训练。 </p><h2><b>（三）构建数据集类</b></h2><p data-pid=\"YN_iZ5rB\">在训练语言模型时，我们需要把Token ID序列切成固定长度的小片段送入模型。常用的方法是<b>滑动窗口切分</b>：</p><p data-pid=\"dIOlvxPm\">假设序列长度<code>seq_len=128</code>，我们会从编码后的ID序列中，依次截取长度为128的片段作为输入<code>x</code>，并将其<b>整体右移一位</b>得到标签序列<code>y</code>，这样模型就能学会：<b>在已知前文的情况下，推测下一个可能出现的token</b>。</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"k\">class</span> <span class=\"nc\">CharDataset</span><span class=\"p\">(</span><span class=\"n\">Dataset</span><span class=\"p\">):</span>    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">ids_path</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">seq_len</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">):</span>        <span class=\"c1\"># 读取编码后的 ID 文件，并转成整数列表        with open(ids_path, &#39;r&#39;) as f:            self.data = list(map(int, f.read().strip().split()))        self.seq_len = seq_len</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__len__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>        <span class=\"c1\"># 数据总长度减去一个窗口大小，就是可切分的样本数        return len(self.data) - self.seq_len</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__getitem__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">idx</span><span class=\"p\">):</span>        <span class=\"c1\"># 输入序列 x：从 idx 开始取 seq_len 个 token        x = torch.tensor(self.data[idx:idx + self.seq_len], dtype=torch.long)        # 标签序列 y：从 idx+1 开始取 seq_len 个 token（相当于右移一位）        y = torch.tensor(self.data[idx + 1:idx + 1 + self.seq_len], dtype=torch.long)        return x, y</span></code></pre></div><p data-pid=\"PVv1UfSO\">这里的：</p><ul><li data-pid=\"M6fUxmSo\"><b>x</b>是输入Token ID序列。</li><li data-pid=\"hocuw8v4\"><b>y</b>是右移一位的目标序列。</li><li data-pid=\"0ABLLVzx\">模型的任务就是：<b>基于x中前面t个token，去预测y中第t+1个token。</b></li></ul><p data-pid=\"FFDCi91R\">这种处理方式简单高效，几乎所有自回归语言模型都会用到。</p><h2><b>（四）构建DataLoader批次数据加载器</b></h2><p data-pid=\"Ij2D4OJd\">在PyTorch中，<code>DataLoader</code>负责将数据集分成小批次，并且在训练时打乱顺序，提高模型泛化能力。</p><p data-pid=\"GBiTD3oH\">下面的函数<code>，将前面构建好的``CharDataset</code>包装成<code>DataLoader</code>，方便后续训练时批量读取数据：</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"k\">def</span> <span class=\"nf\">prepare_dataset</span><span class=\"p\">(</span><span class=\"n\">encoded_ids_path</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">seq_len</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">batch_size</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">DataLoader</span><span class=\"p\">:</span>    <span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">CharDataset</span><span class=\"p\">(</span><span class=\"n\">encoded_ids_path</span><span class=\"p\">,</span> <span class=\"n\">seq_len</span><span class=\"p\">)</span>    <span class=\"n\">dataloader</span> <span class=\"o\">=</span> <span class=\"n\">DataLoader</span><span class=\"p\">(</span><span class=\"n\">dataset</span><span class=\"p\">,</span> <span class=\"n\">batch_size</span><span class=\"o\">=</span><span class=\"n\">batch_size</span><span class=\"p\">,</span> <span class=\"n\">shuffle</span><span class=\"o\">=</span><span class=\"bp\">True</span><span class=\"p\">,</span> <span class=\"n\">drop_last</span><span class=\"o\">=</span><span class=\"bp\">True</span><span class=\"p\">)</span>    <span class=\"k\">return</span> <span class=\"n\">dataloader</span></code></pre></div><p data-pid=\"gWCM712e\">这里：</p><ul><li data-pid=\"8z2RXuE4\"><code>batch_size</code>控制每个批次包含的样本数量。</li><li data-pid=\"5i0VjxoH\"><code>shuffle=True</code>在每轮训练开始前打乱数据顺序，提升训练效果。</li><li data-pid=\"fSdFg-rB\"><code>drop_last=True</code>保证每个批次大小一致，丢弃最后一个不满批次的数据。</li></ul><p data-pid=\"tdNwT5Il\">至此，我们已经完成了数据预处理流程——把原始文本编码成Token ID，构建成切片数据集，最终用DataLoader输出训练所需的批次数据。</p><h3><b>二、核心模型结构实现</b></h3><p data-pid=\"8ENvztBC\">完成数据预处理与DataLoader搭建后，我们进入<b>LLaMA4-MoE模型</b>的核心部分——<b>模型结构实现</b>。</p><p data-pid=\"Y_K_tkHf\">这一节，我们将一步步构建一个具备<b>RMSNorm、RoPE位置编码、多头注意力、MoE专家路由、共享专家路径</b>的LLaMA4风格语言模型。</p><h2><b>（一）RMSNorm：更稳定的归一化方式</b></h2><p data-pid=\"vBMcjqth\">在LLaMA系列的模型中，使用的是<b>RMSNorm</b>（Root Mean Square Layer Normalization），相较于传统的<b>LayerNorm</b>计算更加简单且性能更好。</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"k\">class</span> <span class=\"nc\">RMSNorm</span><span class=\"p\">(</span><span class=\"n\">nn</span><span class=\"o\">.</span><span class=\"n\">Module</span><span class=\"p\">):</span>    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">dim</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">eps</span><span class=\"p\">:</span> <span class=\"nb\">float</span> <span class=\"o\">=</span> <span class=\"mf\">1e-6</span><span class=\"p\">):</span>        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">()</span>        <span class=\"c1\"># 可训练参数gamma        self.gamma = nn.Parameter(torch.ones(dim))        self.eps = eps</span>\n    <span class=\"k\">def</span> <span class=\"nf\">forward</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">Tensor</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">Tensor</span><span class=\"p\">:</span>        <span class=\"c1\"># 计算均方根        rms = torch.sqrt(x.pow(2).mean(-1, keepdim=True) + self.eps)        # 归一化并缩放        return self.gamma * x / rms</span></code></pre></div><p data-pid=\"MnWbGk93\">在这段代码中，我们通过计算<b>均方根*</b>*（RMS）<b>对输入进行归一化，并且使用一个可训练的</b>gamma参数<b>进行缩放，</b>没有<b>使用传统的</b>beta**偏置项。</p><p data-pid=\"KKE6juVq\"><b>RMSNorm</b>的优势在于，它只需要计算输入的平方均值，相比<b>LayerNorm</b>来说，它的计算更加高效，尤其在大规模模型中能够提供更好的性能。</p><h3><b>（二）MoELayer——专家网络与路由器</b></h3><p data-pid=\"4kMtf6u8\">在<b>MoE*</b>*层（Mixture of Experts）<b>，模型的关键思想是利用</b>路由器<b>和</b>多专家并行计算**来提升模型的表达能力。具体来说：</p><ul><li data-pid=\"aQGcLtyq\"><b>路由器：</b>负责决定每个token发送给哪些专家进行计算。</li><li data-pid=\"bguXfi2x\"><b>多专家并行计算</b>：每个token可以同时选择多个专家（通过Top-k方式）。</li></ul><p data-pid=\"Ri8lOOyk\">下面是<b>MoELayer</b>的实现代码：</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"k\">class</span> <span class=\"nc\">MoELayer</span><span class=\"p\">(</span><span class=\"n\">nn</span><span class=\"o\">.</span><span class=\"n\">Module</span><span class=\"p\">):</span>    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">d_model</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">num_experts</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">num_experts_per_tok</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">hidden_size</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">):</span>        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">()</span>\n        <span class=\"c1\"># 路由器：根据输入的token计算每个token与专家的关联度        self.router = nn.Linear(d_model, num_experts, bias=False)        self.num_experts = num_experts        self.num_experts_per_tok = num_experts_per_tok</span>\n        <span class=\"c1\"># 专家的投影矩阵        self.gate_up_proj = nn.Parameter(torch.randn(num_experts, d_model, 2 * hidden_size) * 0.02)        self.down_proj = nn.Parameter(torch.randn(num_experts, hidden_size, d_model) * 0.02)</span>\n        <span class=\"c1\"># 激活函数        self.activation = nn.SiLU()</span>\n    <span class=\"k\">def</span> <span class=\"nf\">forward</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">Tensor</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">Tensor</span><span class=\"p\">:</span>        <span class=\"n\">B</span><span class=\"p\">,</span> <span class=\"n\">T</span><span class=\"p\">,</span> <span class=\"n\">D</span> <span class=\"o\">=</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">size</span><span class=\"p\">()</span>        <span class=\"n\">x_flat</span> <span class=\"o\">=</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">view</span><span class=\"p\">(</span><span class=\"n\">B</span> <span class=\"o\">*</span> <span class=\"n\">T</span><span class=\"p\">,</span> <span class=\"n\">D</span><span class=\"p\">)</span>\n        <span class=\"c1\"># 路由打分：计算每个 token 与专家的匹配度        logits = self.router(x)        topk_logits, topk_indices = torch.topk(logits, self.num_experts_per_tok, dim=-1)</span>\n        <span class=\"c1\"># 计算每个 token 路由到专家的权重        routing_weights = torch.sigmoid(topk_logits).view(-1)</span>\n        <span class=\"c1\"># 为每个 token 分配专家        token_idx = torch.arange(B * T, device=x.device).repeat_interleave(self.num_experts_per_tok)        selected_experts = topk_indices.view(-1)</span>\n        <span class=\"c1\"># 专家的前向计算：每个 token 会经过多个专家        expert_inputs = x_flat[token_idx]        expert_proj = self.gate_up_proj[selected_experts]        down_proj = self.down_proj[selected_experts]</span>\n        <span class=\"n\">gate_up</span> <span class=\"o\">=</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">bmm</span><span class=\"p\">(</span><span class=\"n\">expert_inputs</span><span class=\"o\">.</span><span class=\"n\">unsqueeze</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">),</span> <span class=\"n\">expert_proj</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">squeeze</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>        <span class=\"n\">gate</span><span class=\"p\">,</span> <span class=\"n\">up</span> <span class=\"o\">=</span> <span class=\"n\">gate_up</span><span class=\"o\">.</span><span class=\"n\">chunk</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"n\">dim</span><span class=\"o\">=-</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n        <span class=\"c1\"># 激活并计算专家输出        act = self.activation(gate) * up        out = torch.bmm(act.unsqueeze(1), down_proj).squeeze(1) * routing_weights.unsqueeze(-1)</span>\n        <span class=\"c1\"># 聚合专家输出：使用 scatter_add 进行加权合并        combined = torch.zeros_like(x_flat)        combined_weight = torch.zeros(B * T, 1, device=x.device)</span>\n        <span class=\"c1\"># 计算加权平均值        combined.scatter_add_(0, token_idx.unsqueeze(-1).expand(-1, D), out)        combined_weight.scatter_add_(0, token_idx.unsqueeze(-1), routing_weights.unsqueeze(-1))</span>\n        <span class=\"n\">combined</span> <span class=\"o\">=</span> <span class=\"n\">combined</span> <span class=\"o\">/</span> <span class=\"p\">(</span><span class=\"n\">combined_weight</span> <span class=\"o\">+</span> <span class=\"mf\">1e-6</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">combined</span><span class=\"o\">.</span><span class=\"n\">view</span><span class=\"p\">(</span><span class=\"n\">B</span><span class=\"p\">,</span> <span class=\"n\">T</span><span class=\"p\">,</span> <span class=\"n\">D</span><span class=\"p\">)</span></code></pre></div><h3><b>亮点：</b></h3><ul><li data-pid=\"Nwo2tDch\"><b>Top-k路由</b>：每个token可选择多个专家（由<code>num_experts_per_tok</code>控制）。</li><li data-pid=\"tDTOWHHR\"><b>专家参数矩阵</b>：每个专家拥有独立的<b>gate_up_proj</b>和<b>down_proj</b>，提供了丰富的表示能力。</li><li data-pid=\"rLEaiwcP\"><b>scatter_add聚合</b>：支持将不同token来自不同专家的加权输出融合到一起，确保每个token根据其选择的专家进行加权融合。</li></ul><p data-pid=\"p-aS0-0Z\"><b>MoELayer通过引入多个专家并行计算，使模型在处理复杂任务时可以灵活选择不同的专家，极大提升了计算效率和模型表现能力。</b></p><h3><b>（三）SharedExpert——全局共享专家</b></h3><p data-pid=\"wAxUg19L\">除了MoE层之外，模型还保留了一个<b>共享专家*</b>*（Shared Expert）**，确保即使路由器的专家分配不均，所有token也能获得基本的前馈计算能力。</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"k\">class</span> <span class=\"nc\">SharedExpert</span><span class=\"p\">(</span><span class=\"n\">nn</span><span class=\"o\">.</span><span class=\"n\">Module</span><span class=\"p\">):</span>    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">d_model</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">hidden_size</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">):</span>        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">()</span>\n        <span class=\"c1\"># gate：对输入进行加权        self.gate = nn.Linear(d_model, hidden_size, bias=False)        # up：将输入投影到隐藏空间        self.up = nn.Linear(d_model, hidden_size, bias=False)        # down：将隐藏空间的输出映射回模型维度        self.down = nn.Linear(hidden_size, d_model, bias=False)        # 激活函数        self.activation = nn.SiLU()</span>\n    <span class=\"k\">def</span> <span class=\"nf\">forward</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">Tensor</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">Tensor</span><span class=\"p\">:</span>        <span class=\"c1\"># gated计算：用 gate 激活决定加权，up 将其映射到隐藏空间        gated = torch.sigmoid(self.gate(x)) * self.activation(self.up(x))        # down 投影回原始维度        return self.down(gated)</span></code></pre></div><h3><b>亮点：</b></h3><ul><li data-pid=\"oIm_C3iE\"><b>共享专家</b>：这个模块作为全局的前馈网络，保证即使某些token没有被MoE专家处理，依然能通过共享专家获得计算能力。</li><li data-pid=\"9b6QU61s\"><b>Gate和Up</b>：<code>gate</code>和<code>up</code>层分别对输入进行加权和非线性变换。</li><li data-pid=\"Lbs60jtB\"><b>Down</b>：<code>down</code>层将隐藏空间的表示映射回原始的模型维度。</li><li data-pid=\"NhfL2qZC\"><b>SiLU激活</b>：使用<b>SiLU</b>激活函数增强非线性表示能力。</li></ul><p data-pid=\"6Rx-1hDw\"><b>共享专家</b>通过提供一个全局的前馈网络，在MoE层的路由机制中，确保所有token都能获得基本的计算能力，尤其是在专家分配不均的情况下。这保证了模型在各类输入情况下的稳定性和有效性。</p><h3><b>（四）AttentionBlock——带RoPE的多头注意力</b></h3><p data-pid=\"9VthHrsR\">在注意力层中，我们使用<b>旋转位置编码（RoPE）</b>代替传统的位置嵌入，并结合<b>因果Mask</b>，确保模型在自回归推理时只能访问历史信息，不能偷看未来。</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"k\">class</span> <span class=\"nc\">AttentionBlock</span><span class=\"p\">(</span><span class=\"n\">nn</span><span class=\"o\">.</span><span class=\"n\">Module</span><span class=\"p\">):</span>    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">d_model</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">n_heads</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">block_size</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">rope_theta</span><span class=\"p\">:</span> <span class=\"nb\">float</span><span class=\"p\">):</span>        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">()</span>\n        <span class=\"c1\"># Q、K、V 一次性线性映射        self.qkv = nn.Linear(d_model, 3 * d_model, bias=False)        # 输出投影        self.out_proj = nn.Linear(d_model, d_model, bias=False)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">n_heads</span> <span class=\"o\">=</span> <span class=\"n\">n_heads</span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">d_k</span> <span class=\"o\">=</span> <span class=\"n\">d_model</span> <span class=\"o\">//</span> <span class=\"n\">n_heads</span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">block_size</span> <span class=\"o\">=</span> <span class=\"n\">block_size</span>\n        <span class=\"c1\"># 下三角 Mask（因果遮罩）        self.register_buffer(            &#34;causal_mask&#34;,            torch.tril(torch.ones(block_size, block_size))            .view(1, 1, block_size, block_size)        )</span>\n        <span class=\"c1\"># 计算 RoPE 频率        inv_freq = 1.0 / (rope_theta ** (torch.arange(0, self.d_k, 2).float() / self.d_k))        pos = torch.arange(block_size).float()        freqs = torch.einsum(&#39;i,j-&gt;ij&#39;, pos, inv_freq)  # 位置 × 频率        self.register_buffer(            &#34;freqs_cis&#34;,            torch.polar(torch.ones_like(freqs), freqs).unsqueeze(0).unsqueeze(2)        )</span>\n    <span class=\"k\">def</span> <span class=\"nf\">forward</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">Tensor</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">Tensor</span><span class=\"p\">:</span>        <span class=\"n\">B</span><span class=\"p\">,</span> <span class=\"n\">T</span><span class=\"p\">,</span> <span class=\"n\">D</span> <span class=\"o\">=</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">size</span><span class=\"p\">()</span>\n        <span class=\"c1\"># 线性映射并拆分 Q、K、V        q, k, v = self.qkv(x).view(B, T, self.n_heads, 3 * self.d_k).chunk(3, dim=-1)</span>\n        <span class=\"c1\"># 应用 RoPE 旋转位置编码        def apply_rope(tensor):            t = tensor.view(B, T, self.n_heads, self.d_k // 2, 2)            t = torch.view_as_complex(t) * self.freqs_cis[:, :T]            return torch.view_as_real(t).flatten(3)</span>\n        <span class=\"n\">q</span><span class=\"p\">,</span> <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"n\">apply_rope</span><span class=\"p\">(</span><span class=\"n\">q</span><span class=\"p\">),</span> <span class=\"n\">apply_rope</span><span class=\"p\">(</span><span class=\"n\">k</span><span class=\"p\">)</span>\n        <span class=\"c1\"># 转换为 (B, heads, T, d_k) 以便计算注意力        q, k, v = q.permute(0, 2, 1, 3), k.permute(0, 2, 1, 3), v.permute(0, 2, 1, 3)</span>\n        <span class=\"c1\"># 缩放点积注意力        attn = (q @ k.transpose(-2, -1)) * (self.d_k ** -0.5)        attn = attn.masked_fill(self.causal_mask[:, :, :T, :T] == 0, float(&#39;-inf&#39;))        attn = F.softmax(attn, dim=-1)</span>\n        <span class=\"c1\"># 聚合输出并还原维度        out = (attn @ v).permute(0, 2, 1, 3).contiguous().view(B, T, D)        return self.out_proj(out)</span>\n</code></pre></div><h3><b>关键点说明：</b></h3><ul><li data-pid=\"HRrWVb4b\"><b>RoPE（旋转位置编码）</b><br/>将位置信息融入Q、K向量，而不是显式加到embedding上。<br/>支持无限长推理（理论上），并保留了相对位置信息的好处。</li><li data-pid=\"L1LFtKYd\"><b>因果Mask</b><br/>确保在时间步t的预测中，模型只能看到 [0, t]的信息，保持自回归特性。</li><li data-pid=\"tUQYOim-\"><b>一次性QKV投影</b><br/>将Q、K、V的计算合并为单次线性变换，相比分别调用三次<code>nn.Linear</code>，能显著减少计算和内存访问开销。</li><li data-pid=\"ULCzePef\"><b>复数形式实现RoPE</b><br/>利用复数乘法简洁实现旋转操作，比直接构造旋转矩阵更节省显存和计算量。</li></ul><h3><b>（五）LLaMA4MoEBlock——单层Transformer+MoE的融合</b></h3><p data-pid=\"uatYPKnc\">到这里，我们已经分别实现了<b>RMSNorm</b>、<b>多头注意力（RoPE）</b>、<b>MoE专家网络</b>、以及<b>全局共享专家</b>。</p><p data-pid=\"hsto6vaK\">接下来，我们组装一个功能完整的<b>Transformer Block</b>——也是LLaMA4-MoE的基本构建单元。</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"k\">class</span> <span class=\"nc\">LLaMA4MoEBlock</span><span class=\"p\">(</span><span class=\"n\">nn</span><span class=\"o\">.</span><span class=\"n\">Module</span><span class=\"p\">):</span>    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">d_model</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">n_heads</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">block_size</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">rope_theta</span><span class=\"p\">:</span> <span class=\"nb\">float</span><span class=\"p\">,</span>                 <span class=\"n\">num_experts</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">experts_per_tok</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">expert_hidden_size</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">shared_hidden_size</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">):</span>        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">()</span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">norm1</span> <span class=\"o\">=</span> <span class=\"n\">RMSNorm</span><span class=\"p\">(</span><span class=\"n\">d_model</span><span class=\"p\">)</span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">attn</span> <span class=\"o\">=</span> <span class=\"n\">AttentionBlock</span><span class=\"p\">(</span><span class=\"n\">d_model</span><span class=\"p\">,</span> <span class=\"n\">n_heads</span><span class=\"p\">,</span> <span class=\"n\">block_size</span><span class=\"p\">,</span> <span class=\"n\">rope_theta</span><span class=\"p\">)</span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">norm2</span> <span class=\"o\">=</span> <span class=\"n\">RMSNorm</span><span class=\"p\">(</span><span class=\"n\">d_model</span><span class=\"p\">)</span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">moe</span> <span class=\"o\">=</span> <span class=\"n\">MoELayer</span><span class=\"p\">(</span><span class=\"n\">d_model</span><span class=\"p\">,</span> <span class=\"n\">num_experts</span><span class=\"p\">,</span> <span class=\"n\">experts_per_tok</span><span class=\"p\">,</span> <span class=\"n\">expert_hidden_size</span><span class=\"p\">)</span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">shared</span> <span class=\"o\">=</span> <span class=\"n\">SharedExpert</span><span class=\"p\">(</span><span class=\"n\">d_model</span><span class=\"p\">,</span> <span class=\"n\">shared_hidden_size</span><span class=\"p\">)</span>\n    <span class=\"k\">def</span> <span class=\"nf\">forward</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">Tensor</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">Tensor</span><span class=\"p\">:</span>        <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"n\">x</span> <span class=\"o\">+</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">attn</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">norm1</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">))</span>        <span class=\"n\">moe_out</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">moe</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">norm2</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">))</span>        <span class=\"n\">shared_out</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">shared</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span>        <span class=\"k\">return</span> <span class=\"n\">x</span> <span class=\"o\">+</span> <span class=\"n\">moe_out</span> <span class=\"o\">+</span> <span class=\"n\">shared_out</span>\n</code></pre></div><p data-pid=\"oGz2hOjr\"><b>设计亮点：</b></p><ul><li data-pid=\"dhtupRM0\"><b>双残差结构</b>：保证梯度稳定、训练过程更平滑。</li><li data-pid=\"njd3lWbY\"><b>MoE提升容量</b>：按需分配专家，提高计算利用率。</li><li data-pid=\"ydenVPGQ\"><b>全局共享专家</b>：防止路由器分配不均造成的性能退化。</li></ul><h3><b>（六）LLaMA4MoEModel——完整模型</b></h3><p data-pid=\"jBq13CZo\">经过前面几节，我们构建了一个LLaMA4-MoE模型所需的全部零部件——从归一化层、带RoPE的多头注意力，到MoE专家路由和共享专家路径。</p><p data-pid=\"hO3jJbhn\">接下来，就是<b>将它们整合成一个真正可用的语言模型</b>。</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"k\">class</span> <span class=\"nc\">LLaMA4MoEModel</span><span class=\"p\">(</span><span class=\"n\">nn</span><span class=\"o\">.</span><span class=\"n\">Module</span><span class=\"p\">):</span>    <span class=\"s2\">&#34;&#34;&#34;LLaMA4-MoE 语言模型（多层堆叠）&#34;&#34;&#34;</span>    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">vocab_size</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">d_model</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">n_layers</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">n_heads</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span>                 <span class=\"n\">block_size</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">rope_theta</span><span class=\"p\">:</span> <span class=\"nb\">float</span><span class=\"p\">,</span> <span class=\"n\">num_experts</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">experts_per_tok</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span>                 <span class=\"n\">expert_hidden_size</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">shared_hidden_size</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">):</span>        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">()</span>        <span class=\"c1\"># 1) 词嵌入        self.embed = nn.Embedding(vocab_size, d_model)</span>\n        <span class=\"c1\"># 2) 多层 Transformer + MoE        self.blocks = nn.ModuleList([            LLaMA4MoEBlock(d_model, n_heads, block_size, rope_theta,                          num_experts, experts_per_tok, expert_hidden_size, shared_hidden_size)            for _ in range(n_layers)        ])</span>\n        <span class=\"c1\"># 3) 最终归一化        self.norm_final = RMSNorm(d_model)</span>\n        <span class=\"c1\"># 4) 输出层（权重通常可与 embedding 权重共享）        self.output = nn.Linear(d_model, vocab_size, bias=False)</span>\n    <span class=\"k\">def</span> <span class=\"nf\">forward</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">Tensor</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">Tensor</span><span class=\"p\">:</span>        <span class=\"c1\"># x: (B, T) token IDs        x = self.embed(x)  # (B, T, D)        for block in self.blocks:            x = block(x)        x = self.norm_final(x)  # (B, T, D)        logits = self.output(x) # (B, T, vocab_size)        return logits</span>\n</code></pre></div><p data-pid=\"T7ifEbGW\">整体架构设计非常直观，假设输入是一个批次的token ID，前向过程是这样的：</p><ul><li data-pid=\"A1VhPbQy\"><b>嵌入阶段：</b> <code>self.embed</code>把每个token ID映射到维度为<code>d_model</code>的向量表示。</li><li data-pid=\"-Ok1pSxp\"><b>逐层特征提取：</b> 依次经过多层<code>LLaMA4MoEBlock</code>：</li><ul><li data-pid=\"EGdd2emS\">先用RMSNorm做归一化；</li><li data-pid=\"P1xrPJtO\">再进入带RoPE的多头注意力模块，捕捉上下文依赖；</li><li data-pid=\"8wC-P29u\">然后进入MoE层+共享专家路径，做非线性特征变换；</li><li data-pid=\"EmFmRmjN\">每一步都有残差连接，保证梯度稳定。</li></ul><li data-pid=\"RTgA0HKj\"><b>最终归一化与预测：</b> 所有层处理完后，使用<code>RMSNorm</code>再做一次归一化； 最后通过<code>self.output</code>将维度投影回<code>vocab_size</code>，得到预测每个位置下一个token 的logits。</li></ul><p data-pid=\"CmiSzvUX\"><b>三、模型参数配置</b></p><p data-pid=\"rCi8gXhR\">在正式搭建MoE（Mixture of Experts）版本的LLaMA4模型前，我们需要一个<b>集中管理所有超参数的地方</b>。</p><p data-pid=\"p9b9M8pn\">在Python里，最方便的方式就是用<b>dataclass</b>来写一个配置类，把所有参数放在一起，既清晰又方便修改。</p><p data-pid=\"jz-rVljA\"><b>（一）模型配置类（</b><code>ModelConfig</code><b>）</b></p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"kn\">from</span> <span class=\"nn\">dataclasses</span> <span class=\"kn\">import</span> <span class=\"n\">dataclass</span>\n<span class=\"nd\">@dataclassclass</span> <span class=\"n\">ModelConfig</span><span class=\"p\">:</span>    <span class=\"n\">vocab_size</span><span class=\"p\">:</span> <span class=\"nb\">int</span> <span class=\"o\">=</span> <span class=\"mi\">665</span>           <span class=\"c1\"># 词表大小    d_model: int = 256              # Transformer 隐藏层维度    n_layers: int = 6               # Transformer 层数    n_heads: int = 4                # 多头注意力的头数    block_size: int = 16             # 最大序列长度    rope_theta: float = 10000.0     # RoPE 旋转位置编码的频率参数    num_experts: int = 8            # MoE 总专家数    experts_per_tok: int = 2        # 每个 token 路由到的专家数量（Top-k）    expert_hidden_size: int = 1024  # 每个专家的隐藏层维度    shared_hidden_size: int = 1024  # 共享专家的隐藏层维度</span>\n</code></pre></div><h3><b>参数解读：</b></h3><ul><li data-pid=\"TNM4TYxK\"><b>vocab_size</b>：词表大小，这里是665，因为采用字符级BPE编码，所以词表规模相对较小。</li><li data-pid=\"U82yXeK3\"><b>d_model</b>：Transformer的主通道维度，也就是隐藏层维度。</li><li data-pid=\"tlwfI_yx\"><b>n_layers</b>：堆叠多少个Transformer Block。</li><li data-pid=\"WjqNxOVN\"><b>n_heads</b>：多头注意力的头数。</li><li data-pid=\"BG35DHV1\"><b>block_size</b>：一次能处理的最大序列长度。</li><li data-pid=\"oRktOCZ7\"><b>rope_theta</b>：RoPE（旋转位置编码）频率参数，影响位置信息编码的周期性。</li><li data-pid=\"q0AG8mN2\"><b>num_experts</b>：MoE中的专家总数量，这里设为8。</li><li data-pid=\"gjVueXm7\"><b>experts_per_tok</b>：每个token会被路由到多少个专家（Top-k），这里是2。</li><li data-pid=\"nvpEi_Au\"><b>expert_hidden_size</b>：专家FFN（前馈层）的中间维度。</li><li data-pid=\"lEcswReT\"><b>shared_hidden_size</b>：共享专家的FFN维度，用来兜底通用模式。</li></ul><p data-pid=\"hhZybEpG\"><b>（二）训练配置（</b><code>TrainingConfig</code><b>）</b></p><p data-pid=\"YRVwgjtx\">除了模型结构参数，训练过程的超参数同样关键，决定了模型训练时的步伐节奏、批量大小、训练时长，以及评估频率。</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"nd\">@dataclassclass</span> <span class=\"n\">TrainingConfig</span><span class=\"p\">:</span>    <span class=\"n\">learning_rate</span><span class=\"p\">:</span> <span class=\"nb\">float</span> <span class=\"o\">=</span> <span class=\"mf\">5e-4</span>      <span class=\"c1\"># 学习率，控制参数更新的步伐大小    batch_size: int = 32             # 每个批次包含的样本数    epochs: int = 200                # 训练总轮数    eval_interval: int = 500         # 每多少步进行一次模型评估    device: str = &#39;cuda&#39;             # 训练设备，支持 &#39;cuda&#39;（GPU）或 &#39;cpu&#39;</span>\n</code></pre></div><h3><b>参数解读：</b></h3><ul><li data-pid=\"d4Q4-kk_\"><b>learning_rate</b>：学习率，决定模型参数每次更新的幅度。</li><li data-pid=\"mJp53_Bc\"><b>batch_size</b>：一次训练使用多少样本，影响训练速度与稳定性。</li><li data-pid=\"LWSUHaJw\"><b>epochs</b>：整个数据集被完整训练多少遍。</li><li data-pid=\"AP4uV-bQ\"><b>eval_interval</b>：每训练多少步对模型进行一次评估，了解训练效果。</li><li data-pid=\"mjtX1ATb\"><b>device</b>：指定训练硬件，GPU会显著加快训练速度，CPU则适合小规模或调试。</li></ul><p data-pid=\"_nc2WWtY\"><b>（三）路径配置（</b><code>PathsConfig</code><b>）</b></p><p data-pid=\"9g0QQyyk\">除了模型结构和训练参数，文件路径的统一管理也非常重要。</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"nd\">@dataclassclass</span> <span class=\"n\">PathsConfig</span><span class=\"p\">:</span>    <span class=\"n\">corpus_path</span><span class=\"p\">:</span> <span class=\"nb\">str</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;data/corpus.txt&#39;</span>            <span class=\"c1\"># 原始训练语料文件路径    tokenizer_model_path: str = &#39;tokenizer.model&#39;   # SentencePiece 分词器模型文件路径    encoded_ids_path: str = &#39;data/corpus_ids.txt&#39;   # 编码后的 token ID 文件保存路径    model_output_path: str = &#39;checkpoints&#39;          # 模型权重及检查点保存目录</span>\n</code></pre></div><h3><b>参数解读：</b></h3><ul><li data-pid=\"Irfhri6H\"><b>corpus_path</b>：存放原始训练文本语料的位置。</li><li data-pid=\"MDvJNjYI\"><b>tokenizer_model_path</b>：训练好的分词器模型文件，用于后续文本编码。</li><li data-pid=\"RY_PaNtE\"><b>encoded_ids_path</b>：分词器将文本转换成token ID后的保存文件。</li><li data-pid=\"OIKEAgLv\"><b>model_output_path</b>：训练过程中模型权重和检查点的保存目录。</li></ul><p data-pid=\"H83-vjmI\"><b>（四）配置实例化</b></p><p data-pid=\"6H0er6ba\">有了上面三个配置类，下一步就是<b>实例化它们</b>，方便在代码各处调用：</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">model_cfg</span> <span class=\"o\">=</span> <span class=\"n\">ModelConfig</span><span class=\"p\">()</span><span class=\"n\">train_cfg</span> <span class=\"o\">=</span> <span class=\"n\">TrainingConfig</span><span class=\"p\">()</span><span class=\"n\">paths_cfg</span> <span class=\"o\">=</span> <span class=\"n\">PathsConfig</span><span class=\"p\">()</span>\n<span class=\"err\">这样，我们就为</span><span class=\"n\">LLaMA4</span><span class=\"o\">-</span><span class=\"n\">MoE模型准备好了一份</span><span class=\"o\">**</span><span class=\"err\">结构与训练的完整说明书</span><span class=\"o\">**</span><span class=\"err\">。在后续的训练脚本中，可以直接引用这些配置，保持代码整洁且易于维护。</span>\n</code></pre></div><p data-pid=\"jgX1QfYY\"><b>四、训练脚本实现与运行流程</b></p><p data-pid=\"NVpX_rbX\">前面我们完成了模型定义、配置文件编写，以及数据准备和分词等工作，现在正式进入模型训练的核心——<b>训练脚本的实现</b>。</p><h2><b>（一）环境准备与数据加载</b></h2><p data-pid=\"nHoleUK8\">训练前，首先确认当前计算设备是否支持GPU，以加速训练过程。然后加载预训练的分词器（Tokenizer）和处理好的数据集（DataLoader）。</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"kn\">import</span> <span class=\"nn\">torchdevice</span> <span class=\"o\">=</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">device</span><span class=\"p\">(</span><span class=\"s2\">&#34;cuda&#34;</span> <span class=\"k\">if</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">cuda</span><span class=\"o\">.</span><span class=\"n\">is_available</span><span class=\"p\">()</span> <span class=\"k\">else</span> <span class=\"s2\">&#34;cpu&#34;</span><span class=\"p\">)</span><span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"s2\">&#34;Using device: {device}&#34;</span><span class=\"p\">)</span>\n<span class=\"n\">tokenizer</span> <span class=\"o\">=</span> <span class=\"n\">load_tokenizer</span><span class=\"p\">(</span><span class=\"n\">paths_cfg</span><span class=\"o\">.</span><span class=\"n\">tokenizer_model_path</span><span class=\"p\">)</span><span class=\"n\">dataloader</span> <span class=\"o\">=</span> <span class=\"n\">prepare_dataset</span><span class=\"p\">(</span><span class=\"n\">paths_cfg</span><span class=\"o\">.</span><span class=\"n\">encoded_ids_path</span><span class=\"p\">,</span> <span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">block_size</span><span class=\"p\">,</span> <span class=\"n\">train_cfg</span><span class=\"o\">.</span><span class=\"n\">batch_size</span><span class=\"p\">)</span>\n<span class=\"k\">for</span> <span class=\"n\">batch_idx</span><span class=\"p\">,</span> <span class=\"n\">batch</span> <span class=\"ow\">in</span> <span class=\"nb\">enumerate</span><span class=\"p\">(</span><span class=\"n\">dataloader</span><span class=\"p\">):</span>    <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;-&#39;</span> <span class=\"o\">*</span> <span class=\"mi\">30</span><span class=\"p\">)</span>    <span class=\"n\">input_ids</span><span class=\"p\">,</span> <span class=\"n\">labels</span> <span class=\"o\">=</span> <span class=\"n\">batch</span>    <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">input_ids</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">,</span> <span class=\"n\">labels</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">)</span>    <span class=\"k\">break</span>\n<span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">dataloader</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span>    <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span><span class=\"s2\">&#34;Dataloader is empty. 请检查语料大小或 block_size 设置是否合适。&#34;</span><span class=\"p\">)</span>\n</code></pre></div><p data-pid=\"37HlN3t4\">`这里，我们通过打印第一批数据的形状来确保数据加载正常，避免训练过程中因数据异常中断。```</p><h3><b>（二）模型初始化</b></h3><p data-pid=\"VKCWKvtC\">根据之前定义的配置，实例化LLaMA4-MoE模型，接着将模型移到指定设备（GPU或CPU），保证数据和模型在同一硬件上，避免不必要的数据传输开销。同时，调用<code>model.train()启用</code>训练模式，激活诸如dropout等训练专用功能。</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">LLaMA4MoEModel</span><span class=\"p\">(</span>    <span class=\"n\">vocab_size</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">vocab_size</span><span class=\"p\">,</span>    <span class=\"n\">d_model</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">d_model</span><span class=\"p\">,</span>    <span class=\"n\">n_layers</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">n_layers</span><span class=\"p\">,</span>    <span class=\"n\">n_heads</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">n_heads</span><span class=\"p\">,</span>    <span class=\"n\">block_size</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">block_size</span><span class=\"p\">,</span>    <span class=\"n\">rope_theta</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">rope_theta</span><span class=\"p\">,</span>    <span class=\"n\">num_experts</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">num_experts</span><span class=\"p\">,</span>    <span class=\"n\">experts_per_tok</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">experts_per_tok</span><span class=\"p\">,</span>    <span class=\"n\">expert_hidden_size</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">expert_hidden_size</span><span class=\"p\">,</span>    <span class=\"n\">shared_hidden_size</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">shared_hidden_size</span><span class=\"p\">,)</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">to</span><span class=\"p\">(</span><span class=\"n\">device</span><span class=\"p\">)</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">train</span><span class=\"p\">()</span>\n</code></pre></div><h2><b>（三）训练循环详解</b></h2><p data-pid=\"xooe_Vbl\">在定义好优化器和损失函数后，我们进入训练的核心环节——<b>循环迭代训练</b>。其训练步骤包括：</p><ul><li data-pid=\"_pDvX1eZ\">将输入数据送入模型，进行前向传播；</li><li data-pid=\"qZLy-Y4C\">计算交叉熵损失，衡量预测结果与标签的差距；</li><li data-pid=\"axmXQo6u\">反向传播计算梯度；</li><li data-pid=\"PNzwM2DT\">通过梯度裁剪防止梯度爆炸；</li><li data-pid=\"jSxXxiZl\">优化器更新模型参数。</li></ul><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">optimizer</span> <span class=\"o\">=</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">optim</span><span class=\"o\">.</span><span class=\"n\">AdamW</span><span class=\"p\">(</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">parameters</span><span class=\"p\">(),</span> <span class=\"n\">lr</span><span class=\"o\">=</span><span class=\"n\">train_cfg</span><span class=\"o\">.</span><span class=\"n\">learning_rate</span><span class=\"p\">)</span><span class=\"n\">loss_fn</span> <span class=\"o\">=</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">nn</span><span class=\"o\">.</span><span class=\"n\">CrossEntropyLoss</span><span class=\"p\">()</span>\n<span class=\"k\">for</span> <span class=\"n\">epoch</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">train_cfg</span><span class=\"o\">.</span><span class=\"n\">epochs</span><span class=\"p\">):</span>    <span class=\"n\">epoch_loss</span> <span class=\"o\">=</span> <span class=\"mf\">0.0</span>    <span class=\"n\">batch_count</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n    <span class=\"k\">for</span> <span class=\"n\">step</span><span class=\"p\">,</span> <span class=\"n\">batch</span> <span class=\"ow\">in</span> <span class=\"nb\">enumerate</span><span class=\"p\">(</span><span class=\"n\">dataloader</span><span class=\"p\">):</span>        <span class=\"n\">input_ids</span><span class=\"p\">,</span> <span class=\"n\">labels</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">b</span><span class=\"o\">.</span><span class=\"n\">to</span><span class=\"p\">(</span><span class=\"n\">device</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">b</span> <span class=\"ow\">in</span> <span class=\"n\">batch</span><span class=\"p\">]</span>\n        <span class=\"n\">optimizer</span><span class=\"o\">.</span><span class=\"n\">zero_grad</span><span class=\"p\">()</span>        <span class=\"n\">logits</span> <span class=\"o\">=</span> <span class=\"n\">model</span><span class=\"p\">(</span><span class=\"n\">input_ids</span><span class=\"p\">)</span>\n        <span class=\"c1\"># 计算损失，注意输入和标签均右移一个token对应预测任务        loss = loss_fn(logits[:, :-1, :].reshape(-1, logits.size(-1)), labels[:, 1:].reshape(-1))</span>\n        <span class=\"n\">loss</span><span class=\"o\">.</span><span class=\"n\">backward</span><span class=\"p\">()</span>\n        <span class=\"c1\"># 梯度裁剪，防止梯度爆炸        torch.nn.utils.clip_grad_norm_(model.parameters(), max_norm=1.0)</span>\n        <span class=\"n\">optimizer</span><span class=\"o\">.</span><span class=\"n\">step</span><span class=\"p\">()</span>\n        <span class=\"n\">epoch_loss</span> <span class=\"o\">+=</span> <span class=\"n\">loss</span><span class=\"o\">.</span><span class=\"n\">item</span><span class=\"p\">()</span>        <span class=\"n\">batch_count</span> <span class=\"o\">+=</span> <span class=\"mi\">1</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">step</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"o\">%</span> <span class=\"mi\">100</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span>            <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"s2\">&#34;Epoch {epoch + 1}, Step {step + 1}, Loss: {loss.item():.4f}&#34;</span><span class=\"p\">)</span>\n    <span class=\"n\">avg_loss</span> <span class=\"o\">=</span> <span class=\"n\">epoch_loss</span> <span class=\"o\">/</span> <span class=\"n\">batch_count</span> <span class=\"k\">if</span> <span class=\"n\">batch_count</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span> <span class=\"k\">else</span> <span class=\"mf\">0.0</span>    <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"s2\">&#34;[Epoch {epoch + 1}/{train_cfg.epochs}] Avg Loss: {avg_loss:.4f}&#34;</span><span class=\"p\">)</span>\n</code></pre></div><h2><b>训练过程中，程序会定期打印当前批次的损失和每个epoch的平均损失，方便监控训练状态。<code>Epoch 195, Step 100, Loss: 0.2866Epoch 195, Step 200, Loss: 0.3101[Epoch 195/200] Avg Loss: 0.2837...Epoch 200, Step 100, Loss: 0.2559Epoch 200, Step 200, Loss: 0.2217[Epoch 200/200] Avg Loss: 0.2797</code></b></h2><h2><b>（四）保存模型文件</b></h2><p data-pid=\"jKiclNu-\">训练结束后，我们把训练好的模型参数保存到指定目录，方便以后加载和推理使用。</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"n\">save_path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">paths_cfg</span><span class=\"o\">.</span><span class=\"n\">model_output_path</span><span class=\"p\">,</span> <span class=\"s2\">&#34;llama4_model.pth&#34;</span><span class=\"p\">)</span><span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">state_dict</span><span class=\"p\">(),</span> <span class=\"n\">save_path</span><span class=\"p\">)</span><span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"s2\">&#34;Model saved to: {save_path}&#34;</span><span class=\"p\">)</span>\n</code></pre></div><p data-pid=\"hkgZC_Q8\">通过这次训练，我们完整实现了基于PyTorch的LLaMA4 MoE架构语言模型训练脚本。你可以基于这个基础继续扩展，添加验证集进行模型评估，引入学习率调度策略，支持多GPU分布式训练等，这些功能进一步提升训练效果和效率。</p><p data-pid=\"m2upLPgf\"><b>五、文本生成实战演示</b></p><p data-pid=\"-rFlI9kd\">完成模型训练后，接下来我们利用训练好的LLaMA4 MoE模型进行<b>文本生成推理</b>。本文将带你一步步实现基于自回归采样的文本生成函数，并配合示例演示，快速掌握生成流程。</p><h2><b>（一）生成函数解析</b></h2><p data-pid=\"5OSEBq7f\">核心函数<code>generate_text</code>采用自回归方式，依据给定的输入提示（prompt），逐步生成后续文本。</p><p data-pid=\"aA0JA1-U\">主要流程包括：</p><ul><li data-pid=\"ABn22Z3M\">将提示文本编码成token ID序列；</li><li data-pid=\"TXFFzcL_\">逐步截断输入，保证长度不超过模型的最大上下文<code>block_size</code>；</li><li data-pid=\"D8okUzlw\">模型前向推理，获得当前时刻的logits概率分布；</li><li data-pid=\"rx0Y7-rr\">通过温度<b>和</b>Top-K采样调节生成的多样性与随机性；</li><li data-pid=\"97Z6xn02\">根据采样结果选出下一个token，拼接至序列尾部；</li><li data-pid=\"jSBtpuk7\">若采样到结束符（EOS），则提前终止生成；</li><li data-pid=\"IFCWgSKu\">最后将生成的token ID序列解码回文本。</li></ul><p data-pid=\"LZpelLTM\">其中，<b>温度参数temperature</b>用来控制预测概率分布的平滑程度，温度越高，生成越随机多样；温度越低，生成越稳定保守。</p><p data-pid=\"Sa9Vx2Ep\"><b>Top-K采样</b>则限制每次生成时只能从概率最高的K个词中采样，避免选到概率极低的无效词，保证生成内容合理。</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"nd\">@torch.no_grad</span><span class=\"p\">()</span><span class=\"k\">def</span> <span class=\"nf\">generate_text</span><span class=\"p\">(</span><span class=\"n\">model</span><span class=\"p\">,</span> <span class=\"n\">tokenizer</span><span class=\"p\">,</span> <span class=\"n\">prompt</span><span class=\"p\">,</span> <span class=\"n\">max_new_tokens</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">temperature</span><span class=\"o\">=</span><span class=\"mf\">1.0</span><span class=\"p\">,</span> <span class=\"n\">top_k</span><span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">,</span> <span class=\"n\">device</span><span class=\"o\">=</span><span class=\"s2\">&#34;cpu&#34;</span><span class=\"p\">):</span>    <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">eval</span><span class=\"p\">()</span>    <span class=\"n\">input_ids</span> <span class=\"o\">=</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">tensor</span><span class=\"p\">([</span><span class=\"n\">tokenizer</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"n\">prompt</span><span class=\"p\">)],</span> <span class=\"n\">dtype</span><span class=\"o\">=</span><span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">long</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">to</span><span class=\"p\">(</span><span class=\"n\">device</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">max_new_tokens</span><span class=\"p\">):</span>        <span class=\"c1\"># 截断输入，确保长度不超过block_size        input_cond = input_ids[:, -model_cfg.block_size:]        logits = model(input_cond)        # 温度调节概率分布        logits = logits[:, -1, :] / temperature</span>\n        <span class=\"k\">if</span> <span class=\"n\">top_k</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"bp\">None</span><span class=\"p\">:</span>            <span class=\"n\">values</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"o\">=</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">topk</span><span class=\"p\">(</span><span class=\"n\">logits</span><span class=\"p\">,</span> <span class=\"n\">k</span><span class=\"o\">=</span><span class=\"n\">top_k</span><span class=\"p\">)</span>            <span class=\"n\">min_values</span> <span class=\"o\">=</span> <span class=\"n\">values</span><span class=\"p\">[:,</span> <span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">unsqueeze</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span>            <span class=\"c1\"># 只保留top_k的logits，其他置为负无穷            logits = torch.where(logits &lt; min_values, torch.full_like(logits, -float(&#34;Inf&#34;)), logits)</span>\n        <span class=\"n\">probs</span> <span class=\"o\">=</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">softmax</span><span class=\"p\">(</span><span class=\"n\">logits</span><span class=\"p\">,</span> <span class=\"n\">dim</span><span class=\"o\">=-</span><span class=\"mi\">1</span><span class=\"p\">)</span>        <span class=\"c1\"># 根据概率采样下一个token        next_id = torch.multinomial(probs, num_samples=1)        input_ids = torch.cat([input_ids, next_id], dim=1)</span>\n        <span class=\"k\">if</span> <span class=\"n\">next_id</span><span class=\"o\">.</span><span class=\"n\">item</span><span class=\"p\">()</span> <span class=\"o\">==</span> <span class=\"n\">tokenizer</span><span class=\"o\">.</span><span class=\"n\">eos_id</span><span class=\"p\">:</span>            <span class=\"k\">break</span>\n    <span class=\"n\">generated_text</span> <span class=\"o\">=</span> <span class=\"n\">tokenizer</span><span class=\"o\">.</span><span class=\"n\">decode</span><span class=\"p\">(</span><span class=\"n\">input_ids</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">tolist</span><span class=\"p\">())</span>    <span class=\"k\">return</span> <span class=\"n\">generated_text</span>\n</code></pre></div><h2><b>(二）推理主流程</b></h2><p data-pid=\"z1rXMTzz\">在<code>main()</code>函数中，我们先加载分词器和模型，接着载入训练好的权重，并将模型移动到合适的设备。然后调用前面实现的生成函数，完成一次文本生成示例。</p><div class=\"highlight\"><pre><code class=\"language-python\"><span class=\"k\">def</span> <span class=\"nf\">main</span><span class=\"p\">():</span>    <span class=\"n\">device</span> <span class=\"o\">=</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">device</span><span class=\"p\">(</span><span class=\"s2\">&#34;cuda&#34;</span> <span class=\"k\">if</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">cuda</span><span class=\"o\">.</span><span class=\"n\">is_available</span><span class=\"p\">()</span> <span class=\"k\">else</span> <span class=\"s2\">&#34;cpu&#34;</span><span class=\"p\">)</span>    <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"s2\">&#34;Using device: {device}&#34;</span><span class=\"p\">)</span>\n    <span class=\"n\">tokenizer</span> <span class=\"o\">=</span> <span class=\"n\">load_tokenizer</span><span class=\"p\">(</span><span class=\"n\">paths_cfg</span><span class=\"o\">.</span><span class=\"n\">tokenizer_model_path</span><span class=\"p\">)</span>\n    <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">LLaMA4MoEModel</span><span class=\"p\">(</span>        <span class=\"n\">vocab_size</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">vocab_size</span><span class=\"p\">,</span>        <span class=\"n\">d_model</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">d_model</span><span class=\"p\">,</span>        <span class=\"n\">n_layers</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">n_layers</span><span class=\"p\">,</span>        <span class=\"n\">n_heads</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">n_heads</span><span class=\"p\">,</span>        <span class=\"n\">block_size</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">block_size</span><span class=\"p\">,</span>        <span class=\"n\">rope_theta</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">rope_theta</span><span class=\"p\">,</span>        <span class=\"n\">num_experts</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">num_experts</span><span class=\"p\">,</span>        <span class=\"n\">experts_per_tok</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">experts_per_tok</span><span class=\"p\">,</span>        <span class=\"n\">expert_hidden_size</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">expert_hidden_size</span><span class=\"p\">,</span>        <span class=\"n\">shared_hidden_size</span><span class=\"o\">=</span><span class=\"n\">model_cfg</span><span class=\"o\">.</span><span class=\"n\">shared_hidden_size</span><span class=\"p\">,</span>    <span class=\"p\">)</span>\n    <span class=\"n\">model_path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">paths_cfg</span><span class=\"o\">.</span><span class=\"n\">model_output_path</span><span class=\"p\">,</span> <span class=\"s2\">&#34;llama4_model.pth&#34;</span><span class=\"p\">)</span>    <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">load_state_dict</span><span class=\"p\">(</span><span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">load</span><span class=\"p\">(</span><span class=\"n\">model_path</span><span class=\"p\">,</span> <span class=\"n\">map_location</span><span class=\"o\">=</span><span class=\"n\">device</span><span class=\"p\">))</span>    <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">to</span><span class=\"p\">(</span><span class=\"n\">device</span><span class=\"p\">)</span>\n    <span class=\"n\">prompt</span> <span class=\"o\">=</span> <span class=\"s2\">&#34;如今国际球员的影响力&#34;</span>    <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"s2\">&#34;Prompt: {prompt}&#34;</span><span class=\"p\">)</span>\n    <span class=\"n\">output</span> <span class=\"o\">=</span> <span class=\"n\">generate_text</span><span class=\"p\">(</span><span class=\"n\">model</span><span class=\"p\">,</span> <span class=\"n\">tokenizer</span><span class=\"p\">,</span> <span class=\"n\">prompt</span><span class=\"p\">,</span> <span class=\"n\">max_new_tokens</span><span class=\"o\">=</span><span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"n\">temperature</span><span class=\"o\">=</span><span class=\"mf\">0.8</span><span class=\"p\">,</span> <span class=\"n\">top_k</span><span class=\"o\">=</span><span class=\"mi\">50</span><span class=\"p\">,</span> <span class=\"n\">device</span><span class=\"o\">=</span><span class=\"n\">device</span><span class=\"p\">)</span>    <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"s2\">&#34;</span><span class=\"se\">\\n</span><span class=\"s2\">--- Generated Text ---&#34;</span><span class=\"p\">)</span>    <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">output</span><span class=\"p\">)</span>\n</code></pre></div><p data-pid=\"cNrR_ldO\">本部分重点展示了如何结合训练好的模型与分词器，实现灵活的自回归采样文本生成。通过调整<b>温度（temperature）</b>和<b>Top-K采样</b>参数，可以平衡生成文本的质量与多样性，满足不同应用场景的需求。</p><p data-pid=\"fPCR_Tya\">未来你还可以以此为基础，扩展更丰富的生成策略，如<b>Top-p（核）采样</b>、<b>束搜索（Beam Search）</b>等，打造更强大、更智能的文本生成应用。</p><p class=\"ztext-empty-paragraph\"><br/></p><p data-pid=\"NoLJk_m4\"><b>六、总结与未来方向</b></p><p data-pid=\"6W5jZTFE\">本文从工程实现角度，系统展示了<b>LLaMA4风格MoE语言模型</b>的构建流程，涵盖数据预处理、模型结构设计、训练实现与推理生成等关键环节。通过结合RMSNorm、RoPE位置编码、多头注意力机制与专家混合路由策略，实现了在可控计算成本下提升模型容量与表达能力的目标。</p><p data-pid=\"vRD-0M5I\">在实现过程中，合理的数据编码与切分、稳定的训练配置以及高效的推理方法是确保模型性能与可用性的关键。各模块的有机整合与优化，使 MoE 架构在实际应用中能够兼顾精度与效率，并为其在更大规模数据与更复杂任务中的扩展奠定了基础。</p><h2><b>最后的最后</b></h2><p data-pid=\"DR4JydcB\">为了帮助开发者打破壁垒，快速了解大模型核心技术原理，学习相关大模型技术。从原理出发真正入局大模型。这里给大家准备了一份涵盖了<b>AI大模型入门学习思维导图、精品AI大模型学习书籍手册、视频教程、实战学习等录播视频</b> 全系列的学习资料。这些学习资料不仅深入浅出，而且非常实用，让大家系统而高效地掌握AI大模型的各个知识点。</p><h3>这份完整版的AI大模型学习资料，朋友们如果有需要的话可以点击下方卡片免费领取【保证100%免费】</h3><a href=\"https://zhuanlan.zhihu.com/p/1940068345966757141\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\"internal\">【2025最新总结】AI大模型全套学习资料，免费领取！含最新学习路线、大厂面试真题、可落地的项目实战、经典的PDF书籍.......</a><h2><b>大模型知识脑图</b></h2><p data-pid=\"NppG4Gim\">为了成为更好的 AI大模型 开发者，这里为大家提供了总的路线图。它的用处就在于，你可以按照上面的知识点去找对应的学习资源，保证自己学得较为全面。</p><h3><b>第一阶段（10天）：初阶应用</b></h3><p data-pid=\"Gthd6Gn7\">该阶段让大家对大模型 AI有一个最前沿的认识，对大模型 AI 的理解超过 95% 的人，可以在相关讨论时发表高级、不跟风、又接地气的见解，别人只会和 AI 聊天，而你能调教 AI，并能用代码将大模型和业务衔接。</p><ul><li data-pid=\"dE9FwKb-\">大模型 AI 能干什么？</li><li data-pid=\"rSqJi3Dc\">大模型是怎样获得「智能」的？</li><li data-pid=\"1cMowZDU\">用好 AI 的核心心法</li><li data-pid=\"zNSlt4Ax\">大模型应用业务架构</li><li data-pid=\"HqrOId6D\">大模型应用技术架构</li><li data-pid=\"cG8Rbt3D\">代码示例：向 GPT-3.5 灌入新知识</li><li data-pid=\"xGkzDYt9\">提示工程的意义和核心思想</li><li data-pid=\"2FEJOPOm\">Prompt 典型构成</li><li data-pid=\"X8hi8-iQ\">指令调优方法论</li><li data-pid=\"GrQ-cPV4\">思维链和思维树</li><li data-pid=\"t-XonyH-\">Prompt 攻击和防范</li><li data-pid=\"Iq7fEKNv\">....</li></ul><h2><b>第二阶段（30天）：高阶应用</b></h2><p data-pid=\"KKtz-Yer\">该阶段我们正式进入大模型 AI 进阶实战学习，学会构造私有知识库，扩展 AI 的能力。快速开发一个完整的基于 agent 对话机器人。掌握功能最强的大模型开发框架，抓住最新的技术进展，适合 Python 和 JavaScript 程序员。</p><ul><li data-pid=\"TDM_bSd7\">为什么要做 RAG</li><li data-pid=\"L7e18bHI\">搭建一个简单的 ChatPDF</li><li data-pid=\"5uFffNNn\">检索的基础概念</li><li data-pid=\"Qf1gZw0q\">什么是向量表示（Embeddings）</li><li data-pid=\"XXVif43Z\">向量数据库与向量检索</li><li data-pid=\"caF5du-Z\">基于向量检索的 RAG</li><li data-pid=\"eNnZE_RQ\">搭建 RAG 系统的扩展知识</li><li data-pid=\"PYEcy7eS\">混合检索与 RAG-Fusion 简介</li><li data-pid=\"GjOLazWU\">向量模型本地部署</li><li data-pid=\"z21aU34q\">....</li></ul><h3><b>第三阶段（30天）：模型训练</b></h3><p data-pid=\"DYIDw2Mt\">恭喜你，如果学到这里，你基本可以找到一份大模型 AI相关的工作，自己也能训练 GPT 了！通过微调，训练自己的垂直大模型，能独立训练开源多模态大模型，掌握更多技术方案。</p><p data-pid=\"9GC5b7tL\">到此为止，大概2个月的时间。你已经成为了一名“AI小子”。那么你还想往下探索吗？</p><ul><li data-pid=\"L_Q_angz\">为什么要做 RAG</li><li data-pid=\"nxLHmbr4\">什么是模型</li><li data-pid=\"iqNuMqLh\">什么是模型训练</li><li data-pid=\"h76ggne2\">求解器 &amp; 损失函数简介</li><li data-pid=\"y5alOUqG\">小实验2：手写一个简单的神经网络并训练它</li><li data-pid=\"4DpFg8MC\">什么是训练/预训练/微调/轻量化微调</li><li data-pid=\"g2MQr1KG\">Transformer结构简介</li><li data-pid=\"431DRz83\">轻量化微调</li><li data-pid=\"0hc0NJee\">实验数据集的构建</li><li data-pid=\"Ts5mhz3n\">....</li></ul><h3><b>第四阶段（20天）：商业闭环</b></h3><p data-pid=\"38tOB6-d\">对全球大模型从性能、吞吐量、成本等方面有一定的认知，可以在云端和本地等多种环境下部署大模型，找到适合自己的项目/创业方向，做一名被 AI 武装的产品经理。</p><ul><li data-pid=\"VwKeQlR3\">硬件选型</li><li data-pid=\"ad8uRWBD\">带你了解全球大模型</li><li data-pid=\"lVuJqLYH\">使用国产大模型服务</li><li data-pid=\"1T5icHvN\">搭建 OpenAI 代理</li><li data-pid=\"7flYOF8V\">热身：基于阿里云 PAI 部署 Stable Diffusion</li><li data-pid=\"ke83i6UK\">在本地计算机运行大模型</li><li data-pid=\"jCUAzh7r\">大模型的私有化部署</li><li data-pid=\"kKApzbzA\">基于 vLLM 部署大模型</li><li data-pid=\"hOzDKFHi\">案例：如何优雅地在阿里云私有部署开源大模型</li><li data-pid=\"ouwBFqsW\">部署一套开源 LLM 项目</li><li data-pid=\"143D-pyC\">内容安全</li><li data-pid=\"txOW2eQ-\">互联网信息服务算法备案</li><li data-pid=\"v37LBYof\">...</li></ul><p data-pid=\"To2EVJh3\">学习是一个过程，只要学习就会有挑战。天道酬勤，你越努力，就会成为越优秀的自己。</p><p data-pid=\"aiwPNiqT\">如果你能在15天内完成所有的任务，那你堪称天才。然而，如果你能完成 60-70% 的内容，你就已经开始具备成为一名大模型 AI 的正确特征了。 </p><figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-cad572e72d77252fd341639139298563_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1786\" data-rawheight=\"752\" data-original-token=\"v2-ae2c95dac5fe2b85cd47d61c751745d8\" class=\"origin_image zh-lightbox-thumb\" width=\"1786\" data-original=\"https://pic2.zhimg.com/v2-cad572e72d77252fd341639139298563_r.jpg\"/></figure><h2><b>经典书籍阅读</b></h2><p data-pid=\"0ni1wLMX\">阅读AI大模型经典书籍可以帮助读者提高技术水平，开拓视野，掌握核心技术，提高解决问题的能力，同时也可以借鉴他人的经验。对于想要深入学习AI大模型开发的读者来说，阅读经典书籍是非常有必要的。</p><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-0707dc97fe385dbab12f76d2ad2fb997_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"587\" data-rawheight=\"349\" data-original-token=\"v2-5e785ebf945dc012663cbda12df2fb41\" class=\"origin_image zh-lightbox-thumb\" width=\"587\" data-original=\"https://pic4.zhimg.com/v2-0707dc97fe385dbab12f76d2ad2fb997_r.jpg\"/></figure><h2><b>实战案例</b></h2><p data-pid=\"QeiwmaMt\">光学理论是没用的，要学会跟着一起敲，要动手实操，才能将自己的所学运用到实际当中去，这时候可以搞点实战案例来学习。</p><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-9d417e3e8b8f3985afc0fb7d8d8871f4_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"622\" data-rawheight=\"305\" data-original-token=\"v2-3e1383d8c5e6b3f6e2d1c93559e9a5f5\" class=\"origin_image zh-lightbox-thumb\" width=\"622\" data-original=\"https://pic3.zhimg.com/v2-9d417e3e8b8f3985afc0fb7d8d8871f4_r.jpg\"/></figure><h2><b>面试资料</b></h2><p data-pid=\"zyMEjsAQ\">我们学习AI大模型必然是想找到高薪的工作，下面这些面试题都是总结当前最新、最热、最高频的面试题，并且每道题都有详细的答案，面试前刷完这套面试题资料，小小offer，不在话下</p><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-7ec1affc165e0075eb71629d6b0fa8c9_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"625\" data-rawheight=\"308\" data-original-token=\"v2-61d67f76641340ba17212be8b07623f2\" class=\"origin_image zh-lightbox-thumb\" width=\"625\" data-original=\"https://pic4.zhimg.com/v2-7ec1affc165e0075eb71629d6b0fa8c9_r.jpg\"/></figure><h2><b>640套AI大模型报告合集</b></h2><p data-pid=\"H6jT1fwK\"> 这套包含640份报告的合集，涵盖了AI大模型的理论研究、技术实现、行业应用等多个方面。无论您是科研人员、工程师，还是对AI大模型感兴趣的爱好者，这套报告合集都将为您提供宝贵的信息和启示。 </p><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-5035a44211ac3a0431267e7f39fc7434_1440w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"627\" data-rawheight=\"310\" data-original-token=\"v2-a8eff8213923526b18e342e423517bb9\" class=\"origin_image zh-lightbox-thumb\" width=\"627\" data-original=\"https://pic1.zhimg.com/v2-5035a44211ac3a0431267e7f39fc7434_r.jpg\"/></figure><h3>这份完整版的AI大模型学习资料，朋友们如果有需要的话可以点击下方卡片免费领取【保证100%免费】</h3><a href=\"https://zhuanlan.zhihu.com/p/1940068345966757141\" data-draft-node=\"block\" data-draft-type=\"link-card\" class=\"internal\">【2025最新总结】AI大模型全套学习资料，免费领取！含最新学习路线、大厂面试真题、可落地的项目实战、经典的PDF书籍.......</a><p></p>",
        "is_labeled": false,
        "visited_count": 42,
        "thumbnails": [
          "https://picx.zhimg.com/50/v2-ae2c95dac5fe2b85cd47d61c751745d8_720w.jpg?source=b6762063"
        ],
        "favorite_count": 7,
        "article_type": "normal",
        "is_navigator": false,
        "navigator_vote": false,
        "vote_next_step": "vote"
      },
      "brief": "{\"source\": \"TS\", \"type\": \"article\", \"id\": 1941562321634849678}",
      "attached_info": "Ct8HCLmHweq9gb3SvgEQBxoJMjYyMDE2MTM4INK+lsUGKAIwAEDjBEojChhUU19TT1VSQ0VfV0FSTV9VUF9CT09TVDESATAYACAAOgBKLQoiVFNfU09VUkNFX1dBUk1fVVBfSElHSF9JTlRFUkFDVElPThIBMBgAIAA6AGIgZjA3NWJiMDBjMjlmNGMzMzYyNWE1OWJiMzUxYWUwYTdyEzE5NDE1NjIzMjE2MzQ4NDk2NziqAQlyZWNvbW1lbmTCASAyMzVjNDE4ZTkzMTY1MWMzNzFkZjRhZTE1MDc2OGFmOfIBCggMEgZOb3JtYWzyASgIChIkYzkxYjdmZWQtZTMwMS00NzM1LTg4ZTYtNzAxYmQwMDgzMzIx8gEHCAsSAzEwMoICAIgC1pnO+YwzkgIgMjM1YzQxOGU5MzE2NTFjMzcxZGY0YWUxNTA3NjhhZjmaAgDKAhZTaG9ySW50ZXJlc3RXZWlnaHRSdWxlygIVVXNlckxjbkV4aXRXZWlnaHRSdWxlygITRW1iU2ltSXNvbGF0aW9uUnVsZcoCHEJheWVzRmlyc3RMZXZlbElzb2xhdGlvblJ1bGXaAhhUU19TT1VSQ0VfV0FSTV9VUF9CT09TVDHoAgL6AgtOT1JNQUxfRkxPV4oDIDg0MTE3NjM2Mzk2YzQwNmFhM2EwMTAyYzE4YTVmZDdlmgMNCgJ2MhAAGgVvdGhlcqgDKtgDAOoDHnRleHRfaGlnaF9pbnRlcmFjdGlvbl9yZWNhbGxlcvoDigISDFVOS05PV05fTU9ERSAAKg1OT19JTUFHRV9NT0RFOi0IAhD6DRjwBSIjdjItYWUyYzk1ZGFjNWZlMmI4NWNkNDdkNjFjNzUxNzQ1ZDg6LQgCEMsEGN0CIiN2Mi01ZTc4NWViZjk0NWRjMDEyNjYzY2JkYTEyZGYyZmI0MTotCAMQ7gQYsQIiI3YyLTNlMTM4M2Q4YzVlNmIzZjZlMmQxYzkzNTU5ZTlhNWY1Oi0IAhDxBBi0AiIjdjItNjFkNjdmNzY2NDEzNDBiYTE3MjEyYmU4YjA3NjIzZjI6LQgCEPMEGLYCIiN2Mi1hOGVmZjgyMTM5MjM1MjZiMThlMzQyZTQyMzUxN2JiOYAEAIgEAJIEBk5vcm1hbJoEATKgBACoBACwBAC6BAJhacIEAzQwMMgEANIED+aOqOiNkOW3suabtOaWsNgEAPAEAPkEAAAAYMx1hT+BBQAAAAAAAAAAiQW45Ei9E1TZP5IFAJoFA2RmdKIFA2RmdLIFATG5BQAAAAAAAAAA0AUA4AUA6AUA8AVmkAYAoAbpBKgGAJICLgoJMjYyMDE2MTM4EhMxOTQxNTYyMzIxNjM0ODQ5Njc4GAciCklNQUdFX1RFWFQ=",
      "action_card": false
    }
  ],
  "paging": {
    "is_end": false,
    "is_start": false,
    "next": "https://www.zhihu.com/api/v3/feed/topstory/recommend?action=down&ad_interval=-10&after_id=611&desktop=true&end_offset=617&page_number=103&session_token=f075bb00c29f4c33625a59bb351ae0a7",
    "previous": "https://www.zhihu.com/api/v3/feed/topstory/recommend?action=pull&ad_interval=-10&before_id=611&desktop=true&end_offset=617&page_number=103&session_token=f075bb00c29f4c33625a59bb351ae0a7",
    "totals": 0
  },
  "fresh_text": "推荐已更新"
}